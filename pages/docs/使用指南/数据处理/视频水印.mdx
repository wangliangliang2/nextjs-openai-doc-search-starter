提供给视频添加水印功能，支持通过控制台和API设置水印，并在转码时添加水印。本文为您介绍添加水印的使用说明、水印预设、水印类型、位置参数和使用场景。

​
# **简介**

视频添加水印，即指在视频的编解码过程中将图片、文字等信息压制到视频流中合并输出一个带图文水印的新的视频文件。通常在视频上添加企业、品牌Logo、电视台台标等标志性信息，可用于宣示对视频的版权归属或品牌宣传。


## **水印类型**

当前支持两种水印类型：静态图片、文字水印。

- **图片水印**

  > - 目前仅支持PNG格式，图片位于视频特定位置从片头展示到片尾，也可自适应缩放图片水印。
  > - 适合对视频版权宣示或品牌宣传。


- **文字水印**

  > - 用户可将特定的一段或多段文字压制到视频画面上作为水印，可支持用户设置文字的字体、大小、颜色、位置等效果。
  > - 适合对视频版权宣示或品牌宣传。

  ​

# **设置水印的方式**

视频水印的使用流程如下：

1. 创建水印预设，具体操作，请参见控制台[水印预设](https://portal.qiniu.com/dora/media-gate/preset?activeTab=watermark)。

2. 使用创建好的水印预设，去创建工作流，选择【普通转码】or【锐智转码】节点时，需设置水印，具体操作请参考控制台[工作流](https://portal.qiniu.com/dora/media-gate/template/create)，如下：

   ![](https://dora-doc.qiniu.com/WX20201214-111757.png)

3. 如需原画转码，选择不使用水印即可。

   ​


# **水印参数说明**

水印位置参数是用于控制水印在输出视频画面中显示的位置、尺寸。

为了避免用户将过多精力集放在参数管理，控制台可以将这一系列复杂参数保存为预设。用户可自行定义水印预设，以满足用户个性化需求，更方便使用。



下面对各类型参数的关键参数含义及取值范围进行说明。

## **1. 图片水印**

| 参数                         | 必填 | 说明                                                         |
| ---------------------------- | ---- | ------------------------------------------------------------ |
| 水印类型                     | 是   | 支持两种类型：图片水印、文字水印                             |
| 水印图片素材(wmImage)        | 是   | 适用于图片水印，只支持上传 png/ jpg /gif /bmp 格式的图片，大小不超过20M |
| 水印图片自适应缩放 (wmScale) | 否   | 适用于图片水印， 指定水印图片的短边与输入视频之间的比例，取值为(0,1]，数值支持小数点后三位 |
| 水印位置(wmGravity）         | 是   | 水印在视频画面中的相对位置，默认在右上角                     |
| 横向边距<br /> (wmOffsetX)   | 否   | 设置水印位置的相对横向偏移量，正数则向右偏移，反之向左       |
| 纵向边距<br /> (wmOffsetY)   | 否   | 设置水印位置的相对纵向偏移量，正数则向下偏移，反之向上       |

**示意图**

如需水印居中显示，图片缩放为0.2倍，并设置水印的偏移位置 wmOffsetX=300、wmOffsetY=100。

![](https://dora-doc.qiniu.com/WX20201214-101730.png)

## **2. 文字水印**

| 参数                            | 必填 | 说明                                                         |
| ------------------------------- | ---- | ------------------------------------------------------------ |
| 水印类型                        | 是   | 支持两种类型：图片水印、文字水印                             |
| 水印文字<br />(wmText)          | 是   | 支持多种语言的文字；<br />文字水印支持预定义变量和自定义变量替换，变量引用格式为{{.meta.var}}，详情查看[变量](https://developer.qiniu.com/dora/6502/upload-video-files)。 |
| 水印字体 <br />(wmFont)         | 是   | 中文水印必须指定中文字体，英文水印可以指定中、英文字体       |
| 水印字体大小 <br />(wmFontSize) | 是   | 取值范围 [1,100000] 的整数                                   |
| 字体颜色 <br />(wmFontColor)    | 是   | 文字水印中文字的颜色（0xRRGGBB）                             |
| 水印位置 <br />(wmGravityText)  | 是   | 水印在视频画面中的相对位置，默认在右上角                     |
| 横向边距 <br />(wmOffsetX)      | 否   | 设置水印位置的相对横向偏移量，正数则向右偏移，反之向左       |
| 纵向边距<br /> (wmOffsetY)      | 否   | 设置水印位置的相对纵向偏移量，正数则向下偏移，反之向上       |

## **3.水印时间线**

设置文字或图片水印时间线，可以控制水印出现的时间范围。

####  **1).从片头开始（正向）**

![img](https://dora-doc.qiniu.com/WX20210208-144222%402x.png)

| 参数                         | 必填 | 说明                                                         |
| ---------------------------- | ---- | ------------------------------------------------------------ |
| 水印时间线                   | N    | 默认关闭，水印在视频整个时段内出现；<br />开启后，水印在设置的时间范围内出现。 |
| 从片头开始（正向）           | Y    | 表示水印从视频时间增长方向开始。                             |
| 开始时间 <br />（wmPos）     | Y    | 指定图片或文字水印显示的起始时间，单位：秒。                 |
| 持续时间<br />（wmDuration） | N    | 指定图片或文字水印显示的持续时间，单位：秒                   |
| 调整到视频范围内             | N    | 水印设置的开始时间在视频范围内，若设置持续时间后超出了视频范围，是否自动调整到视频范围内。<br /><br />默认关闭，不处理；开启，则调整到视频范围内；<br /><br />**示例**：视频时长60s，水印开始时间0s，持续时间65s，启用后，会自动将持续时间调整到视频范围内。 |

#### **2).从片尾开始（反向）**

![img](https://dora-doc.qiniu.com/WX20210208-145055%402x.png)

| 参数                               | 必填 | 说明                                                         |
| ---------------------------------- | ---- | ------------------------------------------------------------ |
| 水印时间线                         | N    | 默认关闭，水印在视频整个时段内出现；<br />开启后，水印在设置的时间范围内出现。 |
| 从片尾开始（反向）                 | Y    | 表示水印以视频结束时间为起始点。                             |
| 持续时间<br />（wmDuration）       | Y    | 指定图片或文字水印显示的持续时间，单位：秒                   |
| 调整到视频范围内<br />(wmShortest) | N    | 水印设置的开始时间在视频范围内，若设置持续时间后超出了视频范围，是否自动调整到视频范围内。<br /><br />默认关闭，不处理；开启，则调整到视频范围内；<br /><br />**示例**：视频时长60s，水印从片尾开始加，持续时间65s，启用后，会自动将持续时间调整到视频范围内。 |


**示意图**

如需水印右下显示，设置水印颜色、大小。

![](https://dora-doc.qiniu.com/WX20201214-111626.png)
​
## 水印锚点参数表

```
NorthWest     |     North      |     NorthEast
              |                |    
              |                |    
--------------+----------------+--------------
              |                |    
West          |     Center     |          East 
              |                |    
--------------+----------------+--------------
              |                |    
              |                |    
SouthWest     |     South      |     SouthEast
```
