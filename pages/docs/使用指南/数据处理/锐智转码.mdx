支持锐智转码，可根据视频场景内容自适应进行转码，在不损失画质的情况下（肉眼无感知）以总体更低的码率进行转码，可通过[七牛公众号->解密七牛云锐智转码技术](https://mp.weixin.qq.com/s/LLWLDE_9jhY6GqRMHl9qaw)，了解更多内容。

本文为您介绍锐智转码的简介，如何通过上传自动触发方式、控制台、API发起转码，并为您详细介绍锐智转码预设的参数。 


​
# **简介**

锐智高清的智能自适应目标是在不同场景下匹配最优的算法，追求最佳的收益效果。

- 以在线教育场景为例，屏幕录制为视频主要内容，针对屏幕内容采用特定算法可取得有效的针对性提升；
- 秀场场景，算法会更倾向于人脸和细节上的优化；
- 体育场景，运动目标检测和去运动模糊是主要关注点。

![](https://dora-doc.qiniu.com/WX20201214-153149%402x.png)

**智能场景分类**

智能场景分类，可以适配更佳的算法提升压缩和画质效果。针对视频场景和复杂度进行两层分类，场景上包含：秀场、游戏、动漫、教育、体育、户外、影视、会议、交通等10多个类型；在部分场景上，会进一步做复杂度的分级。通过深度学习大量训练，目前CNN网络模型的准确度达到95%以上。

场景分类为自适应算法策略奠定基础，对于不同场景，适配的算法类别包括：

> - 编码压缩算法和工具的组合 
> -  前处理算法类别和参数 
> -  ROI感兴趣区域的算法 
> - 客观质量评价工具VMAF的较准 
> -  Per-Title参数的选取



**锐智转码功能特性**

- 视频处理：完善的转码与转封装]能力，进行丰富的媒体格式转换。
- 音频处理：音频转码、音频抽取、音频替换、音频混音等。
- 水印：支持图片水印、文字水印，并且支持多水印添加。
- 多清晰度预设：标清、全高清、2k、4k等多个预置清晰度，提供最佳经验值，降低接入门槛。
- 片段截取：是指裁剪视频的某一段，输出成一个新视频。常用于截取视频中精彩或关键的内容。
- 视频马赛克：在视频中添加马赛克，满足遮标需求。




**使用场景**

- 降低存储、分发成本： 保证在相同画质质量的前提下，调整视频码率、提高视频压缩率、减小文件体积，从而减少播放卡顿并节省存储和流量费用。

- 多终端设备适配：适配PC、TV以及移动终端等多平台播放。

- 多种网络环境适配：多种网络环境适配：不同网络带宽的用户选择最佳码率，流畅播放

- 水印添加：在视频上添加企业Logo、电视台台标、用户ID或昵称等标志性信息，用于品牌宣传或者宣示当前视频的版权归属。

  ​

**不转码的情况**

- 如果用户已经自己在本地进行过转码操作，不需要进行二次处理，也可以选择不转码。
- 在短视频等场景下，视频通常已在端上进行过拍摄和压缩，已经具备多终端播放的能力。此时可以不进行转码。




​
# **发起转码的方式**

- 通过上传自动触发方式转码

  - 登录 **[智能多媒体]()**，点击左侧【导航栏->任务触发器】，进入任务触发器列表页。

  - 创建一个锐智转码的任务触发器，具体操作，请参考 [任务触发器](https://developer.qiniu.com/dora/manual/6489/task-workflow)

    ![img](https://dora-doc.qiniu.com/WX20201210-165435.png)

  - 可根据配置的回调，将转码后的任务处理结果回调给用户。

- 通知指定文件发起转码

  - 用户对 bucket 中已存在的多媒体文件发起转码。

  - 登录 **[智能多媒体]()**，点击左侧【导航栏->任务】，进入添加任务页面。选择需要使用的工作流（或者自定义工作流），单击**保存**，即可触发转码，具体操作，请参考 [添加任务](https://developer.qiniu.com/dora/manual/6488/task-01)

    ![img](https://dora-doc.qiniu.com/WX20201210-172128.png)

- 通过API发起转码

  - 通过调用 API 手动发起转码处理任务请求。该操作常用于工作流无法满足用户场景时，需用户自己判断业务逻辑，使用API提交转码任务。例如：并不是所有的视频都需要转码，不同视频需要设置不同的转码配置。



​
# **锐智转码参数说明**

在创建自定义预设时，需要自定义参数，如视频编码格式、视频码率、视频宽高、音频编码格式、音频码率等。下面对各类型参数的关键参数含义及取值范围进行说明。



下面对各类型参数的关键参数含义及取值范围进行说明。

#### **1. 封装格式**

| 中文名                | 参数名称                 | 必填                                                         | 说明                                                         |
| --------------------- | ------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 封装格式            | `<Format>`          | Y            | 封装格式支持以下四种：mp4、hls、flv   |


#### **2. 视频参数**

| 中文名           | 参数名称                 | 必填 | 说明                    |
| ---------------- | ------------------------ | ---- | -------------------------- |
| 启用锐智转码     | `/avsmart/<avsmart> `      | Y    | 锐智转码预设，默认启用。                                                 |
| 禁用视频         | `/vn/<VideoNo>`          | N    | 是否去除视频流，默认保留，勾选禁用视频后，会去除视频流。     |
| 编码格式         | `/vcodec/<VideoCodec>`   | N    | 视频编码格式，支持 H.264。                                   |
| 视频增强         | `/smtEnhance/<Enhance>`    | N    | 视频增强，即AI视频前处理是提升画质的关键所在。由多个算法模块组成，每个模块负责某种画质增强的方向，包括：去编码脏效应、去噪、去毛刺、锐化、对比度增强、饱和度增强、去模糊等等。 |
| 分辨率           | `/s/<Resolution>`        | N    | 0、指定目标视频分辨率，格式为宽 x 高 ，长边取值范围[20,3840]的整数，短边取值范围[20,2160]的整数。1、w、h 都为空时，则和原视频保持一致。2、`w`为空，`h`不为空，则按`h`的值对原视频等比例缩放。`3、w`不为空，`h`为空时，则按`w`的值对原视频等比例缩放。`4、w`、`h`都不为空时，则根据`w`、`h`来缩放。 |
| 在播放器中宽高比 | `/aspect/<Aspect>`       | N    | 该参数为视频在播放器中显示的宽高比，格式为`<width>:<height>`。例如：取值`3:4`表示视频在播放器中播放是`宽:高`=`3:4`（注：此处取值仅为体现演示效果)。 |
| 视频按比例缩放   | `/autoscale/<Autoscale>` | N    | 0、配合分辨率参数使用。1、指定为1时，把视频按原始比例缩放到分辨率指定的矩形框内。2、指定为2时，把视频按分辨率中指定的比例添加黑框后，再等比例缩放到分辨率指定到矩形框内。3、关闭时，会强制缩放到对应分辨率，可能造成视频变形。 |
| 帧率             | `/r/<FrameRate>`         | N    | 0、视频帧率，每秒显示的帧数，单位：赫兹（Hz），常用帧率：24，25，30等，帧率限制大小在 [1，60]。1、取值范围为 `[1,30]的整数，按照普通帧率进行收费。`2、取值范围为 (30 , 60]的整数，按照高帧率进行收费，[参考价格详情](<https://www.qiniu.com/prices?source=dora>)。 |
| 关键帧最大间隔   | `/gop/<GroupOfPictures>` | N    | GOP参数，即视频流关键帧间的间隔帧数，取值[1,3000]的整数；默认为0表示采用指定视频编码格式的默认GOP值，例如libx264格式默认GOP值为250。GOP取值过小会影响视频编码压缩率，码率变大，过大会使图像群组的时长跨度过大，影响播放随机性，故一般建议采用默认值。 |

#### **2.1 视频高级参数**

| 类别         | 中文名     | 参数名称                           | 必填 | 说明                                     |
| ------------ | ---------- | ---------------------------------- | ---- | ------------------------------------------------------------ |
| 片段截取     | 开始时间   | `/ss/<SeekStart>`                  | N    | 1、用于音视频截取，从一段音视频中截取一段音视频；2、指定音视频截取的开始时间，单位：秒，支持精确到毫秒，例如3.345s。 |
|              | 截取长度   | `/t/<Duration>`                    | N    | 1、用于视频截取，从一段视频中截取一段视频；2、指定音视频截取的长度，单位：秒，支持精确到毫秒，例如1.500s。 |
| 视频旋转     | 顺时针旋转 | `/rotate/<Degree>`                 | N    | 指定顺时针旋转的度数，可取值为`90`、`180`、`270`、`auto`，默认为 auto。 |
|              | 视频翻转   | `/flip/<Flip>`                     | N    | 视频翻转, 水平翻转 `horizontal`, 垂直翻转 `vertical。`       |
| 视频马赛克   | 马赛克位置 | `/mosaicGravity/<MosaicGravity>`   | N    | 马赛克的位置，参考锚点参数表，默认值为`NorthEast`（右上角）  |
|              | 马赛克位置 | `/mosaicOffsetX/<MosaicOffsetX>`   | N    | 马赛克位置的相对横向偏移量 `，正数则向右偏移，负数向左偏移。` |
|              | 马赛克位置 | `/mosaicOffsetY/<MosaicOffsetY>`   | N    | 马赛克位置的相对纵向偏移量 `，正数则向下偏移，负数向上偏移。` |
|              | 马赛克大小 | `/mosaicSize/<MosaicSize>`         | N    | 马赛克区域大小，即指定马赛克的宽和高。                       |
|              | 起始时间   | `/mosaicStart/<MosaicStart>`       | N    | 马赛克起始时间， 默认为0。                                   |
|              | 持续时间   | `/mosaicDuration/<MosaicDuration>` | N    | 马赛克持续时间， 默认直到片尾                                |
| 清除metadata |            | `/stripmeta/<StripMeta>`           | N    | 是否清除文件的`metadata`，1为清除，0为保留。      |

#### **3. 音频参数**

| 中文名   | 参数名称               | 必填 | 说明                                                         |
| -------- | ---------------------- | ---- | ------------------------------------------------------------ |
| 禁用音频 | `/an/<AudioNo>`        | N    | 是否去除音频流，0为保留，1为去除。默认值为0。                |
| 编码格式 | `/acodec/<AudioCodec>` | N    | 1、音频编码格式，支持 MP3 、AAC 、AAC_HE。2、为空时，与源视频一致 |
| 声道数   | `/ac/<ChannelNum>`     | N    | 1、音频声道数量，单位：整数值，输出文件的声道数不能大于输入源的声道数量；2、目前 acodec 为 aac 时，支持的声道数量为 1、2、4、5、6、8，其他数值不合法；3、acodec 为mp3 时，支持的声道数量为 1、2，其他数值不合法。备注：当编码格式为空时，声道数也为空，默认与源视频一致。 |
| 码率     | `/ab/<BitRate>`        | N    | 1、音频码率，单位：比特每秒（kbit/s），常用码率：64k，128k，192k，256k，320k等，音频码率限制大小为 [1，600]，支持到小数点后一位。2、在不改变音频编码格式时，若指定码率大于原音频码率，则使用原音频码率进行转码。3、勾选【强制使用】，可以强制指定码率进行转码。 |
| 采样率   | `/ar/<SamplingRate>`   | N    | 1、音频采样频率，单位：赫兹（Hz），取值为整数。2、常用音频采样频率有 8000, 11025、12000、16000、22050、24000、32000、44056、44100、47250、48000、50000、64000、88200、96000 等。 |


#### **3.1 音频高级参数**

| 类别           | 中文名               | 参数名称                                          | 必填 | 说明                                                         |
| -------------- | -------------------- | ------------------------------------------------- | ---- | ------------------------------------------------------------ |
| 音频混音       | 混音文件             | `/amix/<AmixURL>`                                 | N    | 1、期望混音的音视频文件；2、源音视频、混音文件都仅支持单音轨；3、混音的两个音频的 channel 数必须一致。备注：不支持与音频替换同时使用。 |
|                | 开始混音时间         | `/amixOffset/<AmixOffset>`                        | N    | 混音效果起始位置，相对于混音后视频起始位置计算，单位为秒，精确到毫秒，默认取0，即混音后音视频从起始位置起有混音效果 |
|                | 混音文件截取开始时间 | `/amixStart/<AmixStart>`                          | N    | 1、用于混音文件长度截取；2、混音文件截取的开始时间，单位为秒，精确到毫秒；3、默认值为0，即混音文件从起始混入源音视频。 |
|                | 混音文件截取时长     | `/amixDuration/<AmixDuration>`                    | N    | 1、用于混音文件长度截取；2、混音文件截取的时长，单位为秒，精确到毫秒;3、默认为目标混音文件音轨原始长度，即全部混入源音视频。 |
| 音频替换       | 替换文件             | `/multiArep/<MultiAudioReplaceURL>`               | N    | 用于替换原视频音频的音频文件。备注：不支持与音频混音同时使用。 |
|                | 开始替换时间         | `/multiArepOffset/<MultiAudioReplaceOffset>`      | N    | 音频替换起始位置，相对于原视频音频起始位置计算，单位为秒，精确到毫秒，默认取0 |
|                | 替换文件截取开始时间 | `/multiArepStart/<MultiAudioReplaceStart>`        | N    | 1、用于替换文件长度截取；2、替换文件截取的开始时间，单位为秒，精确到毫秒；3、默认值为0，即替换文件从起始混入源音视频。 |
|                | 替换文件截取时长     | `/multiArepDuration /<MultiAudioReplaceDuration>` | N    | 目标音频文件截取的时长，单位为秒，精确到毫秒，默认为目标音频文件音轨原始长度，即全部目标音频替换原视频音频。 |