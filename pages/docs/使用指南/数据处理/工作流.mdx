**工作流**，定义处理一个对象文件的所有计算能力（如转码、截图、视频拼接、内容审核等）各类处理，支持串行、并行操作，丰富计算处理的组合编排能力，让用户可以自定义编排成一个完整的处理流程。
   ​
不仅可以针对原片进行处理，还可对中间处理结果进行处理。本文为您介绍配置工作流的操作步骤。


   ​
# **新建工作流**
1.登录【智能多媒体控制台】，进入【导航栏->工作流】页面。

2.点击右上角的 **新建工作流** 按钮，配置工作流。

3.设置 **工作流** 信息

**i. 名称**，必填项，仅支持中文、英文、数字、_、-、. 六种格式，长度不能超过32个字符，名称不可重复。
**ii. 输入源过滤**，非必填项。

- 默认为【不启用】，不启用时，不会过滤输入源类型。

- 点击【启用】，启用后会按照指定输入源类型进行任务处理。

  ![img](https://dora-doc.qiniu.com/WX20210125-142634.png)

  > 可以过滤以下类型的输入源：
  >
  > - 音/视频
  > - 视频
  > - 音频

 **iii.工作流节点配置**

  - 从开始单击【+】键，添加处理节点，支持的有：普通转码、锐智转码、视频拼接、截图、音视频信息、执行条件、输出。

    ![img](https://dora-doc.qiniu.com/WX20201207-155846.png)

  - 添加 **普通转码** 节点

    A.方式一：选择 **普通转码->预设集** 。

    ![img](https://dora-doc.qiniu.com/WX20210208-151024%402x.png)

    > - 选择普通转码预设：必填项，分为系统预设、自定义预设
    > - 水印设置：选择是否对视频设置水印；启用后，可以设置多个水印，上限10个
    > - 点击【关闭】，节点配置完成

     B.方式二：选择 **普通转码->自定义预设** 

    ![img](https://dora-doc.qiniu.com/WX20201208-095932.png)

    > 当预设参数无法满足您的需求时，可以直接通过自定义的方式来配置节点。
    >
    > - **转码设置**：跟普通转码预设的配置一样，[参数详情](https://developer.qiniu.com/dora/manual/6492/transcoding-preset)
    > - **水印设置**：默认关闭，点击 **开启** 后，可自定义水印参数；可以设置多个水印，上限10个。
    >  ![img](https://dora-doc.qiniu.com/WX20210208-151223%402x.png)
    > - 点击【关闭】，节点配置完成

    ​

  - 添加 **锐智转码** 节点

    A.方式一：选择 **锐智转码->预设集** 

    ![img](https://dora-doc.qiniu.com/WX20201208-110757.png)

    > - 选择锐智转码预设：必填项
    > - 水印设置：选择是否对视频设置水印；启用后，可以设置多个水印，上限10个
    > - 点击【关闭】，节点配置完成

    B.方式二：选择 **锐智转码->自定义预设** 

    ![img](https://dora-doc.qiniu.com/WX20201208-110849.png)

    > 当预设参数无法满足您的需求时，可以直接通过自定义的方式来配置节点。
    >
    > - **转码设置**：跟锐智转码预设的配置一样，[参数详情](https://developer.qiniu.com/dora/manual/6850/perceptive-transcoding-preset)
    > - **水印设置**：默认关闭，点击 **开启** 后，可自定义水印参数；可以设置多个水印，上限10个。
    >  ![img](https://dora-doc.qiniu.com/WX20210208-151500%402x.png)
    > - 点击【关闭】，节点配置完成

    ​

  - 添加 **音视频信息** 节点

    - 该节点只能在第一个节点添加。

      以 **音视频信息->执行条件->转码** 为例（对>=720p的源视频做转码处理），如下图所示。

    ![img](https://dora-doc.qiniu.com/WX20201208-113743.png)

  - 添加 **执行条件** 节点

    作为下一节点处理的前置判断条件。执行条件表示父节点满足什么条件，才能触发下一节处理。用户可根据需要配置执行条件，如下图所示。

    ![img](https://dora-doc.qiniu.com/WX20201208-113909.png)

    > 判断 **视频分辨率**，是否做下一步处理
    >
    > - 规则：仅支持判断 **分辨率 **
    >
    > - 操作符：>、<、=、>=、<=、!=
    >
    > - 值：格式为宽 x 高，长边取值范围[20,3840]的整数，短边取值范围[20,2160]的整数。
    >
    >   a. 【宽×高，允许1个为空，当只有1个有值时】
    >
    >   ​    1）如设置 >=1280(宽），则判断视频 **宽** 是否在这个范围内，高度不比较
    >   ​    2）如设置 =1280(宽），则判断视频宽=1280，高度不比较
    >
    >    b. 【宽、高都有值时】
    >
    >   ​     如设置 >=1280×720(宽×高)，则判断视频 **宽and高** 是否都在这个范围内，例如：1280×680 不在该范围

    ​
 - 添加 **视频审核** 节点

    - 该节点只能在第一个节点添加。

      以 **下图的工作流** 为例（对疑似or违规的源视频进行封禁，并对正常源视频进行普通转码处理），如下图所示。

    ![img](https://dora-doc.qiniu.com/WX20210223-114858%402x.png)

 - 添加 **执行条件** 节点

    作为下一节点处理的前置判断条件。执行条件表示父节点满足什么条件，才能触发下一节处理。用户可根据需要配置执行条件，如下图所示。

    ![img](https://dora-doc.qiniu.com/WX20210323-161413%402x.png)

    > 父节点为【视频审核】，执行条件介绍如下：
    >
    > | 执行条件                 | 条件描述                                             |
    > | ------------------------ | ---------------------------------------------------- |
    > | 视频审核结果为【正常】   | 父节点审核结果为正常时，执行下一节点处理             |
    > | 视频审核结果为【违规】   | 父节点审核结果为违规时，执行下一节点处理             |
    > | 视频审核结果为【疑似】   | 父节点审核结果为疑似时，执行下一节点处理             |
    > | 视频审核结果不是【正常】 | 父节点审核结果为【违规】或【疑似】，执行下一节点处理 |
    > | 视频审核结果不是【违规】 | 父节点审核结果为【正常】或【疑似】，执行下一节点处理 |


- 添加 **封禁** 节点

    该节点仅适用于视频审核的场景，当对源视频进行视频审核，结果为【违规】or【违规】时，可以封禁源视频，存储空间的源文件被封禁后，将无法公开访问，可以帮助用户规避风险；对审核结果为【正常】的资源，进行其他处理（比如转码），可以减少不必要的处理开销。

    ![img](https://dora-doc.qiniu.com/WX20210323-161946%402x.png)
  ​

  - 添加 **视频拼接** 节点

    A.方式一：选择 **视频拼接->预设集** 

    ![img](https://dora-doc.qiniu.com/WX20201208-143600.png)

    > - 选择视频拼接预设：必填项
    > - 点击【关闭】，节点配置完成

    B.方式二：选择 **视频拼接->自定义预设** 

    ![img](https://dora-doc.qiniu.com/WX20201208-143514.png)

    > 当预设参数无法满足您的需求时，可以直接通过自定义的方式来配置节点。
    >
    > - **参数设置**：跟视频拼接预设的配置一样，[参数详情](https://developer.qiniu.com/dora/manual/6851/video-stitching-preset)
    > - 点击【关闭】，节点配置完成

  - 添加 **截图** 节点

    A.方式一：选择 **截图->预设集** 

    ![img](https://dora-doc.qiniu.com/WX20201208-143600.png)

    > - 选择截图预设：必填项
    > - 点击【关闭】，节点配置完成

    B.方式二：选择 **截图->自定义预设** 

    ![img](https://dora-doc.qiniu.com/WX20201208-143514.png)

    > 当预设参数无法满足您的需求时，可以直接通过自定义的方式来配置节点。
    >
    > - **参数设置**：跟截图预设的配置一样，[参数详情](https://developer.qiniu.com/dora/manual/6494/screenshot-of-the-preset)
    > - 点击【关闭】，节点配置完成

    ​

  - 添加 **输出** 节点

    对处理结果进行保存时，需要单独配置。该节点为工作流最终态，不同的处理类型的输出会有差异，示例如下。

    **1）单输出**，普通转码->mp4。

    ![img](https://dora-doc.qiniu.com/WX20201208-100531.png)

    > - **输出空间**：必填项，处理完成后新生成文件将存储在该空间中。
    >
    > - **输出文件名**，支持以下两种命名方式：
    >
    >   a.  **前缀+后缀** ： 至少填写1个
    >
    >   b. **魔法变量**：点击【切换自定义文件名】
    >
    >   - 支持[魔法变量](https://developer.qiniu.com/dora/6502/upload-video-files)或自定义字符串。魔法变量引用格式为 {{.var}} ，魔法变量仅支持 bucket、key、fname、fprefix、ext、count。
    >   - 注：**count** 为六个占位符的数字串，不足位的填充前导零即`%06d`，如 `000001`。最后得到类似：qiniu000000,qiniu000001,……,qiniu000006命名的ts文件。 
    >
    >   ​

    **2）多输出**，普通转码->m3u8。

    ![img](https://dora-doc.qiniu.com/WX20201208-115255.png)

    > - **输出空间**：必填项，处理完成后新生成文件将存储在该空间中。
    >
    > - **输出文件名**，支持以下两种命名方式：
    >
    >   a.  **前缀+后缀** ： 至少填写1个
    >
    >   b. **魔法变量**：点击【切换自定义文件名】
    >
    >   - 支持[魔法变量](https://developer.qiniu.com/dora/6502/upload-video-files)或自定义字符串。魔法变量引用格式为 {{.var}} ，魔法变量仅支持 bucket、key、fname、fprefix、ext、count。
    >   - 注：**count** 为六个占位符的数字串，不足位的填充前导零即`%06d`，如 `000001`。最后得到类似：qiniu000000,qiniu000001,……,qiniu000006命名的ts文件。 

    ​

  **iv. 删除工作流节点**

  点击 ”删除“ 键，删除处理节点。删除父节点，子节点会一起被删除，如下图所示：

  - 删除前

  ![img](https://dora-doc.qiniu.com/WX20201207-170009.png)

  - 删除后

    ![img](https://dora-doc.qiniu.com/WX20201207-170104.png)

  **v. 修改工作流节点配置**

  单击 ‘’节点‘’，开始修改。以音视频信息为例，如下图所示：

  ![img](https://dora-doc.qiniu.com/WX20201207-164939.png)

  ​

4. 工作流编排方式说明，【串行】&【并行】

   - **并行** 的工作流，输入源默认为 **源视频**，如下所示。![img](https://dora-doc.qiniu.com/WX20201208-145138.png)

   - **串行** 的工作流，第一个父节点的输入源为  **源视频**，子节点的输入源示例和说明如下。

     ![img](https://dora-doc.qiniu.com/WX20201208-145652.png)





| 父节点类型         | 输入源                                                       | 下一节点可选处理类型                                         |
| ------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 普通转码           | 默认处理结果，作为下一节点输入源 **注意：** 当转码格式为 m3u8 时，不支持继续添加处理节点 | -普通转码<br />-锐智转码<br />-截图<br />-视频拼接<br />-视频审核<br />-输出 |
| 锐智转码           | 默认处理结果，作为下一节点输入源 **注意：** 当转码格式为 m3u8 时，不支持继续添加处理节点 | -普通转码<br />-锐智转码<br />-截图<br />-视频拼接<br />-视频审核<br />-输出 |
| 视频拼接           | 默认处理结果，作为下一节点输入源                             | -普通转码<br />-锐智转码<br />-截图<br />-视频拼接<br />-视频审核<br />-输出 |
| 音视频信息         | 默认处理结果，作为下一节点输入源备注：只能在第一个节点添加【音视频信息】节点，考虑到中间结果没有saveas，就不能 avinfo。 | - 条件判断<br />- 输出                                       |
| avinfo→ 执行条件   | 输入源作为下一节点处理的前置判断条件，当前支持的有：1、音视频元信息的执行条件： 分辨率。2、条件描述为：判断视频分辨率范围，对范围内的视频做下一步处理。 | -普通转码<br />-锐智转码<br />-截图<br />-视频拼接<br />-视频审核<br />-输出 |
| 截图               | 当前版本，处理结果不支持作为下一节点的输入源                 | 输出                                                         |
| 视频审核           | 默认处理结果，不可作为下一节点输入源，下一节的输入源默认为【源视频】备注：只能在第一个节点添加【视频审核】节点 | - 执行条件<br />- 输出                                       |
| 视频审核→ 执行条件 | 作为下一节点处理的前置判断条件，当前支持的有：视频审核结果为【正常】视频审核结果为【违规】视频审核结果为【疑似】视频审核结果不是【正常】视频审核结果不是【违规】视频审核结果不是【疑似】 | -普通转码<br />-锐智转码<br />-截图<br />-视频拼接<br />-视频审核<br />-输出 |
| 封禁               |                                                              | 结束节点                                                     |

5.  设置 **作业配置** 信息

   ![img](https://dora-doc.qiniu.com/WX20201208-092615.png)

   > - 任务通知：选填项，支持以回调方式将消息推送到指定URL。  [查看回调内容详情]()
   > - 队列：选填项，任务会进入队列中进行排队，根据提交顺序依次处理。

6. 单击【保存】完成配置。

   即可对多媒体文件，使用工作流进行处理。


   ​

# **工作流列表**

登录 **[智能多媒体]()**，点击左侧【导航栏->工作流】，进入工作流列表页。

![img](https://dora-doc.qiniu.com/WX20201207-155904.png)

**列表操作如下：**
> - 创建任务：可以直接使用工作流，快捷创建任务
> - 创建任务触发器：可以直接使用工作流配置，快速创建任务触发器
> - 复制：复制当前工作流的所有配置信息，工作流名称需要重新命名
> - 编辑：全部内容可修改
> - 删除

   