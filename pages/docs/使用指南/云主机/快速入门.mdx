
# 使用流程
通常，从购买PolarDB（创建新集群）到可以开始使用，您需要完成如下操作。

1. 创建POLARDB数据库集群
2. 设置集群白名单
3. 创建数据库账号
4. 查看连接地址
5. 连接数据库集群

其中，这里示例为创建POLARDB MySQL数据库集群，POLARDB for PostgreSQL数据库集群方法类似。

# 步骤一：创建POLARDB MySQL数据库集群

一个集群包含一个主节点以及最多15个只读节点，只读节点最少一个，用于提供双主（Active-Active）高可用。节点是虚拟化的数据库服务器，节点中可以创建和管理多个数据库。
创建时参数说明如下：
<table><tr><th>控制台区域</th><th>参数</th><th>说明</th></tr><tr><td rowspan="2">基本配置</td><td>地域和可用区</td><td>集群所在的城市和机房</td></tr><tr><td>网络</td><td>选择VPC网络和VPC交换机，如吧</td></tr><tr><td rowspan="3">配置</td><td>兼容性</td><td>兼容MySQL 8.0/MySQL 8.0/PostgreSQL 11<br>都完全兼容</td></tr><tr><td>节点规格</td><td>按需选择。所有PolarDB节点均为独享型，性能稳定可靠。</td></tr><tr><td>节点个数</td><td>无需选择。系统将自动创建一个与主节点规格相同的只读节点。如果主节点故障，系统会自动将只读节点切换为新的主节点，并重新生成一个只读节点。</td></tr></table>


# 步骤二：设置集群白名单
创建PolarDB MySQL数据库集群后，您需要设置PolarDB集群的IP白名单，并创建集群的初始账号，才能连接和使用该集群。

## 概要
设置集群白名单包括以下两种操作：
- 设置IP白名单
添加IP地址，允许这些IP地址访问该集群。 默认的IP白名单只包含默认IP地址127.0.0.1，表示任何设备均无法访问该集群。只有已添加到IP白名单中的IP地址才可以访问该集群。

- 设置安全组
QVM安全组是一种虚拟防火墙，用于控制安全组中的QVM实例的出入流量。在PolarDB集群白名单中添加QVM安全组后，该安全组中的QVM实例就可以访问PolarDB集群。

## 配置路径
云主机服务PolarDB控制台 -> 基本信息 -> 配置与管理 -> 集群白名单。

然后可以配置已有白名单或新增IP白名单分组。

## 注意事项
- 默认情况下，IP白名单只包含IP地址127.0.0.1，表示任何IP地址均无法访问该数据库集群。
- 若将IP白名单设置为%或者0.0.0.0/0，表示允许任何IP地址访问数据库集群。该设置将极大降低数据库的安全性，如非必要请勿使用。
- PolarDB暂不支持自动获取VPC中的QVM内网IP以供您选择，请手动填写需要访问PolarDB的QVM内网IP。
- 您可以同时设置IP白名单和QVM安全组。IP白名单中的IP地址和安全组中的QVM实例都可以访问该PolarDB集群。
- 目前仅PolarDB MySQL支持设置安全组，最多可以添加3个安全组。
- 目前支持创建50个IP白名单，所有IP白名单累积支持添加1000个IP地址或地址段。

# 步骤三：创建数据库账号
POLARDB for MySQL支持两种数据库账号：高权限账号和普通账号。区分如下：

|账号类型|说明|
|---|---|
|高权限账号|<ol><li>只能通过控制台创建和管理。<li>一个集群只能**有一个高权限账号**，可以管理所有普通账号和数据库。<li>开放了更多权限，可满足个性化和精细化的权限管理需求，例如可按用户分配不同表的查询权限。<li>拥有集群中所有数据库的所有权限。<li>可以断开任意账号的连接。|
|普通账号	|<ol><li>可以通过控制台或者SQL语句创建和管理。<li>一个集群可以创建多个普通账号，具体的数量与数据库内核有关 。<li>需要手动给普通账号授予特定数据库的权限。<li>普通账号不能创建和管理其他账号，也不能断开其他账号的连接。|


## 账号参数

|参数|	说明|
|---|---|
|账号名|填写账号名称。要求如下：<ol><li>以小写字母开头以字母或数字结尾；<li>由小写字母、数字或下划线组成；<li>长度为2~16个字符。不能使用某些预留的用户名，如root、admin。|
|账号类型	|高权限账号或者普通账号|
|授权数据库（普通账号）	|为该账号授予一个或多个数据库的权限。本参数也可以留空，在创建账号后再给账号授权。<ol><li>从左侧选中一个或多个数据库，单击向右的箭头添加到右侧。<li>在右侧框中，为数据库选择读写、只读或仅DML权限。|
|密码	|<ol><li>由大写字母、小写字母、数字或特殊字符组成，至少包含其中三类。<li>长度为8~32个字符。<li>特殊字符为!@#$%^&*()_+-=。|
|备注|备注该账号的相关信息，便于后续账号管理。|


# 步骤四：查看连接地址
在连接PolarDB集群时，您需要填写PolarDB集群的连接地址。PolarDB提供了集群地址和主地址。
![](https://dn-odum9helk.qbox.me/FhCFst_m9QK_vKk5SU3vdDly-Zrw)
	
## 集群地址和主地址
<table><tr><th>地址类型</th><th>地址说明</th><th>支持的网络类型</th><th>查看方式</th></tr><tr><td>集群地址（推荐）</td><td>应用程序只需连接一个集群地址，即可连接到多个节点。带有读写分离功能，写请求会自动发往主节点，读请求会自动根据各节点的负载发往主节点或只读节点。</td><td rowspan="2">私网和公网</td><td rowspan="2">1. 找到目标集群，单击集群的ID。<br>2. 在访问信息区域查看。</td></tr><tr><td>主地址</td><td>总是连接到主节点，支持读和写操作。当主节点发生故障时，主访问地址会自动切换到新的主节点。</td></tr></table>




# 步骤五：连接数据库集群

连接PolarDB MySQL主要又以下两种方式：
1. 使用命令行连接集群
2. 使用客户端连接集群

由于白名单设置中只有默认地址127.0.0.1。127.0.0.1表示禁止任何IP地址访问PolarDB集群。因此需在白名单中添加对端的IP地址才可连接。

## 使用命令行连接集群
如果您的服务器安装了MySQL，可以通过命令行连接PolarDB MySQL数据库集群，连接方式如下：

```
mysql -h<连接地址> -P<端口> -u<用户名> -p<密码> -D<数据库>
```

## 使用客户端连接集群
您可以使用任何通用的客户端连接PolarDB集群。本文以[HeidiSQL（点击下载）](https://www.heidisql.com/?spm=a2c4g.11186623.2.16.6d531864Ir4suQ)为例。
1. 启动HeidiSQL客户端。
2. 在左下角单击新建。

![](https://dn-odum9helk.qbox.me/Fp0wRwUnMN-oA2Faizy3olMLyszw)


参数如下：

|参数|	说明|
|---|---|
|网络类型	|连接数据库的形式。选择MariaDB or MySQL（TCP/IP）。|
|主机名/IP地址|	输入PolarDB集群的私网地址或公网地址。若您的客户端部署在QVM实例上，且QVM实例与要访问的PolarDB集群的地域、网络类型相同，请使用私网地址。例如QVM实例和PolarDB集群都是华东1的专有网络实例，使用私网地址连接能提供安全高效的访问。其它情况只能使用公网地址。|
|用户|	要访问PolarDB集群的账号名称。|
|密码	|以上账号的密码。|
|端口|	输入PolarDB集群的私网地址或公网地址对应的端口号。|

