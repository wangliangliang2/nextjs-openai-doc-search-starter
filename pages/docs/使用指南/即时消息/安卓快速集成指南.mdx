<link rel="stylesheet" type="text/css" href="https://docs.qnsdk.com/styles/doc-v4-api.css" />
<div class="rtc-doc rtc-doc-ast" id="rtc-doc">
    <div>
# Android SDK 集成说明
<h2 id="sdk-架构"><a href="#sdk-%E6%9E%B6%E6%9E%84" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>SDK 架构</h2>
<p>七牛IM SDK 底层使用 C++ 实现，各平台（Android、iOS、Linux等）在此基础上再行封装， 完成本地库的开发，以达到多平台复用的目的，并保持跨平台协议实现的一致性。 floo-android 作为供安卓使用的本地应用库，有两种 API 可供开发者使用，即低级 API 和高级 API，也即同步接口和异步接口。
低级 API (low-level)</p>
<p>同步调用接口，类名以Service结尾，为方便理解，下文说明中用 L/S 表示，其中 L 表示 Low-level, S 表示 Sync。
如前所述，floo-android 主体由 SWIG 框架自动生成。用 SWIG 生成的 Java 代码，通过 JNI 方式调用底层 C++ 类库，因此大部分接口均为同步，即调用接口后，完成后返回结果。
代码生成和转换的过程中，相关数据结构得以直接映射到底层类库，减少了内存拷贝，因此其性能接近于直接调用底层库。
同步方式的服务类如下：</p>
<ul>
<li>QNIMClient: SDK功能聚合类，包含了所有的service类、实现了网络事件监听接口</li>
<li>BMXChatRoomService: 聊天室管理 加入、退出、销毁、成员</li>
<li>BMXChatService: 消息发送、消息历史获取、会话列表</li>
<li>BMXUserService: 注册账号、登入、登出、我的设置</li>
<li>BMXRosterService: 好友列表、黑名单</li>
<li>BMXGroupService: 群管理（创建、解散、查找、设置、成员管理、邀请、申请、接受、拒绝）</li>
</ul>
<h3 id="高级-api-high-level"><a href="#%E9%AB%98%E7%BA%A7-api-high-level" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>高级 API (high-level)</h3>
<p>异步调用接口，类名以Manager结尾，为方便理解，下文用 H/A 表示，其中 H 表示 High-level, A 表示 Async。
考虑到开发者集成方便，我们也基于此类重新封装了高级 API，使用了更为友好的数据结构，并完成了异步封装。
简单来讲，相关调用会在子线程执行具体操作（例如：搜索好友），当前线程会直接返回不会阻塞。具体操作的结果则通过回调函数通知调用方，后者可以在其中处理 UI 刷新等业务逻辑。
异步方式的服务类如下：</p>
<ul>
<li>BaseManeger:Manger管理基础类</li>
<li>ChatManager:消息发送、消息历史获取、会话列表</li>
<li>chatRoomManager: 聊天室管理 加入、退出、销毁、成员</li>
<li>UserManager:注册账号、登入、登出、我的设置</li>
<li>RosterManager:好友列表、黑名单</li>
<li>BMXCallBack:无类型接口回调</li>
<li>BMXDataCallBack<t>: 泛型类型带数据回调</t></li>
</ul>
<h3 id="其他工具类"><a href="#%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7%E7%B1%BB" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>其他工具类</h3>
<ul>
<li>BMXGroupServiceListener:群事件监听</li>
<li>BMXUserServiceListener:用户事件监听</li>
<li>BMXRosterServiceListener:好友事件监听</li>
<li>BMXNetworkListener:网络事件监听接口，由QNIMClient实现</li>
<li>BMXConversation:会话</li>
<li>BMXMessage:消息</li>
<li>BMXGroup:群</li>
<li>BMXRosterItem花名册项（好友、陌生人、黑名单、前好友）</li>
<li>BMXUserProfile:用户信息</li>
</ul>
<h3 id="类库示意图如下"><a href="#%E7%B1%BB%E5%BA%93%E7%A4%BA%E6%84%8F%E5%9B%BE%E5%A6%82%E4%B8%8B" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>类库示意图如下</h3>
<pre><code>
<span></span>                                                 +<span class="hljs-comment">---&gt; BMXChatRoomService</span>
<span></span>                                                 |
<span></span>                                                 +<span class="hljs-comment">---&gt; BMXUserService</span>
<span></span>                                                 |
<span></span>                              +<span class="hljs-comment">---------------+  +---&gt; BMXChatService</span>
<span></span>                              |               |  |
<span></span>                          +<span class="hljs-comment">---+ 低级 API: L/S  +------&gt; BMXRosterService</span>
<span></span>                          |   |               |  |
<span></span>                          |   +<span class="hljs-comment">---------------+  +---&gt; BMXGroupService</span>
<span></span>                          |
<span></span>                          |
<span></span>                          |
<span></span>                          |
<span></span>                          |                         +<span class="hljs-comment">---&gt; BMXChatRoomManager</span>
<span></span>                          |                         |
<span></span>                          |                         +<span class="hljs-comment">---&gt; BMXUserManager</span>
<span></span>                          |   +<span class="hljs-comment">---------------+     |</span>
<span></span>+<span class="hljs-comment">----------------------+  |   |               |     +---&gt; BMXChatManager</span>
<span></span>|                      |  +<span class="hljs-comment">---+ 高级 API: H/A +-----+</span>
<span></span>| 七牛 IM SDK: Floo +<span class="hljs-comment">--+   |               |         +---&gt; BMXRosterManager</span>
<span></span>|                      |  |   +<span class="hljs-comment">---------------+     |</span>
<span></span>+<span class="hljs-comment">----------------------+  |                         +---&gt; BMXGroupManager</span>
<span></span>                          |
<span></span>                          |                       +<span class="hljs-comment">---&gt;  QNIMClient</span>
<span></span>                          |   +<span class="hljs-comment">----------------+  |</span>
<span></span>                          |   |                |  +<span class="hljs-comment">---&gt;  BMXSDKConfig</span>
<span></span>                          +<span class="hljs-comment">---+ Utility：工具类 +--+</span>
<span></span>                              |                |  +<span class="hljs-comment">---&gt;  BMXMessage</span>
<span></span>                              +<span class="hljs-comment">----------------+  |</span>
<span></span>                                                  +<span class="hljs-comment">---&gt;  BMXConversation</span>
<span></span>                                                  |
<span></span>                                                  +<span class="hljs-comment">---&gt;  BMXUserProfile</span>
<span></span>                                                  |
<span></span>                                                  +<span class="hljs-comment">---&gt;  BMXGroup</span>
<span></span>                                                  |
<span></span>                                                  +<span class="hljs-comment">---&gt;  BMXDevice</span>
<span></span></code></pre>
<h3 id="申请imappid"><a href="#%E7%94%B3%E8%AF%B7imappid" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>申请imAppId</h3>
<p>创建七牛账号，并创建七牛<a href="https://portal.qiniu.com/rtn/app">IMAppId</a></p>
<h3 id="导入sdk"><a href="#%E5%AF%BC%E5%85%A5sdk" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>导入SDK</h3>
<p>SDK导入可以选择aar格式或者jar+so格式
aar格式</p>
<p>下载aar文件到项目的libs目录
在build.gradle文件dependencies块中增加依赖，参照im-android源码使用最新版。
implementation (name:'qndroid-imsdk-1.0.0',ext:"aar")
jar+so格式</p>
<p>下载jar包和so库到项目的libs目录
在build.gradle文件中增加：implementation fileTree(dir: ‘libs’, include: [’*.jar’])
权限配置</p>
<pre><code>在AndroidManifest.xml 里增加加以下权限：
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.ACCESS_LOCATION_EXTRA_COMMANDS&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.WRITE_CONTACTS&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.CAMERA&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.READ_PHONE_STATE&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.CHANGE_WIFI_STATE&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.RECORD_AUDIO&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.VIBRATE&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.CALL_PHONE&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.READ_CONTACTS&quot;</span> /&gt;</span>
<span></span>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.WAKE_LOCK&quot;</span> /&gt;</span>
<span></span></code></pre>
<h2 id="快速集成"><a href="#%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>快速集成</h2>
<h3 id="qnimclient初始化"><a href="#qnimclient%E5%88%9D%E5%A7%8B%E5%8C%96" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>QNIMClient初始化</h3>
<h3 id="第一步-导入so库文件"><a href="#%E7%AC%AC%E4%B8%80%E6%AD%A5-%E5%AF%BC%E5%85%A5so%E5%BA%93%E6%96%87%E4%BB%B6" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>第一步 导入so库文件</h3>
<p>在 app 入口类中增加导入</p>
<pre><code><span class="hljs-keyword">static</span> {
<span></span>      System.<span class="hljs-built_in">loadLibrary</span>(<span class="hljs-string">&quot;floo&quot;</span>);
<span></span>  }
<span></span></code></pre>
<h3 id="第二步-初始化qnimclient"><a href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E5%88%9D%E5%A7%8B%E5%8C%96qnimclient" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>第二步 初始化QNIMClient</h3>
<pre><code><span class="hljs-comment">// 设置存储路径</span>
<span></span> <span class="hljs-type">String</span> <span class="hljs-variable">appPath</span> <span class="hljs-operator">=</span> AppContextUtils.getAppContext().getFilesDir().getPath();
<span></span> <span class="hljs-type">File</span> <span class="hljs-variable">dataPath</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(appPath + <span class="hljs-string">&quot;/data_dir&quot;</span>);
<span></span> <span class="hljs-type">File</span> <span class="hljs-variable">cachePath</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(appPath + <span class="hljs-string">&quot;/cache_dir&quot;</span>);
<span></span> dataPath.mkdirs();
<span></span> cachePath.mkdirs();
<span></span>
<span></span> <span class="hljs-comment">// 设置推送平台对应的ID,如果不需要推送传“MaxIM”</span>
<span></span> <span class="hljs-type">String</span> <span class="hljs-variable">pushId</span> <span class="hljs-operator">=</span> getPushId();
<span></span>
<span></span> <span class="hljs-comment">// 配置sdk config</span>
<span></span> <span class="hljs-type">BMXSDKConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BMXSDKConfig</span>(BMXClientType.Android, <span class="hljs-string">&quot;1&quot;</span>, dataPath.getAbsolutePath(),
<span></span>             cachePath.getAbsolutePath(), TextUtils.isEmpty(pushId) ? <span class="hljs-string">&quot;MaxIM&quot;</span> : pushId);
<span></span> config.setConsoleOutput(<span class="hljs-literal">true</span>);
<span></span> config.setLogLevel(BMXLogLevel.Debug);
<span></span>
<span></span> <span class="hljs-comment">// 初始化QNIMClient</span>
<span></span>  QNIMClient.init(conf);
<span></span></code></pre>
<p>注意： 如果使用高级API（异步调用方式），需要通过以下方法获取到服务类API的实体：</p>
<ul>
<li>ChatManager: 通过QNIMClient.getChatManager()获取到消息的manager对象。</li>
<li>UserManager: 通过QNIMClient.getUserManager()获取到用户的manager对象。</li>
<li>GroupManager: 通过QNIMClient.getGroupManager()获取到群相关的manager对象。</li>
<li>RosterManager: 通过QNIMClient.getRosterManager()获取到roster的manager对象。</li>
</ul>
<h3 id="注册用户"><a href="#%E6%B3%A8%E5%86%8C%E7%94%A8%E6%88%B7" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>注册用户</h3>
<pre><code>L/S: 同步调用传入BMXUserProfile对象引用，调用之后即可获取profile信息。
<span></span>   QNIMClient.<span class="hljs-built_in">signUpNewUser</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;sFo!slk1x&quot;</span>, new <span class="hljs-built_in">BMXUserProfile</span>());
<span></span>H/<span class="hljs-selector-tag">A</span>: 异步调用在BMXDataCallBack回调中返回profile实例。
<span></span>   QNIMClient.<span class="hljs-built_in">getUserManager</span>().<span class="hljs-built_in">signUpNewUser</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;sFo!slk1x&quot;</span>, new BMXDataCallBack&lt;BMXUserProfile&gt;(){
<span></span>        @Override
<span></span>        public void <span class="hljs-built_in">onResult</span>(BMXErrorCode bmxErrorCode, BMXUserProfile bmxUserProfile) {
<span></span>           //返回profile
<span></span>        }
<span></span>    });
<span></span></code></pre>
<h3 id="登录"><a href="#%E7%99%BB%E5%BD%95" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>登录</h3>
<p>两种登录模式：一种是普通手动登录，另一种是快速登录模式，手动登录包含了获取token和建立tcp连接的两个步骤，快速登录则将token缓存至本地。</p>
<pre><code>L/<span class="hljs-attr">S</span>: 通过返回值BMXErrorCode判断是否成功。
<span></span>    <span class="hljs-comment">// 参数：username(用户名) password(密码)</span>
<span></span>   QNIMClient.<span class="hljs-title function_">signInByName</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;sFo!slk1x&quot;</span>);
<span></span>   QNIMClient.<span class="hljs-title function_">fastSignInByName</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;sFo!slk1x&quot;</span>);
<span></span>H/<span class="hljs-attr">A</span>: 在BMXCallBack回调中返回BMXErrorCode 判断是否成功。
<span></span>   QNIMClient.<span class="hljs-title function_">getUserManager</span>().<span class="hljs-title function_">signInByName</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;sFo!slk1x&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title function_">BMXCallBack</span>(<span class="hljs-params"></span>){
<span></span>          <span class="hljs-meta">@Override</span>
<span></span>          <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onResult</span>(<span class="hljs-params">BMXErrorCode bmxErrorCode</span>) {
<span></span>
<span></span>          }
<span></span>    });
<span></span>   QNIMClient.<span class="hljs-title function_">getUserManager</span>().<span class="hljs-title function_">signInByName</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;sFo!slk1x&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title function_">BMXCallBack</span>(<span class="hljs-params"></span>){
<span></span>          <span class="hljs-meta">@Override</span>
<span></span>          <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onResult</span>(<span class="hljs-params">BMXErrorCode bmxErrorCode</span>) {
<span></span>
<span></span>          }
<span></span>    });
<span></span>获取会话列表
<span></span>
<span></span>L/<span class="hljs-attr">S</span>: 通过传入BMXConversationList对象引用,调用成功后即可获取会话列表。
<span></span>   BMXConversationList cl = QNIMClient.<span class="hljs-title function_">getChatService</span>().<span class="hljs-title function_">getAllConversations</span>();
<span></span>   <span class="hljs-keyword">for</span> (int i=<span class="hljs-number">0</span>; i&lt;cl.<span class="hljs-title function_">size</span>(); i++){
<span></span>       BMXConversation c = cl.<span class="hljs-title function_">get</span>(i);
<span></span>       <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">e</span>(<span class="hljs-string">&quot;conversation id:&quot;</span>,<span class="hljs-string">&quot;&quot;</span>+c.<span class="hljs-title function_">conversationId</span>());
<span></span>   }
<span></span>H/<span class="hljs-attr">A</span>: 在BMXDataCallBack回调中获取到会话列表。
<span></span>   QNIMClient.<span class="hljs-title function_">getChatManager</span>().<span class="hljs-title function_">getAllConversations</span>(<span class="hljs-keyword">new</span> BMXDataCallBack&lt;BMXConversationList&gt;() {
<span></span>       <span class="hljs-meta">@Override</span>
<span></span>        <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onResult</span>(<span class="hljs-params">BMXErrorCode bmxErrorCode, BMXConversationList list</span>) {
<span></span>          <span class="hljs-comment">//返回BMXConversation实例</span>
<span></span>          <span class="hljs-keyword">for</span> (int i=<span class="hljs-number">0</span>; i&lt;cl.<span class="hljs-title function_">size</span>(); i++){
<span></span>            BMXConversation c = cl.<span class="hljs-title function_">get</span>(i);
<span></span>            <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">e</span>(<span class="hljs-string">&quot;conversation id:&quot;</span>,<span class="hljs-string">&quot;&quot;</span>+c.<span class="hljs-title function_">conversationId</span>());
<span></span>          }
<span></span>        }
<span></span>   });
<span></span>断开连接
<span></span>
<span></span>L/<span class="hljs-attr">S</span>: 通过返回值获取到BMXErrorCode判断是否成功。
<span></span>QNIMClient.<span class="hljs-title function_">getUserService</span>().<span class="hljs-title function_">signOut</span>();
<span></span>H/<span class="hljs-attr">A</span>: 在BMXCallBack回调中根据BMXErrorCode判断。
<span></span>   QNIMClient.<span class="hljs-title function_">getUserManager</span>().<span class="hljs-title function_">signOut</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">BMXCallBack</span>(<span class="hljs-params"></span>){
<span></span>          <span class="hljs-meta">@Override</span>
<span></span>          <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onResult</span>(<span class="hljs-params">BMXErrorCode bmxErrorCode</span>) {
<span></span>            <span class="hljs-comment">//返回BMXErrorCode</span>
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="用户体系"><a href="#%E7%94%A8%E6%88%B7%E4%BD%93%E7%B3%BB" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>用户体系</h3>
<h3 id="添加好友"><a href="#%E6%B7%BB%E5%8A%A0%E5%A5%BD%E5%8F%8B" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>添加好友</h3>
<pre><code>L/S: 通过返回值获取到BMXErrorCode判断是否成功。 参数说明: rosterId <span class="hljs-built_in">reason</span>(申请添加原因)
<span></span>   QNIMClient.<span class="hljs-built_in">getRosterService</span>().<span class="hljs-built_in">apply</span>(<span class="hljs-number">22342342</span>, <span class="hljs-string">&quot;Hi, I&#x27;m Lisi&quot;</span>);
<span></span>H/<span class="hljs-selector-tag">A</span>: 在BMXCallBack回调中获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-built_in">getRosterManager</span>().<span class="hljs-built_in">apply</span>(<span class="hljs-number">22342342</span>, <span class="hljs-string">&quot;Hi, I&#x27;m Lisi&quot;</span>, new <span class="hljs-built_in">BMXCallBack</span>(){
<span></span>          @Override
<span></span>          public void <span class="hljs-built_in">onResult</span>(BMXErrorCode bmxErrorCode) {
<span></span>            //返回BMXErrorCode
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="删除好友"><a href="#%E5%88%A0%E9%99%A4%E5%A5%BD%E5%8F%8B" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>删除好友</h3>
<pre><code>L/S: 通过返回值获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-built_in">getRosterService</span>().<span class="hljs-built_in">remove</span>(<span class="hljs-number">22342342</span>);
<span></span>H/<span class="hljs-selector-tag">A</span>: 在BMXCallBack回调中获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-built_in">getRosterManager</span>().<span class="hljs-built_in">remove</span>(<span class="hljs-number">22342342</span>, new <span class="hljs-built_in">BMXCallBack</span>(){
<span></span>          @Override
<span></span>          public void <span class="hljs-built_in">onResult</span>(BMXErrorCode bmxErrorCode) {
<span></span>            //返回BMXErrorCode
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="同意添加好友"><a href="#%E5%90%8C%E6%84%8F%E6%B7%BB%E5%8A%A0%E5%A5%BD%E5%8F%8B" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>同意添加好友</h3>
<pre><code>L/<span class="hljs-attr">S</span>: 通过返回值获取到BMXErrorCode判断是否成功。
<span></span>   <span class="hljs-comment">//参数说明: rosterId</span>
<span></span>   QNIMClient.<span class="hljs-title function_">getRosterService</span>().<span class="hljs-title function_">accept</span>(<span class="hljs-number">333453112</span>);
<span></span>H/<span class="hljs-attr">A</span>: 在BMXCallBack回调中获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-title function_">getRosterManager</span>().<span class="hljs-title function_">accept</span>(<span class="hljs-number">333453112</span>, <span class="hljs-keyword">new</span> <span class="hljs-title function_">BMXCallBack</span>(<span class="hljs-params"></span>){
<span></span>          <span class="hljs-meta">@Override</span>
<span></span>          <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onResult</span>(<span class="hljs-params">BMXErrorCode bmxErrorCode</span>) {
<span></span>            <span class="hljs-comment">//返回BMXErrorCode</span>
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="拒绝添加好友"><a href="#%E6%8B%92%E7%BB%9D%E6%B7%BB%E5%8A%A0%E5%A5%BD%E5%8F%8B" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>拒绝添加好友</h3>
<pre><code>L/S: 通过返回值获取到BMXErrorCode判断是否成功。
<span></span>   //参数说明: rosterId  <span class="hljs-built_in">reason</span>(拒绝原因)
<span></span>
<span></span>   QNIMClient.<span class="hljs-built_in">getRosterService</span>().<span class="hljs-built_in">decline</span>(<span class="hljs-number">333453112</span>,<span class="hljs-string">&quot;I&#x27;m not Lisi&quot;</span>);
<span></span>H/<span class="hljs-selector-tag">A</span>: 在BMXCallBack回调中获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-built_in">getRosterManager</span>().<span class="hljs-built_in">decline</span>(<span class="hljs-number">333453112</span>,<span class="hljs-string">&quot;I&#x27;m not Lisi&quot;</span>, new <span class="hljs-built_in">BMXCallBack</span>(){
<span></span>          @Override
<span></span>          public void <span class="hljs-built_in">onResult</span>(BMXErrorCode bmxErrorCode) {
<span></span>             //返回BMXErrorCode
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="获取花名册"><a href="#%E8%8E%B7%E5%8F%96%E8%8A%B1%E5%90%8D%E5%86%8C" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>获取花名册</h3>
<pre><code>L/S: 通过传入ListOfLongLong对象引用, 调用成功后可获取rosterId的列表。
<span></span>   ListOfLongLong roster = <span class="hljs-keyword">new</span> ListOfLongLong();
<span></span>   QNIMClient.getRosterService().<span class="hljs-keyword">get</span>(roster, <span class="hljs-literal">true</span>);
<span></span>   <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i=<span class="hljs-number">0</span>; i&lt;roster.size(); i++){
<span></span>       <span class="hljs-built_in">long</span> roster_id = roster.<span class="hljs-keyword">get</span>(i);
<span></span>       Log.e(<span class="hljs-string">&quot;roster id:&quot;</span>,<span class="hljs-string">&quot;&quot;</span>+roster_id);
<span></span>   }
<span></span>H/A: 在BMXDataCallBack回调中获取rosterId列表。
<span></span>   QNIMClient.getRosterManager().<span class="hljs-keyword">get</span>(roster, <span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> BMXDataCallBack&lt;ListOfLongLong&gt;(){
<span></span>         @Override
<span></span>         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span>(<span class="hljs-params">BMXErrorCode bmxErrorCode, ListOfLongLong list</span>)</span> {
<span></span>            <span class="hljs-comment">//返回ListOfLongLong实例</span>
<span></span>            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i=<span class="hljs-number">0</span>; i&lt;list.size(); i++){
<span></span>              <span class="hljs-built_in">long</span> roster_id = list.<span class="hljs-keyword">get</span>(i);
<span></span>              Log.e(<span class="hljs-string">&quot;roster id:&quot;</span>,<span class="hljs-string">&quot;&quot;</span>+roster_id);
<span></span>            }
<span></span>        }
<span></span>   });
<span></span>
<span></span></code></pre>
<h3 id="基础功能"><a href="#%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>基础功能</h3>
<h3 id="单聊"><a href="#%E5%8D%95%E8%81%8A" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>单聊</h3>
<p>单聊是指一对一的聊天功能，单聊的 BMXConversationType 是 BMXConversationSingle，toId 是单聊对象的 userId。</p>
<h3 id="聊天室"><a href="#%E8%81%8A%E5%A4%A9%E5%AE%A4" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>聊天室</h3>
<p>聊天室是指附带角色和权限的用户集合内进行的内部广播方式的聊天功能，相比群聊，聊天室加入房间没有验证BMXConversationType 是 BMXConversationGroup，toId 是群组 Id。</p>
<h3 id="创建聊天室"><a href="#%E5%88%9B%E5%BB%BA%E8%81%8A%E5%A4%A9%E5%AE%A4" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>创建聊天室</h3>
<pre><code>L/S: 通过传入BMXGroup对象引用, 调用成功后可获取群信息。
<span></span>    <span class="hljs-comment">//参数说明: name（聊天室名字）  group(群信息)</span>
<span></span>
<span></span>
<span></span>
<span></span>    BMXGroup <span class="hljs-keyword">group</span> = <span class="hljs-keyword">new</span> BMXGroup();
<span></span>    QNIMClient.getChatRoomService().create(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-keyword">group</span>);
<span></span>H/A: 在BMXDataCallBack回调中获取群信息。
<span></span>   QNIMClient.getChatRoomManager().create(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-keyword">new</span> BMXDataCallBack&lt;BMXGroup&gt;(){
<span></span>          @Override
<span></span>          <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span>(<span class="hljs-params">BMXErrorCode bmxErrorCode, BMXGroup <span class="hljs-keyword">group</span></span>)</span> {
<span></span>            <span class="hljs-comment">//返回BMXGroup实例</span>
<span></span>            <span class="hljs-comment">//取到groupid</span>
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="加入聊天室"><a href="#%E5%8A%A0%E5%85%A5%E8%81%8A%E5%A4%A9%E5%AE%A4" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>加入聊天室</h3>
<pre><code>L/S: 通过返回值获取到BMXErrorCode判断是否成功。
<span></span>    //参数说明: <span class="hljs-built_in">groupId</span>(群id)
<span></span>
<span></span>
<span></span>    QNIMClient.<span class="hljs-built_in">getChatRoomService</span>().<span class="hljs-built_in">join</span>(groupId);
<span></span>H/<span class="hljs-selector-tag">A</span>: 在BMXCallBack回调中获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-built_in">getChatRoomManager</span>().<span class="hljs-built_in">join</span>(groupId, new <span class="hljs-built_in">BMXCallBack</span>(){
<span></span>          @Override
<span></span>          public void <span class="hljs-built_in">onResult</span>(BMXErrorCode bmxErrorCode) {
<span></span>            //返回BMXErrorCode实例
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="退出聊天室"><a href="#%E9%80%80%E5%87%BA%E8%81%8A%E5%A4%A9%E5%AE%A4" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>退出聊天室</h3>
<pre><code>L/S: 通过返回值获取到BMXErrorCode判断是否成功。
<span></span>//参数说明: <span class="hljs-built_in">groupId</span>(群id)
<span></span>
<span></span> QNIMClient.<span class="hljs-built_in">getChatRoomService</span>().<span class="hljs-built_in">leave</span>(groupId);
<span></span>H/<span class="hljs-selector-tag">A</span>: 在BMXCallBack回调中获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-built_in">getChatRoomManager</span>().<span class="hljs-built_in">leave</span>(groupId, new <span class="hljs-built_in">BMXCallBack</span>(){
<span></span>          @Override
<span></span>          public void <span class="hljs-built_in">onResult</span>(BMXErrorCode bmxErrorCode) {
<span></span>            //返回BMXErrorCode实例
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="解散聊天室"><a href="#%E8%A7%A3%E6%95%A3%E8%81%8A%E5%A4%A9%E5%AE%A4" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>解散聊天室</h3>
<pre><code>L/S: 通过返回值获取到BMXErrorCode判断是否成功。
<span></span>  //参数说明: <span class="hljs-built_in">groupId</span>(群id)
<span></span>   QNIMClient.<span class="hljs-built_in">getChatRoomService</span>().<span class="hljs-built_in">destroy</span>(groupId);
<span></span>H/<span class="hljs-selector-tag">A</span>: 在BMXCallBack回调中获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-built_in">getChatRoomManager</span>().<span class="hljs-built_in">destroy</span>(groupId, new <span class="hljs-built_in">BMXCallBack</span>(){
<span></span>          @Override
<span></span>          public void <span class="hljs-built_in">onResult</span>(BMXErrorCode bmxErrorCode) {
<span></span>            //返回BMXErrorCode实例
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="获取聊天室成员列表"><a href="#%E8%8E%B7%E5%8F%96%E8%81%8A%E5%A4%A9%E5%AE%A4%E6%88%90%E5%91%98%E5%88%97%E8%A1%A8" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>获取聊天室成员列表</h3>
<pre><code>L/S: 通过传入BMXGroupMemberList对象引用, 调用成功后可获取群成员列表信息。
<span></span>    <span class="hljs-comment">//参数说明: groupId(群id)  forceRefresh(是否从server获取)</span>
<span></span>    <span class="hljs-type">boolean</span> <span class="hljs-variable">forceRefresh</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
<span></span>
<span></span>    <span class="hljs-type">BMXGroupMemberList</span> <span class="hljs-variable">memberList</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BMXGroupMemberList</span>();
<span></span>    QNIMClient.getChatRoomService().getMembers(groupId, memberList, forceRefresh);
<span></span>H/A: 在BMXDataCallBack回调中获取群成员列表信息。
<span></span>   QNIMClient.getChatRoomManager().getMembers(groupId, forceRefresh, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BMXDataCallBack</span>&lt;BMXGroupMemberList&gt;(){
<span></span>          <span class="hljs-meta">@Override</span>
<span></span>          <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResult</span><span class="hljs-params">(BMXErrorCode bmxErrorCode, BMXGroupMemberList list)</span> {
<span></span>            <span class="hljs-comment">//返回BMXGroupMemberList实例</span>
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="群聊"><a href="#%E7%BE%A4%E8%81%8A" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>群聊</h3>
<p>群聊是指附带角色和权限的用户集合内进行的内部广播方式的聊天功能， BMXConversationType 是 BMXConversationGroup，toId 是群组 Id。
群组管理</p>
<h3 id="创建群组"><a href="#%E5%88%9B%E5%BB%BA%E7%BE%A4%E7%BB%84" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>创建群组</h3>
<pre><code>L/S: 通过传入BMXGroup对象引用, 调用成功后可获取群信息。
<span></span>    <span class="hljs-comment">//参数说明: option(群配置信息)  group(群信息)</span>
<span></span>
<span></span>    BMXGroupService.CreateGroupOptions options = <span class="hljs-keyword">new</span> BMXGroupService.CreateGroupOptions(name, desc, publicCheckStatus);
<span></span>    options.setMMembers(members);
<span></span>
<span></span>    BMXGroup <span class="hljs-keyword">group</span> = <span class="hljs-keyword">new</span> BMXGroup();
<span></span>    QNIMClient.getGroupService().create(options, <span class="hljs-keyword">group</span>);
<span></span>H/A: 在BMXDataCallBack回调中获取群信息。
<span></span>   QNIMClient.getGroupManager().create(option, <span class="hljs-keyword">new</span> BMXDataCallBack&lt;BMXGroup&gt;(){
<span></span>          @Override
<span></span>          <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResult</span>(<span class="hljs-params">BMXErrorCode bmxErrorCode, BMXGroup <span class="hljs-keyword">group</span></span>)</span> {
<span></span>            <span class="hljs-comment">//返回BMXGroup实例</span>
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="加入群组"><a href="#%E5%8A%A0%E5%85%A5%E7%BE%A4%E7%BB%84" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>加入群组</h3>
<pre><code>L/S: 通过返回值获取到BMXErrorCode判断是否成功。
<span></span>    //参数说明: <span class="hljs-built_in">group</span>(群信息)  <span class="hljs-built_in">message</span>(申请入群原因)
<span></span>    QNIMClient.<span class="hljs-built_in">getGroupService</span>().<span class="hljs-built_in">join</span>(group, message);
<span></span>H/<span class="hljs-selector-tag">A</span>: 在BMXCallBack回调中获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-built_in">getGroupManager</span>().<span class="hljs-built_in">join</span>(group, message, new <span class="hljs-built_in">BMXCallBack</span>(){
<span></span>          @Override
<span></span>          public void <span class="hljs-built_in">onResult</span>(BMXErrorCode bmxErrorCode) {
<span></span>            //返回BMXErrorCode实例
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="退出群组-参数说明-group群信息"><a href="#%E9%80%80%E5%87%BA%E7%BE%A4%E7%BB%84-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-group%E7%BE%A4%E4%BF%A1%E6%81%AF" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>退出群组 参数说明: group(群信息)</h3>
<pre><code>L/S: 通过返回值获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-built_in">getGroupService</span>().<span class="hljs-built_in">leave</span>(group);
<span></span>H/<span class="hljs-selector-tag">A</span>: 在BMXCallBack回调中获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-built_in">getGroupManager</span>().<span class="hljs-built_in">leave</span>(group, new <span class="hljs-built_in">BMXCallBack</span>(){
<span></span>          @Override
<span></span>          public void <span class="hljs-built_in">onResult</span>(BMXErrorCode bmxErrorCode) {
<span></span>            //返回BMXErrorCode实例
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="解散群组"><a href="#%E8%A7%A3%E6%95%A3%E7%BE%A4%E7%BB%84" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>解散群组</h3>
<pre><code>L/S: 通过返回值获取到BMXErrorCode判断是否成功。
<span></span>   //参数说明: <span class="hljs-built_in">group</span>(群信息)
<span></span>   QNIMClient.<span class="hljs-built_in">getGroupService</span>().<span class="hljs-built_in">destroy</span>(group);
<span></span>H/<span class="hljs-selector-tag">A</span>: 在BMXCallBack回调中获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-built_in">getGroupManager</span>().<span class="hljs-built_in">destroy</span>(group, new <span class="hljs-built_in">BMXCallBack</span>(){
<span></span>          @Override
<span></span>          public void <span class="hljs-built_in">onResult</span>(BMXErrorCode bmxErrorCode) {
<span></span>            //返回BMXErrorCode实例
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="获取群成员列表"><a href="#%E8%8E%B7%E5%8F%96%E7%BE%A4%E6%88%90%E5%91%98%E5%88%97%E8%A1%A8" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>获取群成员列表</h3>
<pre><code>L/S: 通过传入BMXGroupMemberList对象引用, 调用成功后可获取群成员列表信息。
<span></span>    <span class="hljs-comment">//参数说明: group(群信息) forceRefresh(是否从server获取)</span>
<span></span>    <span class="hljs-type">boolean</span> <span class="hljs-variable">forceRefresh</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
<span></span>
<span></span>    <span class="hljs-type">BMXGroupMemberList</span> <span class="hljs-variable">memberList</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BMXGroupMemberList</span>();
<span></span>    QNIMClient.getGroupService().getMembers(group, memberList, forceRefresh);
<span></span>H/A: 在BMXDataCallBack回调中获取群成员列表信息。
<span></span>   QNIMClient.getGroupManager().getMembers(group, forceRefresh, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BMXDataCallBack</span>&lt;BMXGroupMemberList&gt;(){
<span></span>          <span class="hljs-meta">@Override</span>
<span></span>          <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResult</span><span class="hljs-params">(BMXErrorCode bmxErrorCode, BMXGroupMemberList list)</span> {
<span></span>            <span class="hljs-comment">//返回BMXGroupMemberList实例</span>
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="获取群组列表"><a href="#%E8%8E%B7%E5%8F%96%E7%BE%A4%E7%BB%84%E5%88%97%E8%A1%A8" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>获取群组列表</h3>
<pre><code>L/S: 通过传入BMXGroupList对象引用, 调用成功后可获取群列表信息。
<span></span>   <span class="hljs-comment">//参数说明: forceRefresh(是否从server获取)</span>
<span></span>   <span class="hljs-type">BMXGroupList</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BMXGroupList</span>();
<span></span>   QNIMClient.getGroupService().search(list, <span class="hljs-literal">true</span>);
<span></span>H/A: 在BMXDataCallBack回调中获取群列表信息。
<span></span>    QNIMClient.getGroupManager().getGroupList(<span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BMXDataCallBack</span>&lt;BMXGroupList&gt;(){
<span></span>          <span class="hljs-meta">@Override</span>
<span></span>          <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResult</span><span class="hljs-params">(BMXErrorCode bmxErrorCode, BMXGroupList list)</span> {
<span></span>            <span class="hljs-comment">//返回BMXGroupList实例</span>
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="获取群组信息"><a href="#%E8%8E%B7%E5%8F%96%E7%BE%A4%E7%BB%84%E4%BF%A1%E6%81%AF" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>获取群组信息</h3>
<pre><code>L/S: 通过传入BMXGroup对象引用, 调用成功后可获取群信息。
<span></span>    <span class="hljs-comment">//参数说明: groupId  forceRefresh(是否从server获取)</span>
<span></span>   <span class="hljs-type">BMXGroup</span> <span class="hljs-variable">bmxGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BMXGroup</span>();
<span></span>   QNIMClient.getGroupService().search(mGroupId, bmxGroup, <span class="hljs-literal">true</span>);
<span></span>H/A: 在BMXDataCallBack回调中获取群信息。
<span></span>   QNIMClient.getGroupManager().getGroupList(mGroupId, <span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BMXDataCallBack</span>&lt;BMXGroup&gt;(){
<span></span>          <span class="hljs-meta">@Override</span>
<span></span>          <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResult</span><span class="hljs-params">(BMXErrorCode bmxErrorCode, BMXGroup group)</span> {
<span></span>            <span class="hljs-comment">//返回BMXGroup实例</span>
<span></span>          }
<span></span>    });
<span></span></code></pre>
<h3 id="消息发送"><a href="#%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>消息发送</h3>
<p>登录成功之后才能进行聊天操作。发消息时，单聊和群聊调用的是统一接口，区别只是要设置下 BMXConversationType
消息的远程推送</p>
<p>开发者配置好远程推送的证书，且在代码中申请好权限，并将 deviceToken 传给MaxIM服务器，当接收者不在线的时候，MaxIM服务器会自动通过远程推送将消息发过去。
注： 推送的内容由发送消息接口的 pushContent 字段决定，内置消息发送的时候如果该字段没有值，将使用默认内容推送；自定义消息必须设置该字段，否则将不会推送。
deviceToken传给MaxIM接口</p>
<pre><code>L/S: 通过返回值获取到BMXErrorCode判断是否成功。
<span></span>    //参数说明: <span class="hljs-built_in">pushToken</span>(推送token)
<span></span>    QNIMClient.<span class="hljs-built_in">getUserService</span>().<span class="hljs-built_in">bindDevice</span>(pushToken);
<span></span>H/<span class="hljs-selector-tag">A</span>: 在BMXCallBack回调中获取到BMXErrorCode判断是否成功。
<span></span>   QNIMClient.<span class="hljs-built_in">getUserManager</span>().<span class="hljs-built_in">bindDevice</span>(pushToken, new <span class="hljs-built_in">BMXCallBack</span>(){
<span></span>          @Override
<span></span>          public void <span class="hljs-built_in">onResult</span>(BMXErrorCode bmxErrorCode) {
<span></span>            //返回BMXErroeCode实例
<span></span>          }
<span></span>    });
<span></span>
<span></span></code></pre>
<h3 id="消息内容格式"><a href="#%E6%B6%88%E6%81%AF%E5%86%85%E5%AE%B9%E6%A0%BC%E5%BC%8F" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>消息内容格式</h3>
<h3 id="文本消息"><a href="#%E6%96%87%E6%9C%AC%E6%B6%88%E6%81%AF" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>文本消息</h3>
<pre><code>
<span></span><span class="hljs-comment">//参数说明: from(发送者id)  to(接收者id)  type(单群聊类型)  text(文本内容)</span>
<span></span>BMXMessage msg = BMXMessage.<span class="hljs-title function_">createMessage</span>(<span class="hljs-keyword">from</span>, to, <span class="hljs-keyword">type</span>, to, text);
<span></span>图片消息
<span></span>
<span></span><span class="hljs-comment">//参数说明: from(发送者id)  to(接收者id)  type(单群聊类型)  w(图片宽)   h(图片高)  path(图片本地路径)  size(图片大小)</span>
<span></span>
<span></span>BMXImageAttachment.<span class="hljs-property">Size</span> size = <span class="hljs-keyword">new</span> BMXMessageAttachment.<span class="hljs-title class_">Size</span>(w, h);
<span></span>BMXImageAttachment imageAttachment = <span class="hljs-keyword">new</span> <span class="hljs-title function_">BMXImageAttachment</span>(path, size);
<span></span>BMXMessage msg = BMXMessage.<span class="hljs-title function_">createMessage</span>(<span class="hljs-keyword">from</span>, to, <span class="hljs-keyword">type</span>, to, imageAttachment);
<span></span>文件消息
<span></span>
<span></span>参数说明: <span class="hljs-title function_">from</span>(发送者id) <span class="hljs-title function_">to</span>(接收者id) <span class="hljs-title function_">type</span>(单群聊类型) <span class="hljs-title function_">path</span>(文件本地路径) <span class="hljs-title function_">name</span>(文件名称)
<span></span>BMXFileAttachment fileAttachment = <span class="hljs-keyword">new</span> <span class="hljs-title function_">BMXFileAttachment</span>(path, name);
<span></span>BMXMessage msg = BMXMessage.<span class="hljs-title function_">createMessage</span>(<span class="hljs-keyword">from</span>, to, <span class="hljs-keyword">type</span>, to, fileAttachment);
<span></span>位置消息
<span></span>
<span></span>参数说明: <span class="hljs-title function_">from</span>(发送者id) <span class="hljs-title function_">to</span>(接收者id) <span class="hljs-title function_">type</span>(单群聊类型) <span class="hljs-title function_">latitude</span>(纬度) <span class="hljs-title function_">longitude</span>(经度) <span class="hljs-title function_">address</span>(地址)
<span></span>BMXLocationAttachment locationAttachment = <span class="hljs-keyword">new</span> <span class="hljs-title function_">BMXLocationAttachment</span>(latitude, longitude, address);
<span></span>BMXMessage msg = BMXMessage.<span class="hljs-title function_">createMessage</span>(<span class="hljs-keyword">from</span>, to, <span class="hljs-keyword">type</span>, to, locationAttachment);
<span></span>语音消息
<span></span>
<span></span>参数说明: <span class="hljs-title function_">from</span>(发送者id) <span class="hljs-title function_">to</span>(接收者id) <span class="hljs-title function_">type</span>(单群聊类型) <span class="hljs-title function_">path</span>(语音本地路径) <span class="hljs-title function_">time</span>(语音时长)
<span></span>BMXVoiceAttachment voiceAttachment = <span class="hljs-keyword">new</span> <span class="hljs-title function_">BMXVoiceAttachment</span>(path, time);
<span></span>BMXMessage msg = BMXMessage.<span class="hljs-title function_">createMessage</span>(<span class="hljs-keyword">from</span>, to, <span class="hljs-keyword">type</span>, to, voiceAttachment);
<span></span>消息操作
<span></span>
<span></span>发送
<span></span>L/<span class="hljs-attr">S</span>:
<span></span>    <span class="hljs-comment">//参数说明: BMXMessage(消息实体)</span>
<span></span>    QNIMClient.<span class="hljs-title function_">getChatService</span>().<span class="hljs-title function_">sendMessage</span>(msg);
<span></span>H/<span class="hljs-attr">A</span>:
<span></span>    <span class="hljs-comment">//发送消息状态，需要注册消息接收监听</span>
<span></span>    QNIMClient.<span class="hljs-title function_">getChatManager</span>().<span class="hljs-title function_">sendMessage</span>(msg);
<span></span>转发
<span></span>L/<span class="hljs-attr">S</span>:
<span></span>    <span class="hljs-comment">//参数说明: BMXMessage(消息实体)</span>
<span></span>   QNIMClient.<span class="hljs-title function_">getChatService</span>().<span class="hljs-title function_">forwardMessage</span>(msg);
<span></span>H/<span class="hljs-attr">A</span>:
<span></span>    <span class="hljs-comment">//发送消息状态，需要注册消息接收监听</span>
<span></span>    <span class="hljs-comment">//参数说明: BMXMessage(消息实体)</span>
<span></span>    QNIMClient.<span class="hljs-title function_">getChatManager</span>().<span class="hljs-title function_">forwardMessage</span>(msg);
<span></span>重发
<span></span>L/<span class="hljs-attr">S</span>:
<span></span>   <span class="hljs-comment">//参数说明: BMXMessage(消息实体)</span>
<span></span>   QNIMClient.<span class="hljs-title function_">getChatService</span>().<span class="hljs-title function_">resendMessage</span>(msg);
<span></span>H/<span class="hljs-attr">A</span>:
<span></span>    <span class="hljs-comment">//发送消息状态，需要注册消息接收监听</span>
<span></span>    QNIMClient.<span class="hljs-title function_">getChatManager</span>().<span class="hljs-title function_">resendMessage</span>(msg);
<span></span>撤回
<span></span>L/<span class="hljs-attr">S</span>:
<span></span>    <span class="hljs-comment">//参数说明: BMXMessage(消息实体)</span>
<span></span>    QNIMClient.<span class="hljs-title function_">getChatService</span>().<span class="hljs-title function_">recallMessage</span>(msg);
<span></span>H/<span class="hljs-attr">A</span>:
<span></span>    <span class="hljs-comment">//发送消息状态，需要注册消息接收监听</span>
<span></span>    QNIMClient.<span class="hljs-title function_">getChatManager</span>().<span class="hljs-title function_">recallMessage</span>(msg);
<span></span>下载消息附件
<span></span>调用说明: 在<span class="hljs-title class_">FileCallBack</span>中传入下载url,onProgress获取下载进度,onFail返回下载失败,onFinish返回成功的路径。
<span></span>    QNIMClient.<span class="hljs-title function_">getChatManager</span>().<span class="hljs-title function_">downloadAttachment</span>(message, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileCallback</span>(body.<span class="hljs-title function_">url</span>()) {
<span></span>        <span class="hljs-meta">@Override</span>
<span></span>        <span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onProgress</span>(<span class="hljs-params">long percent, <span class="hljs-built_in">String</span> path, <span class="hljs-built_in">boolean</span> isThumbnail</span>) {
<span></span>        }
<span></span>
<span></span>        <span class="hljs-meta">@Override</span>
<span></span>        <span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onFinish</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> url, <span class="hljs-built_in">boolean</span> isThumbnail</span>) {
<span></span>            BMImageLoader.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">display</span>(mImageView, <span class="hljs-string">&quot;file://&quot;</span> + body.<span class="hljs-title function_">path</span>(), mImageConfig);
<span></span>        }
<span></span>
<span></span>        <span class="hljs-meta">@Override</span>
<span></span>        <span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onFail</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> path, <span class="hljs-built_in">boolean</span> isThumbnail</span>) {
<span></span>        }
<span></span>    });
<span></span></code></pre>
<h3 id="消息接收监听"><a href="#%E6%B6%88%E6%81%AF%E6%8E%A5%E6%94%B6%E7%9B%91%E5%90%AC" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>消息接收监听</h3>
<h3 id="注册消息回调"><a href="#%E6%B3%A8%E5%86%8C%E6%B6%88%E6%81%AF%E5%9B%9E%E8%B0%83" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>注册消息回调</h3>
<pre><code><span class="hljs-keyword">private</span> BMXChatServiceListener mChatListener = <span class="hljs-keyword">new</span> <span class="hljs-title function_">BMXChatServiceListener</span>(<span class="hljs-params"></span>) {
<span></span>
<span></span>    <span class="hljs-meta">@Override</span>
<span></span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onStatusChanged</span>(<span class="hljs-params">BMXMessage msg, BMXErrorCode error</span>) {
<span></span>    <span class="hljs-comment">//消息状态更新</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-meta">@Override</span>
<span></span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onAttachmentStatusChanged</span>(<span class="hljs-params">BMXMessage msg, BMXErrorCode error, int percent</span>) {
<span></span>    <span class="hljs-comment">//附件状态更新</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-meta">@Override</span>
<span></span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onRecallStatusChanged</span>(<span class="hljs-params">BMXMessage msg, BMXErrorCode error</span>) {
<span></span>    <span class="hljs-comment">//撤回状态更新</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-meta">@Override</span>
<span></span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onReceive</span>(<span class="hljs-params">BMXMessageList list</span>) {
<span></span>    <span class="hljs-comment">//收到消息</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-meta">@Override</span>
<span></span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onReceiveSystemMessages</span>(<span class="hljs-params">BMXMessageList list</span>) {
<span></span>    <span class="hljs-comment">//收到系统通知</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-meta">@Override</span>
<span></span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onReceiveReadAcks</span>(<span class="hljs-params">BMXMessageList list</span>) {
<span></span>    <span class="hljs-comment">//收到已读回执</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-meta">@Override</span>
<span></span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onReceiveDeliverAcks</span>(<span class="hljs-params">BMXMessageList list</span>) {
<span></span>    <span class="hljs-comment">//收到消息到达回执</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-meta">@Override</span>
<span></span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onReceiveRecallMessages</span>(<span class="hljs-params">BMXMessageList list</span>) {
<span></span>    <span class="hljs-comment">//收到撤回消息通知</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-meta">@Override</span>
<span></span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onAttachmentUploadProgressChanged</span>(<span class="hljs-params">BMXMessage msg, int percent</span>) {
<span></span>    <span class="hljs-comment">//附件上传进度更新</span>
<span></span>    }
<span></span>
<span></span>};
<span></span>
<span></span></code></pre>
<h3 id="混淆"><a href="#%E6%B7%B7%E6%B7%86" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>混淆</h3>
<pre><code>在 ProGuard 文件中加入：-keep <span class="hljs-keyword">class</span> <span class="hljs-title class_">im</span>.floo.floolib.**{*;}
<span></span></code></pre>
<h3 id="功能进阶"><a href="#%E5%8A%9F%E8%83%BD%E8%BF%9B%E9%98%B6" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>功能进阶</h3>
<p>BMXMessageObject实体中，提供可扩展属性(extensionJson 和 configJson) extensionJson 为开发使用的扩展字段，例如编辑状态。 configJson 为SDK自用的扩展字段，例如mention功能，push功能
群组@功能
群组中支持 @ 功能，满足您 @ 指定用户或 @所有人的需求，开发者在BMXMessage中通过设置config字段来实现群主@功能，已经@成员后的会下发推送通知</p>
<pre><code>    <span class="hljs-comment">// 文本功能添加@对象</span>
<span></span>    <span class="hljs-keyword">if</span> (atMap != <span class="hljs-literal">null</span> && !atMap.<span class="hljs-title function_">isEmpty</span>()) {
<span></span>        <span class="hljs-title class_">MentionBean</span> mentionBean = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MentionBean</span>();
<span></span>        mentionBean.<span class="hljs-title function_">setSenderNickname</span>(senderName);
<span></span>        mentionBean.<span class="hljs-title function_">setPushMessage</span>(pushText);
<span></span>        <span class="hljs-comment">// @对象的存储信息 包括全部成员或者部分成员</span>
<span></span>        <span class="hljs-keyword">if</span> (atMap.<span class="hljs-title function_">containsKey</span>(<span class="hljs-string">&quot;-1&quot;</span>)) {
<span></span>            <span class="hljs-comment">// @全部</span>
<span></span>            <span class="hljs-title class_">String</span> atTitle = atMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;-1&quot;</span>);
<span></span>            <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">TextUtils</span>.<span class="hljs-title function_">isEmpty</span>(atTitle) && text.<span class="hljs-title function_">contains</span>(atTitle)) {
<span></span>                <span class="hljs-comment">// 如果包含全部直接走全部 还需要判断文本消息是否包含完成的@名称 如果没有就不触发@</span>
<span></span>                mentionBean.<span class="hljs-title function_">setMentionAll</span>(<span class="hljs-literal">true</span>);
<span></span>            }
<span></span>        } <span class="hljs-keyword">else</span> {
<span></span>            <span class="hljs-comment">// @部分成员 需要遍历添加@信息</span>
<span></span>            <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Long</span>&gt; atIds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span></span>            mentionBean.<span class="hljs-title function_">setMentionAll</span>(<span class="hljs-literal">false</span>);
<span></span>            <span class="hljs-keyword">for</span> (<span class="hljs-title class_">Map</span>.<span class="hljs-property">Entry</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; entry : atMap.<span class="hljs-title function_">entrySet</span>()) {
<span></span>                <span class="hljs-comment">// 发送文字包含@对象的名称时再加入 防止输入框@对象名称被修改</span>
<span></span>                <span class="hljs-keyword">if</span> (entry.<span class="hljs-title function_">getValue</span>() != <span class="hljs-literal">null</span> && !<span class="hljs-title class_">TextUtils</span>.<span class="hljs-title function_">isEmpty</span>(entry.<span class="hljs-title function_">getValue</span>())
<span></span>                    && text.<span class="hljs-title function_">contains</span>(entry.<span class="hljs-title function_">getValue</span>())) {
<span></span>                    <span class="hljs-comment">// @部分成员 feed信息只需要feedId和userId 所以需要去除无用的信息</span>
<span></span>                    atIds.<span class="hljs-title function_">add</span>(<span class="hljs-title class_">Long</span>.<span class="hljs-title function_">valueOf</span>(entry.<span class="hljs-title function_">getKey</span>()));
<span></span>                    }
<span></span>                }
<span></span>            mentionBean.<span class="hljs-title function_">setMentionList</span>(atIds);
<span></span>        }
<span></span>        msg.<span class="hljs-title function_">setConfig</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>().<span class="hljs-title function_">toJson</span>(mentionBean));
<span></span>    }
<span></span>消息正在输入状态
<span></span>    <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">INPUT_STATUS</span> = <span class="hljs-string">&quot;input_status&quot;</span>;
<span></span>
<span></span>    <span class="hljs-keyword">interface</span> InputStatus {
<span></span>        <span class="hljs-comment">// 空</span>
<span></span>        <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">NOTHING_STATUS</span> = <span class="hljs-string">&quot;nothing&quot;</span>;
<span></span>
<span></span>        <span class="hljs-comment">// 键盘弹起</span>
<span></span>        <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">TYING_STATUS</span> = <span class="hljs-string">&quot;typing&quot;</span>;
<span></span>    }
<span></span>
<span></span>    <span class="hljs-title class_">String</span> extension = <span class="hljs-string">&quot;&quot;</span>;
<span></span>    <span class="hljs-keyword">try</span> {
<span></span>        JSONObject <span class="hljs-built_in">object</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_">JSONObject</span>();
<span></span>        <span class="hljs-built_in">object</span>.<span class="hljs-title function_">put</span>(<span class="hljs-variable constant_">INPUT_STATUS</span>,
<span></span>            tag == <span class="hljs-title class_">MessageInputBar</span>.<span class="hljs-property">OnInputPanelListener</span>.<span class="hljs-property">TAG_OPEN</span>
<span></span>                    ? <span class="hljs-title class_">InputStatus</span>.<span class="hljs-property">TYING_STATUS</span>
<span></span>                    : <span class="hljs-title class_">InputStatus</span>.<span class="hljs-property">NOTHING_STATUS</span>);
<span></span>        extension = <span class="hljs-built_in">object</span>.<span class="hljs-title function_">toString</span>();
<span></span>    } <span class="hljs-keyword">catch</span> (JSONException e) {
<span></span>        e.<span class="hljs-title function_">printStackTrace</span>();
<span></span>    }
<span></span>
<span></span>    BMXMessage msg = BMXMessage.<span class="hljs-title function_">createMessage</span>(<span class="hljs-keyword">from</span>, to, <span class="hljs-keyword">type</span>, to, <span class="hljs-string">&quot;&quot;</span>);
<span></span>    <span class="hljs-keyword">if</span> (msg == <span class="hljs-literal">null</span>) {
<span></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
<span></span>    }
<span></span>    msg.<span class="hljs-title function_">setDeliveryQos</span>(BMXMessage.<span class="hljs-property">DeliveryQos</span>.<span class="hljs-property">AtMostOnce</span>);
<span></span>    msg.<span class="hljs-title function_">setExtension</span>(extension);
<span></span></code></pre></div></div>