您可以通过 **滚动更新** 的方式对应用版本进行平滑切换，满足云应用快速迭代和功能验证的需求。

本文介绍滚动更新的背景信息、场景示例和操作步骤，以及异常时回滚的说明。



# **背景信息**

- **滚动更新发布策略**：通过对不同的应用版本部署实例进行滚动更新，来完成新版本的升级，为了保证应用稳定性，建议您先对新应用版本部署实例后，并完成功能验证测试，再将老版本的实例升级到新版本。
- [**流量分配发布策略**](/qapp/development_guidelines/12331/flow-distribution01)：借助流量分配可以实现流量切分，快速实现 A/B 测试等高级功能，完成新版本的小规模验证。



# **场景一：升级**

假设您有一个老版本 V1，现在上线了新版本 V2。现需将V1版本的实例升级为V2版本。

- 为了保证应用稳定性，先对V2版本部署1个实例，并通过 [流量分配策略](/qapp/development_guidelines/12331/flow-distribution01) 完成功能验证测试。

- 功能验证ok后，再通过 **滚动更新** 的方式，将V1版本的所有实例，全部升级到 V2版本。



# **场景二：回滚**

假设您有一个老版本 V1，现在上线了新版本 V2。已经将V1版本的实例升级为V2版本，升级成功后的V2实例出现业务不符合预期。

- 为了保证应用稳定性，您可以采用将V2版本实例 **滚动更新** 到V1版本实例的方式来 **回滚**。

  




# **操作步骤**

1. 登录 [容器轻应用平台](https://portal.qiniu.com/dora/qapp)。

2. 在左侧导航栏单击应用，在顶部菜单栏选择 **部署管理**，并切换区域。

3. 在部署列表中选择需要升级的部署，点击 **操作栏->滚动更新**。

   ![img](https://dora-doc.qiniu.com/WX20221103-175244%402x.png)

4. 在创建滚动更新页面，设置相关参数。

   ![img](https://dora-doc.qiniu.com/WX20220223-164156.png)

   参数说明如下：

   - **缩实例配置**
     - 缩实例对象：滚动更新中，实例数逐渐减少的部署，即升级前的。
     - 缩实例数量：滚动更新中，实例减少的数量。
     - 每次调整实例数：实例数调整的步长。
   - **扩实例配置**
     - 扩实例对象：滚动更新中，实例数逐渐增加的部署，即升级后的。
     - 扩实例数量：滚动更新中，实例增加的数量。
     - 每次调整实例数：实例数调整的步长。
   - **高级配置**：默认折叠
     - 每次调整间隔时间：默认40s，每隔40s调整一次实例。
     - 先扩后缩：默认开启，即先扩实例后缩实例，关闭则反之。
     - 健康等待：默认开启，当调整实例时，扩的实例不健康则停止滚动更新；关闭，当调整实例时，不管扩的实例是否健康，都继续滚动更新。

   

5. 进入 **部署管理列表**页，此时正在滚动更新的2个部署ID，状态变为【滚动更新中】，此时不能对这2个部署的实例进行手动扩缩、自动扩缩、删除实例的操作。

   ![img](https://dora-doc.qiniu.com/WX20221103-175430%402x.png)

   > **说明**
   >
   > 滚动更新中的部署ID，不能进行自动扩缩、手动扩缩、删除操作。

   

6. 如果要 **停止滚动更新**，点击 **操作->删除滚动更新**，进入滚动更新列表中进行删除。![img](https://dora-doc.qiniu.com/WX20221103-175515%402x.png)

   8. 部署列表栏，点击【滚动更新列表】，滚动更新列表记录了所有滚动更新操作的详细信息，在此处可以管理：

   - 状态为 **滚动更新中**，点击【删除】，可以停止滚动更新；

   - 状态为 **滚动更新成功**，点击【删除】，可以删除滚动更新记录；

   - 状态为 **滚动更新失败**，在状态栏点击 **问号**，可以查看失败原因。

     > **说明**
     >
     > 如果出现镜像不可用、健康检查失败等变更流程异常情况，将导致滚动更新失败，建议您查看相应日志查找原因，或者 [提交工单](https://support.qiniu.com/question) 咨询。

     






