应用配置能够将环境配置信息和容器镜像解耦，方便您修改应用的配置，配置发生变更时，能避免额外的代码修改和镜像构建，从而有效降低了代码维护成本。您只需设定配置并指定挂载路径，应用即可从对应路径读取该配置文件。



# **管理应用配置列表**

创建的配置项将显示在**应用配置**列表页面，您可以对其进行 **更新**、 **修改** 、 **删除**的操作。

应用配置文件来源分为两种类型：

- **手动创建**：手动创建配置文件
- **代码库**：通过代码库导入配置文件

![img](https://dora-doc.qiniu.com/WX20230412-112924.png)

**不同类型的文件来源，对应的操作不同**

1. 手动创建
   - 【修改】：修改范围，除了 **配置名称** 不可修改，其他均可修改
   - 【删除】：删除应用配置
2. 代码库同步
   - 【更新配置文件】：通过代码库同步，更新覆盖之前的应用配置。
   - 【修改】：修改范围，除了 **配置变量** 可以修改，其他均不可修改
   - 【删除】：删除应用配置

**注意：**

如果当前应用配置被应用版本关联过，在**应用配置**列表页面，对其进行**更新**、 **修改** 、 **删除**的操作的影响范围如下：

> - 应用配置发生了变更（修改文件名 or 删除文件），需要新建版本选择修改后的应用配置，重新绑定文件路径后，再去部署实例，才可生效。如果不新建版本直接进行实例部署，会部署失败。
> - 应用配置发生了变更（修改文件内容），仅生效于新的实例部署，对存量已创建的实例部署不生效。
> - 应用配置发生了变更（新增文件），仅生效于新的实例部署，对存量已创建的实例部署不生效。如果需要使用新增的配置文件，建议先新建版本绑定新增文件路径后，再去部署实例。
> - 应用配置被删除，新建实例部署会失败，对存量已创建的实例部署不生效。



# **手动创建应用配置**

1. 登录 [容器轻应用平台](https://portal.qiniu.com/dora/qapp)。

2. 在左侧导航栏单击 **具体应用名称**，在顶部菜单栏选择 **应用配置**。

3. 在应用配置列表上方，单击 **新建应用配置** 按钮。

   ![img](https://dora-doc.qiniu.com/WX20230412-141648.png)

4. 在新建应用配置页面，设置相关参数。

   ![img](https://dora-doc.qiniu.com/WX20221103-142807%402x.png)

   | 参数         | 说明                                                         |
   | ------------ | ------------------------------------------------------------ |
   | **配置名称** | 必填，自定义。名称格式为1-63个字符，可以包含小写字母、数字、-，开头和结尾必须为字母或数字 |
   | **配置详情** | 必填，可以添加多个配置文件，每个文件配置内容包括：<br>1) 文件名：名称格式为1-63个字符，可以包含字母、数字、.、-、_。<br/>2) 内容：自定义yaml文件内容。 |
   | **环境变量** | 非必填，默认关闭。点击开启后，设置以下参数：<br>![img](https://dora-doc.qiniu.com/WX20221107-154849%402x.png)  1) 生效区域：选择生效区域，可以设置替换多个区域的变量。<br>2) 环境变量：自定义，变量替换的内容。 |

5. 设置环境变量后，可点击 **预览** 进行校验。![img](https://dora-doc.qiniu.com/WX20221107-155520%402x.png)

6. 单击 **保存**，应用配置创建成功。

    

# **代码库导入应用配置**

1. 登录 [容器轻应用平台](https://portal.qiniu.com/dora/qapp)。

2. 在左侧导航栏单击 **具体应用名称**，在顶部菜单栏选择 **应用配置**。

3. 在应用配置列表上方，单击 **代码库导入配置** 按钮。

   ![img](https://dora-doc.qiniu.com/WX20230412-142056.png)

4. 弹出 **导入配置文件** 的弹窗，设置相关参数。

   ![img](https://dora-doc.qiniu.com/WX20230412-142217.png)

   | 参数         | 说明                                                         |
   | ------------ | ------------------------------------------------------------ |
   | **配置名称** | 必填，自定义。名称格式为1-63个字符，可以包含小写字母、数字、-，开头和结尾必须为字母或数字 |
   | **代码源**   | 1. 如果是公共库，填写规范：https://repo.git<br>2. 如果是私有库，可以使用以下两种方式：<br>     1）通过 auth2 的方式，https://oauth2:<apiToken>@repo.git<br>     2）通过 username 的方式，https://<username>:<apiToken>@repo.git<br>3. apiToken 获取方式，示例：<br>     1）GitHub：[Creating a personal access token - GitHub Docs](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token)<br>     2）GitLab：[Personal access tokens](https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html) |
   | **文件路径** | # **管理应用配置列表**设置文件所在的路径                     |

5. 导入成功后，点击 **更新配置文件** 按钮，弹出 **更新导入配置文件** 的弹窗，修改设置相关参数。。

   ![img](https://dora-doc.qiniu.com/WX20230412-142056.png)

6. 导入成功后，点击 **修改**，去设置环境变量。

   ![img](https://dora-doc.qiniu.com/WX20221107-154849%402x.png)

   非必填项，默认关闭。点击开启后，设置以下参数： 

   - 生效区域：选择生效区域，可以设置替换多个区域的变量。

   - 环境变量：自定义，变量替换的内容。

     

7. 设置环境变量后，可点击 **预览** 进行校验。![img](https://dora-doc.qiniu.com/WX20221107-155520%402x.png)

8. 单击 **保存**，应用配置修改成功。

    





# **如何配置环境变量**

如果配置中含有 `{{...}}` 格式的文本，会在部署到具体区域时使用 go-template 语法进行文本替换。

普通用户只需了解 **变量引用方式** 和 **拓展函数** 即可快速上手。

更复杂的使用方式可参考 [Go doc](https://golang.org/pkg/text/template/) 。

### 变量引用方式

**示例**

- 配置，通过 {{.Values.url}} 引用某特定区域中的 url 变量

  ```
  http:
    url: {{.Values.url}}
  ```

- 在特定区域中声明 url 变量

  ```
  url: qiniu.com
  ```

- 替换结果

  ```http:
  http: 
    url: qiniu.com
  ```

#### 

## 拓展函数及使用方式

#### 缩进函数 indent(int, string) => string

第一个参数为空格数量，第二个参数为文本变量，返回自行首缩进指定空格数量后的文本变量。

**示例**

- 配置

  ```
  {{ .Values.url | indent 2 }}
  {{ indent 4 .Values.url }}
  ```

- 设置变量

  ```
  url: qiniu.com
  ```

- 替换结果

  ```
   qiniu.com
      qiniu.com
  ```