七牛云提供的PUB转推服务，实现将直播流或者点播流转推至目标直播平台。若您需要将直播源进行多平台分发，或者需要将点播文件转成直播流进行分发，那即可使用我们的PUB转推服务，快速拉取已有的直播流/点播视频，推送到指定的直播推流地址上。
![image.png](https://dn-odum9helk.qbox.me/Fp97inr7lZ3Y7QrZ4oFViG601z2c)
# 业务场景
**一、电视台/摄像头信号源分发**
电视台多为rtsp/hls等协议，而且有拉流数量限制，需要使用互联网平台的直播服务进行直播分发。
摄像头信号源大多数为rtsp协议，这个协议不适合在互联网平台分发观看，因此需要使用pub服务将rtsp流转推至rtmp服务器，最后生成rtmp/flv/hls流进行分发。

**二、伪直播场景**
在线教育领域以及各类活动都会有伪直播场景，将已录制完成的文件作为直播流进行分发，这时可以使用pub转推服务做为解决方案。

**三、多平台分发**
活动直播有时提供单路信号源，如果需要转推多家第三方直播平台，就可以使用pub转推服务。

# 控制台PUB服务使用说明
## **一、创建任务**
1、进入七牛云控制台，选择[视频直播Pili](https://portal.qiniu.com/pili)-->[Pub转推](https://portal.qiniu.com/pub/overview)，进入Pub转推页面
![image.png](https://dn-odum9helk.qbox.me/FmGu7tBNGC-FT2OuZrdbX9gY2WWP)
![image.png](https://dn-odum9helk.qbox.me/FjnWXPQQsowIuFPFcGuyesfCgc3o)
2、进入任务列表页面，点击**新建任务**，进入新建pub转推任务弹窗
![image.png](https://dn-odum9helk.qbox.me/Fs7Uvdld3ScXgdrEvB1qQjUX1112)

**配置参数及说明**：
|配置项|配置参数|配置说明|
|-|-|-|
|服务区域|国内/海外|创建任务时选择的任务运行区域，注意：海外转推的机房在国外，实现的是海外拉流转推至海外，并不能直接将国内的拉流地址直接转推至海外。<br>国内的流希望转推至海外其他直播平台，可以先国内直播推流至七牛云的全球直播空间，使用七牛云的全球区域hub直播拉流地址，转推至海外的其他直播平台|
|任务名称|英文字符|自定义任务名称，名称仅支持字母和数字，并且不超过20个字符|
|任务描述|中英文字符|自定义任务描述内容，支持中英文等字符，不超过32个字符|
|拉流地址|1、支持直播/点播拉流两种类型<br>2、支持多个拉流地址填写<br>3、支持指定哪个运营商网络拉流：默认/电信/移动/联通|1、添加多个拉流地址时，会在前一个拉流地址结束之后进入下一个拉流地址（添加多个地址场景一般为点播类型的拉流地址）<br>2、海外转推任务不支持运营商网络的选择<br>3、支持直播拉流：rtmp/flv/hls/rtsp协议流；点播拉流：m3u8/flv/mp4视频封装格式（备注：视频的编码格式需要h.264/h.265，音频的编码格式需要为AAC）<br>4、只有点播类型的转推任务支持播放次数的设置|
|推流地址|1、支持多个推流地址填写<br>2、支持指定哪个运营商网络拉流：默认/电信/移动/联通|1、添加多个推流地址时，会同时拉流转推至多个推流地址上，在计费时会计算多倍的推流时长<br>2、海外转推任务不支持运营商网络的选择<br>3、支持推流协议：rtmp协议|
|播放次数|不循环/无限循环/指定循环次数|1、只有拉流地址是点播类型的，才能设置播放器次数，不支持直播类型的拉流地址设置循环播放次数<br>2、在达到播放次数或者定时关闭时间的任一条件之后，系统会停止任务|
|定时开启|时间|设定开启任务的时间|
|定时关闭|时间|设定关闭任务的时间，定时关闭的时间需要在定时开启的时间之后|
|断流重试|时间|1、如果转推任务失败或者中断，在重试时间内，转推任务会进行不断重试拉流转推，直至达到任务重连成功或者达到设定的重试时间（目前的实现逻辑是按照10s重试一次，如果设定的是5分钟，那么最终的重试次数为30次，以重试次数消耗完为准）<br>2、断流重试时间一般在拉流类型为直播时进行设置，点播一般不设置断流重试|
**特殊说明**：转推中断 3 秒后重连，连续转推中断 5 次后状态变为"失败"，转推任务终止。
## **二、管理任务**

### **1、查看任务**

在任务列表中，查看转推任务的状态，默认是国内的任务列表，支持选择查看海外的转推列表
![image.png](https://dn-odum9helk.qbox.me/FkLDfemwSxS70sj7vpt0TtO1ADF-)
### **2、编辑任务**
在任务列表中，选择已经创建成功的转推任务，单击右侧操作栏的**编辑**按钮，进入修改pub转推任务
![image.png](https://dn-odum9helk.qbox.me/FsMcmISw1Xig2_iK-QJLSClllzDZ)
根据需要，可以编辑修改任务备注、拉流地址、推流地址、播放循环次数以及定时开启和定时关闭内容。
**注意：运行中的转推任务，不允许编辑和删除**
### **3、开启/停止任务**
在任务列表中，选择需要开启或者停止的转推任务，找到运行开关一栏，点击开启或者关闭按钮即可。
![image.png](https://dn-odum9helk.qbox.me/Fj5pYTFssr2zNJqmvAqQ1xA4prhn)
### **4、删除任务**
在任务列表中，找到对应需要删除的转推任务，点击删除按钮，确认是否删除，点击确认即可将此转推任务删除。
注意：转推任务删除后不支持找回，如有需要，可以重新创建对应的转推任务。
![image.png](https://dn-odum9helk.qbox.me/Fq05kNYhRiQ_t8Sgxl0D1qVZ9FYe)
### **5、运行日志**
运行日志为最近一次转推任务运行的日志信息，这个信息对专业知识要求较高，一般用于查看转推任务失败原因。
在转推失败时，[咨询我们售后同学](https://support.qiniu.com/tickets/new/?space=%E7%9B%B4%E6%92%AD%E4%BA%91)时，可以附带此运行日志，方便我们这边排查对应的失败原因。
![image.png](https://dn-odum9helk.qbox.me/FsIxoe3sdpmUuLKokH6F_TUyMdAk)
## **三、历史记录查询**
查看转推任务的转推记录
支持根据**任务的开始时间**进行搜索，也可以根据任务名称进行搜索该任务的转推记录。
![image.png](https://dn-odum9helk.qbox.me/FgGcdjXIKXP6dsWbMA4suYEWdnxO)
点击查看时，为查看当时转推任务的运行日志，如下图
![image.png](https://dn-odum9helk.qbox.me/FrePl-vIUkcFTfPP_psFke9u-_KG)

