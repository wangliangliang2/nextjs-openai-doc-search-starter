七牛rtmp延迟测试方案

首先需要了解的是，为什么客户自己测试的网络延迟会很高，rtmp 达到 10秒，hls 达到 20秒左右。 

原因很简单，因为客户通常测试采用的都是 obs 的推流，播放器采用一些软件播放器，例如 vlc 来播放 rtmp 的推流或者 hls 的推流。通常这类播放器都是存在一定的缓存 buffer ，导致延迟可能会变大等情况。

所以，测试需要按照七牛的推流 sdk 与播放 sdk ，或者推流 sdk 与七牛的网页 flash 播放器结果测试为准。

测试延迟准备

首先要确保网络是 ok 的。尽量保证是独享带宽：

直播我们一般是建议主播使用电信和联通的独享宽带。 铁通、移动、长城、鹏博士这种网络的上下行带宽都不是独享的，到了晚高峰期的时候都是共享而且上行带宽会出现即为不稳定，影响到主播推流

主播过程中可能会遇到的问题，平时常见问题是下面两个：

1. 主播 低端机型，例如主播是 500元以下的安卓机型或者 iphone4s 以下的机型推流。
由于硬件设施差，且在加美颜滤镜的情况下，导致的推流效果差，所以在产品层面上，
限制低端机型主播推流，有利于观众观看的效果提升
2. 网络环境
目前稳定的上行一般是电信 或 联通 的独享宽带，其他宽带，例如移动、鹏博士等 wifi ，可能由于上行带宽不足或不稳定造成推流端卡顿

上面这两个问题是比较常见的，建议你们可以根据实际情况在产品层面上 fix 掉，另外在使用我们 SDK 的过程中遇到问题可以随时在这里反馈，由于每个客户的情况都是不一样的，遇到的问题也是各有不同，我们当前版本是比较稳定的，在使用方法上有问题可以在群里面随时咨询我们

首先需要按照七牛的推流 app ，以及播放 app ，因为一个人不能同时拥有两个手机，那么就可以使用七牛提供的一个测试的 flash 播放器

播放器连接为：

网页播放器

```
http://7xjsbn.media1.z0.glb.clouddn.com/live_test.swf
```

app推流
```
安卓：
版本：1.2.2
项目demo链接：https://github.com/qiniudemo/qiniu-live-android
app链接：http://devtools.qiniu.com/QLive-v1.2.2.apk
iOS：
版本：1.1.0
sdk版本：2.0.21(播放器) 1.8.0（推流端）
最低版本：iOS7
项目demo链接：https://github.com/qiniudemo/qiniu-live-iOS
app链接：https://dn-devtools.qbox.me/QNPilePlayDemo-v1.1.1.html
```

app推流端的使用流程为： 

1. 首先要手机注册一下。 
2. 然后在用户端选择录制视频。先推个几秒的视频。 
3. 然后退回来，找到播放地址，点击复制，就能拷贝出你的播放地址了。 
4. 重新录制（录制就是推流）准备好开始测试。

开始测试延迟

1. 手机端开始录制推流，录制的内容选择pc的网页。在网页中百度下时间，会出现当前的时间。
2. 同时开两个浏览器，一个显示时间，另一个用来显示播放器。
3. 录制的时候，只录制时间。并点开播放器。
4. pc qq 截图

结果如下，可以看到播放器播放的是之前5秒的视频，也就是延迟5秒。
![](https://dn-odum9helk.qbox.me/FsnWQhQuD7c8K7s7ffOtHFR5Ka41)
