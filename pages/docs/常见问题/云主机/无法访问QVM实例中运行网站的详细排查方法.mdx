<blockquote><p><strong>免责声明：&nbsp;</strong>本文档可能包含第三方产品信息，该信息仅供参考。七牛云对第三方产品的性能、可靠性以及操作可能带来的潜在影响，不做任何暗示或其他形式的承诺。</p></blockquote><h1 font-weigh = "bold" id="cXbii"><strong>概述</strong></h1><p>本文主要介绍无法访问QVM实例中运行网站的排查方法。</p><h1 font-weigh = "bold" id="SHBrY">详细信息</h1><blockquote><p data-spm-anchor-id="a2c9r.12641779.0.i0.1badSS8aSS8aLc">七牛云提醒您：</p><ul><li data-spm-anchor-id="a2c9r.12641768.0.i10.57bb5e3bmxozwF">如果您对实例或数据有修改、变更等风险操作，务必注意实例的容灾、容错能力，确保数据安全。</li><li data-spm-anchor-id="a2c9r.12641779.0.i0.b170EQFdEQFdJ5">如果您对实例（包括但不限于QVM、RDS）等进行配置与数据修改，建议提前创建快照或开启RDS日志备份等功能。</li><li data-spm-anchor-id="a2c9r.12641779.0.i2.1badSS8aSS8aLc">如果您在七牛云平台授权或者提交过登录账号、密码等安全信息，建议您及时修改。</li></ul></blockquote><p>无法打开网站时，应该先查看报错提示的含义，查看报错原因。如果没有返回状态码，可参考以下步骤进行排查。</p><ul><li><a href="#h_3635120323071590042175297">网络通信问题</a></li><li id="网络通信问题"><a class="from-extensions-error" href="#端口通信问题">端口通信问题</a></li><li><a class="from-extensions-error" href="#防火墙配置异常">防火墙配置异常</a></li><li><a class="from-extensions-error" href="#安全组公网规则">重新配置安全组公网规则</a></li><li><a href="#WSwYj">其他问题</a></li></ul><h2 font-weigh = "bold" id="h_3635120323071590042175297">网络通信问题</h2><p>本节主要介绍分别在Linux系统和Windows系统中网络通信问题的排查方法。</p><h3 font-weigh = "bold" id="linuxconnection">Linux实例网络通信问题排查</h3><ol><li><p>执行<code>ifconfig</code>或者<code>ip addr</code>命令，查看IP地址。<span style="letter-spacing: 0.05em;">系统显示类似如下。</span></p><img src="http://qey2kbifv.hn-bkt.clouddn.com/2020-08-13/x7BhQt3aOb0ngIrpLc25.png" width="563" height="303"><br><img src="http://qey2kbifv.hn-bkt.clouddn.com/2020-08-13/hfTEYNDBSeMrjukdxUcK.png" width="562" height="165">&nbsp; &nbsp;</li><li><p>执行以下命令，通过实例路由表查看网关。</p><pre>route -n</pre>系统显示类似如下。<br><img src="http://qey2kbifv.hn-bkt.clouddn.com/2020-08-13/OthW1KTVX6Y7DG2rslJ8.png" width="563" height="104"></li><li>使用ping命令访问公网，检查是否为网络通信问题。</li></ol><h3 font-weigh = "bold" id="windowsconnection">Windows实例网络通信问题排查</h3><ol><li><p>打开命令行窗口，执行以下命令，查看IP地址。</p><pre>ipconfig</pre></li><li><p>执行以下命令，通过实例路由表查看网关。</p><pre>route print</pre><blockquote><strong>说明</strong>：<br><ul><li><p>若网卡驱动未开启或网卡配置有问题，请检查网卡驱动，并重新安装。</p></li><li><p>关于网络相关问题的测试工具，请参见<a class="from-extensions-error" style="letter-spacing: 0.05em;" href="/document_detail/40573.html">ping 丢包或不通时链路测试说明</a>。</p></li></ul></blockquote></li><li>使用ping命令访问公网，检查是否为网络通信问题。</li></ol><h2 font-weigh = "bold" id="端口通信问题">端口通信问题</h2><p>本节主要介绍分别在Linux系统和Windows系统中端口通信问题的排查方法。</p><h3 font-weigh = "bold" id="端口通信问题Linux">Linux实例端口通信问题</h3><ol><li><p>执行以下命令，检测sshd服务的运行状态，确认端口是否有正常监听。</p><pre>netstat -antpu | grep sshd</pre>系统显示类似如下。<br><p><img src="http://qey2kbifv.hn-bkt.clouddn.com/2020-08-13/pSdcZh4NiK3rUYfsRTvg.png" alt="sshdservice"></p></li><li><p>根据不同操作系统，执行下列命令查看服务运行状态。</p><ul><li><p>CentOS 6：<code>service sshd status</code></p></li><li><p>CentOS 7：<code>systemctl status sshd</code></p></li></ul></li><li>如果sshd服务没有正常运行，则根据不同操作系统，执行下列命令手动启动sshd服务。<ul><li>CentOS 6：<code>service sshd restart</code></li><li><p>CentOS 7：<code>systemctl restart sshd</code></p></li></ul></li><li><p>查看sshd程序日志。</p><ul><li><p>如果无法正常启动sshd服务，CentOS 6系统一般会直接输出错误信息，而CentOS 7启动时没有输出信息，需要通过secure日志进行查看。sshd日志所在目录：<code>/var/log/secure</code>。</p></li><li><p>通过secure日志的报错信息，一般是可以定位绝大部分sshd启动异常的问题。</p></li></ul></li></ol><h3 font-weigh = "bold" id="端口通信问题Windows">Windows 实例端口通信问题</h3><p>依次执行以下命令，检测远程端口，其中[$PID]为第一条命令返回的PID值。</p><pre>Tasklist /svc | findstr "Ter"<br>netstat -ano | findstr "[$PID]"</pre><p>系统返回类似如下。</p><p><img src="http://qey2kbifv.hn-bkt.clouddn.com/2020-08-13/EICiL0prQOUXw7zu9Mdm.png" alt="remoteport"></p><h2 font-weigh = "bold" id="防火墙配置异常">防火墙配置异常</h2><p>本节主要介绍分别在Linux系统和Windows系统中防火墙配置异常的排查方法。</p><h3 font-weigh = "bold" id="防火墙配置异常Windows">Windows实例中关闭防火墙后连接恢复正常</h3><blockquote><p><strong>注意：</strong>只有在已授权可关闭防火墙的情况下，才能做该项排查。</p></blockquote><ol><li><p>调整防火墙配置策略。</a>。</p></li><li><p>调整后，重新进行远程连接。</p></li></ol><h3 font-weigh = "bold" id="防火墙配置异常Linux">Linux实例中关闭Iptables后连接恢复正常</h3><blockquote><p><strong>注意：</strong>只有在已授权可关闭Iptables的情况下，才能做调整Iptables配置策略排查。</p></blockquote><ol><li><p>执行以下命令，查看防火墙规则。</p><pre>iptables -nvL --line-number</pre><blockquote><strong>说明</strong>：<br><ul><li><p>-n：不对IP地址进行反查，加上这个参数显示速度会快很多。</p></li><li><p>-v：输出详细信息，包含通过该规则的数据包数量、总字节数及相应的网络接口。</p></li><li><p>-L：查看当前表的所有规则，默认查看的是filter表，如果要查看NAT表，可以加上<code>-t NAT</code>参数。</p></li></ul></blockquote></li><li><p>修改iptables规则，具体操作步骤如下所示。</p><blockquote><strong>说明</strong>：如果之前已设置过规则策略，则执行<code>cp -a /etc/sysconfig/iptables /etc/sysconfig/iptables.bak</code>命令保存一份原有的Iptables文件，避免丢失已设置过策略。</blockquote><ol><li><p>执行以下命令，清空实例上所有的规则。</p><pre>iptables -F</pre></li><li><p>执行以下命令，拒绝INPUT方向所有的请求。</p><pre>iptables -P INPUT DROP</pre><blockquote><strong>注意</strong>：线上业务请勿直接操作，会导致业务直接中断。</blockquote></li><li><p>依次执行下列命令，放行80端口。</p><pre>iptables -A INPUT -p tcp --dport 80 -j ACCEPT<br>iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT</pre>或者您也可以参见以下命令，允许指定IP访问80端口，此处以“192.168.1.1”为例。<pre>iptables -I INPUT -s 192.168.1.1 -p tcp --dport 80 -j ACCEPT</pre></li><li><p>执行以下命令，查看添加的规则是否生效。</p><pre>iptables -L</pre>系统显示类似如下。<p><img src="http://qey2kbifv.hn-bkt.clouddn.com/2020-08-13/CO5atMwmfNS7EPWDRkQx.png" alt="iptables -L"></p></li><li><p>执行以下命令，保存添加的规则。</p><pre>iptables-save &gt; /etc/sysconfig/iptables</pre></li></ol></li><li><p>执行<code>service iptables restart</code>或<code>/etc/init.d/iptables restart</code>命令，重启Iptables。</p></li><li><p>执行以下命令，重启实例验证配置。</p><pre>systemctl reboot</pre></li><li><p>重新进行SSH连接实例。</p></li></ol><h2 font-weigh = "bold" id="安全组公网规则">重新配置安全组公网规则</h2><p>由于安全组默认没有放行网站使用的端口（如80端口），因此需要自行放行该端口。以下是放行该端口的具体操作步骤，添加安全组公网规则。</p><ol><li>登录<a class="from-extensions-error" title="登陆 QVM 控制台" href="https://portal.qiniu.com/qvm/dashboard">QVM 控制台</a>，定位实例。</li><li>单击实例ID，进入详情页，再单击<strong>本实例安全组</strong>&gt;<strong>安全组列表</strong>&gt;<strong>配置规则</strong>。</li><li>根据网站使用的端口配置新的安全组规则，放行网站使用的端口，最后单击<strong>确定</strong>。</li></ol><h1 font-weigh = "bold" id="PQTnK">适用于</h1><ul><li>云服务器QVM</li></ul>  </div>              	