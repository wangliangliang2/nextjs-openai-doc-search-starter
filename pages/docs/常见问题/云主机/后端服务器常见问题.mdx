# 问题：负载均衡实例最多支持添加多少 QVM 实例？

<br>

默认每个负载均衡实例可以添加 200 个 QVM 实例，一个 QVM 实例可以被 50 个负载均衡实例关联。**但是**如果你需要添加更多 QVM 实例，请提交工单申请。通过审核后，为你提升配额。

为了保证你对外服务的稳定与高效，建议你根据业务分类或应用服务的模块划分将提供不同服务或执行不同任务的应用服务器配置在不同的负载均衡实例上。

<br>

# 问题：负载均衡运行中是否可调整服务器数量？

<br>

可以

你可以在任意时刻增加或减少负载均衡的后端服务器实例数量并且支持不同服务器实例之间的切换。但是为了保证你对外服务的稳定，确保在执行上述操作时，开启了负载均衡的健康检查功能并保证负载均衡后端至少有一台正常运行的服务器实例。

<br>

# 问题：后端服务器实例为什么访问不了负载均衡服务？

<br>

这和负载均衡 TCP 的实现机制有关。在四层 TCP 协议服务中，不支持后端服务器实例既作为 Real Server 又作为客户端向所在的负载均衡实例发送请求。因为返回的数据包只在云服务器内部转发，不经过负载均衡，所以在后端服务器实例上去访问负载均衡的服务地址是不通的。

<br>

# 问题：QVM 实例在接入负载均衡服务前添加了白名单，对负载均衡服务有影响么？

<br>

若 QVM 实例在接入负载均衡前设置了访问白名单，那么接入负载均衡后需要将负载均衡的白名单添加到 QVM 实例中，否则可能会引起网站`403`报错。

需要添加的负载均衡地址包括 100.64.0.0/10、10.158.0.0/16、10.159.0.0/16 和 10.49.0.0/16。

<br>

# 问题：为什么有 10 或 100 开头的 IP 在频繁访问 QVM 实例？

<br>

负载均衡系统除了会通过系统服务器的内网 IP 将来自外部的访问请求转到后端 QVM 实例之外，还会对 QVM 实例进行健康检查和可用性监控，这些访问的来源都是由负载均衡系统发起的。

负载均衡系统的地址段为 100.64.0.0/10、10.158.0.0/16、10.159.0.0/16 和 10.49.0.0/16，所以会有很多 10或 100 开头的 IP 地址访问 QVM 实例。

为了确保你对外服务的可用性，确保对上述地址的访问配置了放行规则。

<br>

# 问题：要使用负载均衡服务，QVM实例是否需要进行特殊配置？

<br>

添加到负载均衡实例的后端 QVM 实例，一般不需要进行特别的配置。

但是，如果后端 QVM 实例的操作系统为 Linux 并且使用了 TCP 监听，确保系统配置文件`/etc/sysctl.conf`中以下三个配置的值为零：

```
net.ipv4.conf.default.rp_filter = 0
net.ipv4.conf.all.rp_filter = 0
net.ipv4.conf.eth0.rp_filter = 0
```

如果部署在同一内网网段下的 QVM 实例之间有通信需求，需要检查如下参数的配置是否正确：

```
net.ipv4.conf.default.arp_announce =2
net.ipv4.conf.all.arp_announce =2
```

更改配置后，执行 sysctl -p 更新配置。

<br>

# 问题：QVM 实例设置权重的作用是什么？

<br>

权重比越高的 QVM 实例将被分配到更多的访问请求，你可以根据后端 QVM 实例的对外服务能力和需求来区别设定。

假设负载均衡池中的 A 和 B 两台 QVM 实例的权重均配置成 100 和均配置成 50 都是一样的，在 A 和 B 两台 QVM 实例健康检查状态均正常的情况下，QVM 实例 A 和 B 均分前端请求的流量。但是如果 A 和 B 的权重分别设置为 10 和 100，在 A 和 B 两台 QVM 实例健康检查状态均正常的情况下，A 承担 10/(10+100) 的流量，B 承担 100/(10+100) 的流量。

如果你同时开启了会话保持功能，有可能会造成后端 QVM 实例访问不均衡，建议你暂时关闭会话保持功能再观察一下是否依然存在这种情况。

当负载均衡分发到后端 QVM 实例的请求不均匀时，参考以下方法检查处理：

- 统计一个时间段内后端 QVM 实例的 Web 服务访问日志的数据量。访问日志查看方法：

 - Nginx 和 Apache：打开日志目录`/access.log`

 - IIS：打开 IIS 管理界面，鼠标放在需要设置开启日志的站点上，单击右键，选择**属性**，选择**网站**选项卡，单击**启用日志记录**

- 按照负载均衡的配置，对比多个 QVM 实例日志的数量是否有差距。
  
  如果设置了会话保持，需要剥离相同 IP 的访问日志。如果负载均衡配置了权重，要根据权重比例计算日志中访问比例是否正常。