
<a id="intro"></a>
# ç®€ä»‹

æ­¤ SDK é€‚ç”¨äº Go 1.10.0 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚ä½¿ç”¨æ­¤ SDK æ„å»ºæ‚¨çš„ç‰©è”ç½‘æ•°æ®äº‘æœåŠ¡ï¼Œå®¢æˆ·å¯ç®€å•å¿«é€Ÿåœ°å®ç°è®¾å¤‡æ¥å…¥ã€äº‘ç«¯å­˜å‚¨ã€è¿œç¨‹è§‚çœ‹ç­‰ä¸€ç«™å¼è§†é¢‘åœºæ™¯èƒ½åŠ›ï¼Œä¸ƒç‰›äº‘åŠå…¶ SDKæ”¯æŒè®¾å¤‡ç®¡ç†ã€å­˜å‚¨ç®¡ç†ã€è§†é¢‘ç®¡ç†ï¼Œå¸®åŠ©æ™ºèƒ½è§†é¢‘ç¡¬ä»¶å‚å•†æ›´å¿«æ·åœ°ä½¿è®¾å¤‡æ¥å…¥äº‘æœåŠ¡ã€‚

<a id="opensource"></a>
# å¼€æº

- [Go SDK é¡¹ç›®åœ°å€](https://github.com/qiniu/api.v7)
- [Go SDK å‘å¸ƒåœ°å€](https://github.com/qiniu/api.v7/releases)

<a id="install"></a>
# å®‰è£…

æŒ‰ç…§Goè¯­è¨€çš„æ¨èæ–¹å¼ï¼Œä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤å®‰è£…ï¼š

```
$ go get -u github.com/qiniu/api.v7
```

<a id="api-auth"></a>
# é‰´æƒ

ä¸ƒç‰› Go SDK çš„æ‰€æœ‰çš„åŠŸèƒ½ï¼Œéƒ½éœ€è¦åˆæ³•çš„æˆæƒã€‚æˆæƒå‡­è¯çš„ç­¾ç®—éœ€è¦ä¸ƒç‰›è´¦å·ä¸‹çš„ä¸€å¯¹æœ‰æ•ˆçš„`Access Key`å’Œ`Secret Key`ï¼Œè¿™å¯¹å¯†é’¥å¯ä»¥é€šè¿‡å¦‚ä¸‹æ­¥éª¤è·å¾—ï¼š

1. ç‚¹å‡»[æ³¨å†ŒğŸ”—](https://portal.qiniu.com/signup)å¼€é€šä¸ƒç‰›å¼€å‘è€…å¸å·
2. å¦‚æœå·²æœ‰è´¦å·ï¼Œç›´æ¥ç™»å½•ä¸ƒç‰›å¼€å‘è€…åå°ï¼Œç‚¹å‡»[è¿™é‡ŒğŸ”—](https://portal.qiniu.com/user/key)æŸ¥çœ‹ Access Key å’Œ Secret Key


# è®¾å¤‡ç®¡ç†
LINKINGè®¾å¤‡ç®¡ç†æ”¯æŒè®¾å¤‡çš„æ·»åŠ ã€è®¾å¤‡ä¿¡æ¯çš„æŸ¥è¯¢å’Œæ›´æ–°ã€è®¾å¤‡çš„åˆ é™¤ã€è®¾å¤‡åˆ—è¡¨çš„æŸ¥è¯¢ä»¥åŠè®¾å¤‡åœ¨çº¿è®°å½•çš„æŸ¥è¯¢ã€‚


   - <a href="#device-add">æ·»åŠ æ–°è®¾å¤‡</a>
   - <a href="#device-query">æŸ¥è¯¢è®¾å¤‡è¯¦ç»†ä¿¡æ¯</a>
   - <a href="#device-list">æŸ¥è¯¢æ‰€æœ‰è®¾å¤‡åˆ—è¡¨</a>
   - <a href="#device-history-query">æŸ¥è¯¢è®¾å¤‡çš„åœ¨çº¿è®°å½•</a>
   - <a href="#device-update">æ›´æ–°è®¾å¤‡é…ç½®</a>
   - <a href="#device-delete">åˆ é™¤æŒ‡å®šè®¾å¤‡</a>



```
// LINKINGç›¸å…³åŠŸèƒ½çš„å¼•å…¥åŒ…åªæœ‰è¿™ä¸¤ä¸ªï¼Œåé¢ä¸å†èµ˜è¿°
import (
	"github.com/qiniu/api.v7/v7/auth/qbox"
	"github.com/qiniu/api.v7/v7/linking"
)

accessKey := "your access key"
secretKey := "your secret key"
mac := qbox.NewMac(accessKey, secretKey)
```

<a id="device-add"></a>

### **æ·»åŠ æ–°è®¾å¤‡**

åœ¨æŒ‡å®šçš„åº”ç”¨ä¸‹æ·»åŠ è®¾å¤‡ã€‚
```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
dev := &Device{
	Device: "your device name",
	SegmentExpireDays: 7,
}
manager.AddDevice(appid, dev)
```


<a id="device-query"></a>
### **æŸ¥è¯¢è®¾å¤‡è¯¦ç»†ä¿¡æ¯**

æŸ¥è¯¢æŒ‡å®šè®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯ã€‚
```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
device := "your device name"
manager.QueryDevice(appid, device)
```

<a id="device-list"></a>
### **æŸ¥è¯¢æ‰€æœ‰è®¾å¤‡åˆ—è¡¨**

æŸ¥è¯¢æŒ‡å®šåº”ç”¨ä¸‹æ‰€æœ‰è®¾å¤‡çš„åˆ—è¡¨ã€‚
```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
// ä½¿ç”¨è®¾å¤‡åç§°çš„å‰ç¼€è¿›è¡ŒæŸ¥è¯¢
prefix := "sdk-testListDevice"
// onlineä¸ºtrueæ—¶åªè¿”å›åœ¨çº¿çš„è®¾å¤‡
online := false
// statusç”¨äºè¿”å›è®¾å¤‡åˆ—è¡¨ä¿¡æ¯æ˜¯å¦åŒ…å«è®¾å¤‡åœ¨çº¿æ¶ˆæ¯ï¼›status=falseæ—¶ä¸è¿”å›è®¾å¤‡åœ¨çº¿ä¿¡æ¯ï¼Œstatus=trueæ—¶è¿”å›ï¼›è¯¥å‚æ•°åªæœ‰åœ¨online=falseæˆ–ä¸è¾“å…¥onlineå‚æ•°æ—¶æ‰ä¼šç”Ÿæ•ˆ
status := false
// deviceTypeä¸ºè®¾å¤‡ç±»å‹ï¼Œtype=0 åªè¿”å›æ™®é€šè®¾å¤‡ï¼Œtype=1 åªè¿”å›ç½‘å…³è®¾å¤‡ï¼Œtype=2 è¿”å›å…¨éƒ¨è®¾å¤‡(åŒ…å«ç½‘å…³è®¾å¤‡å’Œæ™®é€šè®¾å¤‡)
deviceType := 0
manager.ListDevice(appid, prefix, "", 1000, false, false, 0, "")
```

<a id="device-history-query"></a>
### **æŸ¥è¯¢è®¾å¤‡çš„åœ¨çº¿è®°å½•**

æŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µå†…è®¾å¤‡çš„åœ¨çº¿è®°å½•ã€‚

```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
device := "your device name"
// startã€end ä¸ºå¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ï¼Œunix timestampï¼Œä»¥ç§’ä¸ºå•ä½
start := time.Now().Add(-time.Hour).Unix()
end := time.Now().Unix()
// marker ä¸ºä¸Šæ¬¡åˆ—ä¸¾è¿”å›çš„ä½ç½®æ ‡è®°ï¼Œä½œä¸ºæœ¬æ¬¡åˆ—ä¸¾çš„èµ·ç‚¹ä¿¡æ¯(é»˜è®¤ä¸º"")
marker := ""
// limit ä¸ºæœ€å¤§è¿”å›å¤šå°‘æ¡æ•°æ®,æœ€å¤§1000æ¡
limit := 1000
manager.ListDeviceHistoryactivity(appid, device, int(start), int(end), marker, limit)
```

<a id="device-update"></a>
### **æ›´æ–°è®¾å¤‡é…ç½®**

æ›´æ–°è®¾å¤‡é…ç½®ä¿¡æ¯ã€‚
```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
device := "your device name"

// æ›´æ–°è®¾å¤‡segmentexpiredaysä¸º30
ops := []linking.PatchOperation{  
   PatchOperation{Op: "replace", Key: "segmentExpireDays", Value: 30},  
}
manager.UpdateDevice(appid, device, ops)
```


<a id="device-delete"></a>
### **åˆ é™¤æŒ‡å®šè®¾å¤‡**
åˆ é™¤æŒ‡å®šçš„è®¾å¤‡ã€‚

```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
device := "your device name"
manager.DeleteDevice(appid, device)
```


# è®¾å¤‡ç§˜é’¥ç®¡ç†

è®¾å¤‡ç§˜é’¥ç®¡ç†ã€‚

- <a href="#deviceKey-add">æ–°å¢è®¾å¤‡ç§˜é’¥</a>
- <a href="#deviceKey-query">æŸ¥è¯¢è®¾å¤‡ç§˜é’¥</a>
- <a href="#deviceKey-delete">åˆ é™¤è®¾å¤‡ç§˜é’¥</a>
- <a href="#deviceKey-state-set">ç¦ç”¨ã€å¯ç”¨è®¾å¤‡çš„å¯†é’¥</a>
- <a href="#deviceKey-clone">å…‹éš†è®¾å¤‡ç§˜é’¥</a>
- <a href="#query-by-deviceKey">é€šè¿‡DAKæŸ¥è¯¢ä¿¡æ¯</a>

<a id="deviceKey-add"></a>
### **æ–°å¢è®¾å¤‡ç§˜é’¥**

æ–°å¢è®¾å¤‡çš„å¯†é’¥ï¼Œæ¯ä¸ªè®¾å¤‡æœ€å¤šæœ‰ä¸¤å¯¹å¯†é’¥ã€‚
```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
device := "your device name"
manager.AddDeviceKey(appid, device)
```

<a id="deviceKey-query"></a>
### **æŸ¥è¯¢è®¾å¤‡ç§˜é’¥**

æŸ¥è¯¢æŒ‡å®šè®¾å¤‡çš„å¯†é’¥ã€‚
```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
device := "your device name"

var deviceKeyInfo linking.DeviceKey
deviceKeyInfo, err := manager.QueryDeviceKey(appid, device)
if err != nil {
    fmt.Println(err)
    return
}
```

<a id="deviceKey-delete"></a>
### **åˆ é™¤è®¾å¤‡ç§˜é’¥**

åˆ é™¤è®¾å¤‡çš„å¯†é’¥ã€‚
```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
device := "your device name"
deviceKeyInfo, err := manager.QueryDeviceKey(appid, device)
if err != nil {
    fmt.Println(err)
    return
}
dak := deviceKeyInfo[0].AccessKey
manager.DeleteDeviceKey(appid, device, dak)
```

<a id="deviceKey-state-set"></a>
### **ç¦ç”¨ã€å¯ç”¨è®¾å¤‡çš„å¯†é’¥**
```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
device := "your device name"
deviceKeyInfo, err := manager.QueryDeviceKey(appid, device)
if err != nil {
    fmt.Println(err)
    return
}
dak := deviceKeyInfo[0].AccessKey
state := 1
manager.UpdateDeviceKeyState(appid, device, dak, state)
```

<a id="deviceKey-clone"></a>
### **å…‹éš†è®¾å¤‡ç§˜é’¥**
æŸä¸ªè®¾å¤‡çš„å¯†é’¥å…‹éš†ç»™æ–°çš„è®¾å¤‡ï¼Œä¸ç”¨é‡æ–°å¯¹è®¾å¤‡è¿›è¡Œçƒ§å½•æ–°çš„å¯†é’¥ã€‚
```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
fromDevice := "from device name"
toDevice := "to device name"

// cleanSelfKey ç§˜é’¥å…‹éš†åæ˜¯å¦åˆ é™¤åŸè®¾å¤‡ç§˜é’¥
cleanSelfKey := false

// deleteDevice ç§˜é’¥å…‹éš†åæ˜¯å¦åˆ é™¤åŸè®¾å¤‡
deleteDevice := false

deviceKeyInfo, err := manager.QueryDeviceKey(appid, fromDevice)
if err != nil {
    fmt.Println(err)
    return
}
dak1 := deviceKeyInfo[0].AccessKey
manager.CloneDeviceKey(appid, fromDevice, toDevice, cleanSelfKey, deleteDevice,  dak1)
```

<a id="query-by-deviceKey"></a>
### **é€šè¿‡DAKæŸ¥è¯¢ä¿¡æ¯**

é€šè¿‡dakæŸ¥è¯¢appidå’ŒdeviceNameã€‚

```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
device := "your device name"
deviceKeyInfo, err := manager.QueryDeviceKey(appid, device)
if err != nil {
    fmt.Println(err)
    return
}
dak := deviceKeyInfo[0].AccessKey
realAppid, realDevice, err := manager.QueryAppidDeviceNameByAccessKey(dak)
```

# è§†é¢‘æ’­æ”¾
- <a href="#linking-vod-save">è§†é¢‘ç‰‡æ®µæ”¶è—</a>
- <a href="#linking-vod-api">è§†é¢‘æ’­æ”¾ç±»APIå‚è€ƒ</a>

### **è§†é¢‘ç‰‡æ®µæ”¶è—**
å¯¹æŒ‡å®šçš„è§†é¢‘ç‰‡æ®µè¿›è¡Œæ”¶è—ï¼Œä¿å­˜åœ¨äº‘å­˜å‚¨ä¸Šã€‚

```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
device := "your device name"

end :=  time.Now().Unix() // ç»“æŸæ—¶é—´ï¼Œunix timestamp ä»¥ç§’ä¸ºå•ä½
start := time.Now().Add(-time.Hour).Unix()// å¼€å§‹æ—¶é—´ï¼Œunix timestamp ä»¥ç§’ä¸ºå•ä½
frame := "testSaveas.mp4" // è®¾ç½®ä¿å­˜æ–‡ä»¶çš„åç§°ï¼Œä¸æŒ‡å®šçš„è¯ä¼šé»˜è®¤ç”Ÿæˆ
format := "mp4" // æ–‡ä»¶æ ¼å¼ï¼Œé»˜è®¤å’Œfnameçš„åç¼€ç›¸åŒï¼Œå¦‚æœä¸¤è€…æœ‰å†²çªåˆ™è¿”å›é”™è¯¯

manager.Saveas(appid, device, int(start), int(end), frame, format)
```

<a id="linking-vod-api"></a>
### **è§†é¢‘æ’­æ”¾ç±»APIå‚è€ƒ**
å…¶ä»–è§†é¢‘æ’­æ”¾æ“ä½œï¼Œå»ºè®®ç›´æ¥è°ƒç”¨å¯¹åº”çš„APIã€‚

|æ¥å£|è¯´æ˜|
|---|---|
|[è§†é¢‘å›æ”¾](https://developer.qiniu.io/linking/api/5650/the-playback)|è¯¥æ¥å£ç”¨äºæŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µçš„è§†é¢‘ç‰‡æ®µè¿›è¡Œå½•åƒå›æ”¾|
|[ç›´æ’­è§‚çœ‹](https://developer.qiniu.io/linking/api/5903/live-Standard-Edition)|è¯¥æ¥å£ç”¨æˆ·rtmpå¯æ§æ¨æµçš„ç›´æ’­è§‚çœ‹åŠŸèƒ½|
|[ç¼©ç•¥å›¾æŸ¥è¯¢](https://developer.qiniu.io/linking/api/5651/the-thumbnail-query)|è¯¥æ¥å£ç”¨äºæŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µå†…è§†é¢‘ç‰‡æ®µçš„ç¼©ç•¥å›¾|
|[è§†é¢‘ç‰‡æ®µæŸ¥è¯¢](https://developer.qiniu.io/linking/api/5646/video-fragment-query)|è¯¥æ¥å£ç”¨äºæŸ¥è¯¢æŸä¸ªæ—¶é—´æ®µå†…çš„è§†é¢‘åˆ‡ç‰‡çš„ç‰‡æ®µè®°å½•|
|[å€é€Ÿæ’­æ”¾](https://developer.qiniu.io/linking/api/5648/times-the-speed-of-playback)|è¯¥æ¥å£ç”¨äºè®¾ç½®è§†é¢‘å›æ”¾çš„æ’­æ”¾å€é€Ÿ|
|[å»¶æ—¶ç›´æ’­](https://developer.qiniu.io/linking/api/5649/delay-live)|è¯¥æ¥å£å¯ç”¨äºè§†é¢‘ç›´æ’­çš„å»¶æ—¶æ’­æ”¾|

# è®¾å¤‡è®¿é—®å‡­è¯

æˆ‘ä»¬å¼•å…¥è®¾å¤‡è®¿é—®å‡­è¯ï¼Œç”±ä¸ƒç‰›è´¦å·çš„å¯†é’¥å¯¹ç­¾ç®—ç”Ÿæˆå¯¹è®¾å¤‡èµ„æºä¸´æ—¶æ€§è®¿é—®çš„å‡­è¯ã€‚

è®¿é—®ç­–ç•¥
```
{
    "appid": "<appid>",  // ä½¿ç”¨ä¸ƒç‰›è´¦å·å¯†é’¥å¯¹ç­¾åæ—¶ï¼Œéœ€è¦è¯¥å­—æ®µ
    "device": "<deviceName>", // ä½¿ç”¨ä¸ƒç‰›è´¦å·å¯†é’¥å¯¹ç­¾åæ—¶ï¼Œéœ€è¦è¯¥å­—æ®µ
    "deadline": <deadlineTimestamp>, // tokenæœ‰æ•ˆæ—¶é—´
    "random": <randomNumber>, // éšæœºæ•°ï¼Œç”¨æ¥ä¿è¯DEVICE ACCESS TOKENå…¨å±€å”¯ä¸€
    "statement":[
        {
            "action": "linking:vod"
        },
        {
            "action": "linking:tutk"
        },
        {
            "action": "linking:status"
        } 
    ]
}
```
å…¶ä¸­å¯†é’¥å¯¹å¯ä»¥é‡‡ç”¨ä¸ƒç‰›è´¦å·æˆ–è®¾å¤‡ç«¯çš„å¯†é’¥å¯¹ï¼Œå¦‚æœä½¿ç”¨è®¾å¤‡ç«¯çš„å¯†é’¥å¯¹ç­¾ååˆ™è®¿é—®ç­–ç•¥ä¸­ä¸éœ€è¦appå’Œdeviceå­—æ®µã€‚å½“å‰tutkç›¸å…³çš„actionåªæ”¯æŒè®¾å¤‡ç«¯å¯†é’¥ã€‚

actionåˆ—è¡¨
```
linking:status è®¾å¤‡åŸºç¡€ä¿¡æ¯/ä¸Šä¸‹çº¿è®°å½•
linking:vod å›æ”¾ç›¸å…³(åˆ‡ç‰‡ç‰‡æ®µæŸ¥è¯¢ã€æˆªå¸§ã€ä¼ªç›´æ’­ã€å€é€Ÿæ’­æ”¾ç­‰)
linking:tutk tutkå»ºè¿
linking:rpc rpc æ§åˆ¶
```

```
mac := auth.New(AccessKey, SecretKey)
manager := NewManager(mac, nil)
appid := "your appid name"
device := "your device name"
deadline := time.Now().Add(time.Hour*5).Unix()

// è®¾å¤‡åŸºç¡€ä¿¡æ¯/ä¸Šä¸‹çº¿è®°å½•
statusToken, err := manager.Token(appid, device, deadline, []linking.Statement{{Action: "linking:status"}})

// è§†é¢‘å›æ”¾/ç¼©ç•¥å›¾æŸ¥è¯¢/å€é€Ÿæ’­æ”¾/å»¶æ—¶ç›´æ’­/è§†é¢‘ç‰‡æ®µæŸ¥è¯¢
vodToken, err := manager.Token(appid, device, deadline, []linking.Statement{{Action: "linking:vod"}})

// tutkå»ºè¿
tutkToken, err := manager.Token(appid, device, deadline, []linking.Statement{{Action: "linking:tutk"}})
```



