# **ç®€ä»‹**

æ­¤SDKä¸»è¦å¸®åŠ©æ‚¨å¿«é€Ÿæ¥å…¥ä¸ƒç‰›äº‘çš„è§†é¢‘ç›‘æ§å¹³å°ã€‚

ä¸»è¦æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š

- ç©ºé—´ç®¡ç†
- æµç®¡ç†
- è®¾å¤‡ç®¡ç†
- æ¨¡æ¿ç®¡ç†
- å½•åˆ¶ç®¡ç†
- æ•°æ®ç»Ÿè®¡ç®¡ç†

# **å¼€æº**

- [Go SDK é¡¹ç›®åœ°å€](https://github.com/qiniu/go-sdk)
- [Go SDK å‘å¸ƒåœ°å€](https://github.com/qiniu/go-sdk/releases)

# **å®‰è£…**

æ¨èä½¿ç”¨ go mod ï¼Œ `github.com/qiniu/go-sdk/v7` ï¼Œå¦‚ `require github.com/qiniu/go-sdk/v7 v7.9.6` 

# **é‰´æƒ**

ä¸ƒç‰› Go SDK çš„æ‰€æœ‰çš„åŠŸèƒ½ï¼Œéƒ½éœ€è¦åˆæ³•çš„æˆæƒã€‚æˆæƒå‡­è¯çš„ç­¾ç®—éœ€è¦ä¸ƒç‰›è´¦å·ä¸‹çš„ä¸€å¯¹æœ‰æ•ˆçš„`Access Key`å’Œ`Secret Key`ï¼Œè¿™å¯¹å¯†é’¥å¯ä»¥é€šè¿‡å¦‚ä¸‹æ­¥éª¤è·å¾—ï¼š

1. ç‚¹å‡»[æ³¨å†Œ](https://portal.qiniu.com/signup)å¼€é€šä¸ƒç‰›å¼€å‘è€…å¸å·
2. å¦‚æœå·²æœ‰è´¦å·ï¼Œç›´æ¥ç™»å½•ä¸ƒç‰›å¼€å‘è€…åå°ï¼Œç‚¹å‡»[è¿™é‡ŒğŸ”—](https://portal.qiniu.com/user/key)æŸ¥çœ‹ Access Key å’Œ Secret Key

# **å¿«é€Ÿæ¥å…¥**

ä¸‹é¢ä»¥`rtmp`æ¥å…¥æ–¹å¼ä¸¾ä¾‹ï¼Œè®²è¿°æ¥å…¥æµç¨‹ï¼Œsdkæ¥å£è¯¦ç»†è¯´æ˜è§åé¢çš„ç« èŠ‚

- 1. åˆ›å»ºqvs manager

  ```go
  ak := "your access key"
  sk := "your secret key"
  mac := auth.New(ak, sk)
  manager := qvs.NewManager(mac, nil)
  ```

- 2. åˆ›å»ºç©ºé—´

  æ„é€ å¥½`NameSpace`ç»“æ„ä½“ä¹‹åï¼Œè°ƒç”¨`AddNamespace`åˆ›å»ºç©ºé—´

  ```go
  ns := &NameSpace{
  	Name:        "testNamespace",
  	AccessType:  "rtmp",// æ¥å…¥ç±»å‹"gb28181"æˆ–è€…â€œrtmpâ€
  	RTMPURLType: 1, // accessTypeä¸ºâ€œrtmpâ€æ—¶ï¼Œæ¨æ‹‰æµåœ°å€è®¡ç®—æ–¹å¼ï¼Œ1:static, 2:dynamic
  	Domains:     []string{"qiniu1.com"}, // ç›´æ’­åŸŸå
  }
  ns1, err := manager.AddNamespace(ns)
  ```

- 3. åˆ›å»ºæµ

  æ„é€ å¥½`Stream`ç»“æ„ä½“ä¹‹åï¼Œè°ƒç”¨`AddStream`åˆ›å»ºæµ

  ```
  stream := &Stream{
  	StreamID: "test001",
  }
  _, err = manager.AddStream(ns1.ID, stream)
  ```

- 4. ç”Ÿæˆæ¨æ‹‰æµåœ°å€

  ```
  ret, err := manager.DynamicPublishPlayURL("2akrarwwhi0ff", "test1", &qvs.DynamicLiveRoute{PublishIP: "127.0.0.1", PlayIP: "127.0.0.1", UrlExpireSec: 0})
  if err != nil {
  	fmt.Printf("err=%s\n", err.Error())
  }
  publishUrl := ret.PublishUrl
  playUrl := ret.PlayUrls.Rtmp
  ```

- 5. åœ¨æ¨æµç«¯(ä¸€èˆ¬æ˜¯æ‘„åƒå¤´)ä½¿ç”¨`publishUrl`æ¨æµ

- 6. å¯ä»¥ä½¿ç”¨`ffplay`æˆ–è€…`vlc`æ’­æ”¾`playUrl`çš„æµ

# **ç©ºé—´ç®¡ç†**

ç©ºé—´ç®¡ç†çš„æ‰€æœ‰æ¥å£éœ€è¦å…ˆé€šè¿‡`ak`ã€`sk`åˆ›å»ºqvs manager

```go
ak := "your access key"
sk := "your secret key"
mac := auth.New(ak, sk)
manager := qvs.NewManager(mac, nil)
```
<br />

## **åˆ›å»ºç©ºé—´**

```go
func (manager *Manager) AddNamespace(ns *NameSpace) (*NameSpace, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜                                                         |
| ---- | ------------------------------------------------------------ |
| ns   | ç©ºé—´ç›¸å…³å‚æ•°ï¼Œè¯¦è§[NameSpaceç»“æ„ä½“è¯´æ˜](#NameSpaceç»“æ„ä½“è¯´æ˜) |

### NameSpaceç»“æ„ä½“è¯´æ˜

| æˆå‘˜                   | ç±»å‹     | æ˜¯å¦å¿…é¡»                   | è¯´æ˜                                                         |
| ---------------------- | -------- | -------------------------- | ------------------------------------------------------------ |
| ID                     | string   | å¦                         | ç©ºé—´id                                                       |
| Name                   | string   | æ˜¯                         | ç©ºé—´åç§°(æ ¼å¼"^[a-zA-Z0-9_-]{1,100}$")                       |
| Desc                   | string   | å¦                         | ç©ºé—´æè¿°                                                     |
| AccessType             | string   | æ˜¯                         | æ¥å…¥ç±»å‹"gb28181"æˆ–è€…â€œrtmpâ€                                  |
| RTMPURLType            | int      | å½“accessTypeä¸º"rtmp"æ—¶å¿…å¡« | accessTypeä¸ºâ€œrtmpâ€æ—¶ï¼Œæ¨æ‹‰æµåœ°å€è®¡ç®—æ–¹å¼ï¼Œ1:static, 2:dynamic |
| Zone                   | string   | å¦                         | zoneä¸ºæœåŠ¡åŒºåŸŸé…ç½®é¡¹ï¼Œå¯é€‰é¡¹ä¸ºz0ã€z1ã€z2ï¼Œé»˜è®¤ä¸ºz0ã€‚z0è¡¨ç¤ºåä¸œã€z1è¡¨ç¤ºååŒ—ã€z2è¡¨ç¤ºåå— |
| Domains                | []string | å½“rtmpUrlTypeä¸º1æ—¶å¿…å¡«     | ç›´æ’­åŸŸå                                                     |
| Callback               | string   | å¦                         | åå°æœåŠ¡å™¨å›è°ƒURL                                            |
| Disabled               | bool     | å¦                         | æµæ˜¯å¦è¢«å¯ç”¨ï¼Œfalse:å¯ç”¨ï¼Œtrue:ç¦ç”¨                           |
| RecordTemplateId       | string   | å¦                         | å½•åˆ¶æ¨¡ç‰ˆid                                                   |
| SnapShotTemplateId     | string   | å¦                         | æˆªå›¾æ¨¡ç‰ˆid                                                   |
| RecordTemplateApplyAll | bool     | å¦                         | ç©ºé—´æ¨¡ç‰ˆæ˜¯å¦åº”ç”¨åˆ°å…¨å±€                                       |
| SnapTemplateApplyAll   | bool     | å¦                         | æˆªå›¾æ¨¡ç‰ˆæ˜¯å¦åº”ç”¨åˆ°å…¨å±€                                       |
| HLSLowLatency          | bool     | å¦                         | HLSä½å»¶æ—¶å¼€å…³                                                |
| CreatedAt              | int64    | å¦                         | ç©ºé—´åˆ›å»ºæ—¶é—´                                                 |
| UpdatedAt              | int64    | å¦                         | ç©ºé—´æ›´æ–°æ—¶é—´                                                 |
| DevicesCount           | int64    | å¦                         | è®¾å¤‡æ•°é‡                                                     |
| StreamCount            | int64    | å¦                         | æµæ•°é‡                                                       |
| OnlineStreamCount      | int64    | å¦                         | åœ¨çº¿æµæ•°é‡                                                   |
| DisabledStreamCount    | int64    | å¦                         | ç¦ç”¨æµæ•°é‡                                                   |
| OnDemandPull           | bool     | å¦                         | æŒ‰éœ€æ‹‰æµå¼€å…³ï¼Œé»˜è®¤å…³é—­                                         | 

### ç¤ºä¾‹

```go
ns := &NameSpace{
	Name:        "testNamespace",
	AccessType:  "rtmp",// æ¥å…¥ç±»å‹"gb28181"æˆ–è€…â€œrtmpâ€
	RTMPURLType: 1, // accessTypeä¸ºâ€œrtmpâ€æ—¶ï¼Œæ¨æ‹‰æµåœ°å€è®¡ç®—æ–¹å¼ï¼Œ1:staticï¼Œ2:dynamic
	Domains:     []string{"qiniu1.com"}, // ç›´æ’­åŸŸå
}
ns1, err := manager.AddNamespace(ns)
```
<br />

## **åˆ é™¤ç©ºé—´**

```go
func (manager *Manager) DeleteNamespace(nsId string)
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜   |
| ---- | ------ |
| nsId | ç©ºé—´id |

### ç¤ºä¾‹

```go
// åˆ é™¤ç©ºé—´
nsId := "2akrarsj8zp0w"
manager.DeleteNamespace(nsId)
```
<br />

## **æ›´æ–°ç©ºé—´**

```go
func (manager *Manager) UpdateNamespace(nsId string, ops []PatchOperation) (*NameSpace, error) 
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜                                                         |
| ---- | ------------------------------------------------------------ |
| nsId | ç©ºé—´id                                                       |
| ops  | æ“ä½œé›†ï¼Œè¯¦è§[PatchOperationç»“æ„ä½“è¯´æ˜](#PatchOperationç»“æ„ä½“è¯´æ˜) |

### PatchOperationç»“æ„ä½“è¯´æ˜

| æˆå‘˜  | ç±»å‹      | è¯´æ˜                                            |
| ----- | --------- | ----------------------------------------------- |
| Op    | string    | æ›´è¯¥æˆ–åˆ é™¤æŸä¸ªå±æ€§ï¼Œreplaceï¼šæ›´æ”¹ï¼Œdeleteï¼šåˆ é™¤ |
| Key   | string    | è¦ä¿®æ”¹æˆ–åˆ é™¤çš„å±æ€§                              |
| Value | interface | è¦ä¿®æ”¹æˆ–åˆ é™¤å±æ€§çš„å€¼                            |

### ç¤ºä¾‹

```go
// æ›´æ–°ç©ºé—´
nsId := "2akrarsj8zp0w"
ops := []PatchOperation{
		{
			Op:    "replace",
			Key:   "name",
			Value: "testNamespace2",
		},
		{
			Op:    "replace",
			Key:   "zone",
			Value: "z1",
		},
}
ns3, err := manager.UpdateNamespace(nsId, ops)
```
<br />

## **æŸ¥è¯¢ç©ºé—´ä¿¡æ¯**

```go
func (manager *Manager) QueryNamespace(nsId string) (*NameSpace, error) 
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜   |
| ---- | ------ |
| nsId | ç©ºé—´id |

### ç¤ºä¾‹

```go
// æŸ¥è¯¢ç©ºé—´ä¿¡æ¯
nsId := "2akrarsj8zp0w"
manager.DeleteNamespace(nsId)
```
<br />

## **è·å–ç©ºé—´åˆ—è¡¨**

```go
func (manager *Manager) ListNamespace(offset, line int, sortBy string) ([]NameSpace, int64, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°   | è¯´æ˜                                                         |
| ------ | ------------------------------------------------------------ |
| offset | åœ¨å…¨éƒ¨namespaceä¸­çš„åç§»é‡                                    |
| line   | ä¸€æ¬¡è¿”å›å¤šå°‘æ¡                                               |
| sortBy | asc è¡¨ç¤ºå‡åº, desc è¡¨ç¤ºé™åº, é»˜è®¤æŒ‰åˆ›å»ºæ—¶é—´é™åºæ’åˆ—(å¯å‚ä¸æ’åºçš„å­—æ®µæœ‰createdAt, updatedAt).asc:updatedAtè¡¨ç¤ºæ›´æ–°æ—¶é—´ä»å°åˆ°å¤§æ’åº, desc:updatedAtè¡¨ç¤ºæ›´æ–°æ—¶é—´ä»å¤§åˆ°å°æ’åº |

### ç¤ºä¾‹

```go
// è·å–ç©ºé—´åˆ—è¡¨
offset := 0
line := 100
sortBy := "asc"

nss, total, err := manager.ListNamespace(offset, line, sortBy)
```
<br />

## **ç¦ç”¨ç©ºé—´**

```go
func (manager *Manager) DisableNamespace(nsId string) error
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜   |
| ---- | ------ |
| nsId | ç©ºé—´id |

### ç¤ºä¾‹

```go
// ç¦ç”¨ç©ºé—´
nsId := "2akrarsj8zp0w"
err := manager.DisableNamespace(nsId)
```
<br />

## **å¯ç”¨ç©ºé—´**

```go
func (manager *Manager) EnableNamespace(nsId string) error
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜   |
| ---- | ------ |
| nsId | ç©ºé—´id |

### ç¤ºä¾‹

```go
// å¯ç”¨ç©ºé—´
nsId := "2akrarsj8zp0w"
err := manager.EnableNamespace(nsId)
```

# **æµç®¡ç†**

## **åˆ›å»ºæµ**
æœ¬æ¥å£ä»…ç”¨äºæ¥å…¥ç±»å‹ä¸ºRTMPçš„ç©ºé—´

```go
func (manager *Manager) AddStream(nsId string, stream *Stream) (*Stream, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°   | è¯´æ˜                                                        |
| ------ | ----------------------------------------------------------- |
| nsId   | ç©ºé—´id                                                      |
| Stream | æµç›¸å…³å‚æ•°ç»“æ„ä½“ï¼Œè¯¦è§[Streamç»“æ„ä½“è¯´æ˜](#Streamç»“æ„ä½“è¯´æ˜) |

### Streamç»“æ„ä½“è¯´æ˜

| StreamID           | ç±»å‹   | è¯´æ˜                                                         |
| ------------------ | ------ | ------------------------------------------------------------ |
| StreamID           | string | æµåç§°, æµåç§°åœ¨ç©ºé—´ä¸­å”¯ä¸€ï¼Œå¯åŒ…å« å­—æ¯ã€æ•°å­—ã€ä¸­åˆ’çº¿ã€ä¸‹åˆ’çº¿ï¼›1 ~ 100 ä¸ªå­—ç¬¦é•¿ï¼›åˆ›å»ºåå°†ä¸å¯ä¿®æ”¹ |
| Desc               | string | å…³äºæµçš„æè¿°ä¿¡æ¯                                             |
| NamespaceId        | string | æ‰€å±çš„ç©ºé—´ID                                                 |
| Namespace          | string | æ‰€å±çš„ç©ºé—´åç§°                                               |
| RecordTemplateId   | string | å½•åˆ¶æ¨¡ç‰ˆIDï¼Œé…ç½®æµç»´åº¦çš„å½•åˆ¶æ¨¡æ¿                             |
| SnapShotTemplateId | string | æˆªå›¾æ¨¡ç‰ˆIDï¼Œé…ç½®æµç»´åº¦çš„æˆªå›¾æ¨¡æ¿                             |
| Status             | bool   | è®¾å¤‡æ˜¯å¦åœ¨çº¿                                                 |
| Disabled           | bool   | æµæ˜¯å¦è¢«ç¦ç”¨                                                 |
| LastPushedAt       | int64  | æœ€åä¸€æ¬¡æ¨æµæ—¶é—´ï¼Œ0:è¡¨ç¤ºæ²¡æœ‰æ¨æµ                              |
| CreatedAt          | int64  | æµåˆ›å»ºæ—¶é—´                                                   |
| UpdatedAt          | int64  | æµæ›´æ–°æ—¶é—´                                                   |
| UserCount          | int    | åœ¨çº¿è§‚çœ‹äººæ•°                                                 |
| ClientIp           | string | æ¨æµç«¯ip                                                     |
| AudioFrameRate     | int64  | ç›´æ’­æµçš„å®æ—¶éŸ³é¢‘å¸§ç‡                                         |
| BitRate            | int64  | ç›´æ’­æµçš„å®æ—¶ç ç‡                                             |
| VideoFrameRate     | int64  | ç›´æ’­æµçš„å®æ—¶è§†é¢‘å¸§ç‡                                         |

### ç¤ºä¾‹

```go
// åˆ›å»ºæµ
stream := &Stream{
		StreamID: "test003",
}
_, err = manager.AddStream(ns1.ID, stream)
```
<br />

## **åˆ é™¤æµ**

```go
func (manager *Manager) DeleteStream(nsId string, streamId string) error
```

### å‚æ•°è¯´æ˜

| å‚æ•°     | è¯´æ˜   |
| -------- | ------ |
| nsId     | ç©ºé—´id |
| streamId | æµid   |

### ç¤ºä¾‹

```go
// åˆ é™¤æµ
manager.DeleteStream(ns1.ID, "test001")
```
<br />

## **æŸ¥è¯¢æµä¿¡æ¯**

```go
func (manager *Manager) QueryStream(nsId string, streamId string) (*Stream, error) 
```

### å‚æ•°è¯´æ˜

| å‚æ•°     | è¯´æ˜   |
| -------- | ------ |
| nsId     | ç©ºé—´id |
| streamId | æµid   |

### ç¤ºä¾‹

```go
// æŸ¥è¯¢æµä¿¡æ¯
manager.QueryStream(ns1.ID, "test001")
```
<br />

## **æ›´æ–°æµ**

```go
func (manager *Manager) UpdateStream(nsId string, streamId string, ops []PatchOperation) (*Stream, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜                                                         |
| ---- | ------------------------------------------------------------ |
| nsId | ç©ºé—´id                                                       |
| ops  | æ“ä½œé›†ï¼Œè¯¦è§[PatchOperationç»“æ„ä½“è¯´æ˜](#PatchOperationç»“æ„ä½“è¯´æ˜) |

### ç¤ºä¾‹

```go
// æ›´æ–°æµ
stream := &Stream{
		StreamID: "test003",
}
ops := []PatchOperation{
		{
			Op:    "replace",
			Key:   "desc",
			Value: "test",
		},
}
stream1, err := manager.UpdateStream(ns1.ID, stream.StreamID, ops)
```
<br />

## **è·å–æµåˆ—è¡¨**

```go
func (manager *Manager) ListStream(nsId string, offset, line int, prefix, sortBy string, qType int) ([]Stream, int64, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°   | è¯´æ˜                                                         |
| ------ | ------------------------------------------------------------ |
| nsId   | ç©ºé—´id                                                       |
| offset | åœ¨å…¨éƒ¨æµä¸­çš„åç§»é‡                                           |
| line   | ä¸€æ¬¡è¿”å›å¤šå°‘æ¡                                               |
| prefix | æµID å‰ç¼€ï¼Œå¯ä»¥æµID å‰ç¼€è¿›è¡Œæ£€ç´¢æŸ¥è¯¢                         |
| sortBy | asc è¡¨ç¤ºå‡åºï¼Œdesc è¡¨ç¤ºé™åºã€‚é»˜è®¤æŒ‰åˆ›å»ºæ—¶é—´é™åºæ’åˆ—(å¯å‚ä¸æ’åºçš„å­—æ®µæœ‰createdAt, updatedAt, lastPushedAt). asc:updatedAtè¡¨ç¤ºæ›´æ–°æ—¶é—´ä»å°åˆ°å¤§æ’åº, desc:updatedAtè¡¨ç¤ºæ›´æ–°æ—¶é—´ä»å¤§åˆ°å°æ’åº |
| qType  | æŸ¥è¯¢æµç±»å‹ï¼Œ 0:å…¨éƒ¨ï¼Œ1:åœ¨çº¿æµï¼Œ2:ç¦»çº¿æµ                        |

### ç¤ºä¾‹

```go
// **è·å–æµåˆ—è¡¨**
streams, total, err := manager.ListStream(ns1.ID, 0, 2, "test", "desc:updatedAt", 0)
```
<br />

## **è·å–åŠ¨æ€æ¨æ‹‰æµåœ°å€**

```go
func (manager *Manager) DynamicPublishPlayURL(nsId string, streamId string, route *DynamicLiveRoute) (*RouteRet, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°     | è¯´æ˜                                                         |
| -------- | ------------------------------------------------------------ |
| nsId     | ç©ºé—´id                                                       |
| streamId | æµid                                                         |
| route    | åŠ¨æ€æ¨¡å¼çš„æ¨æ‹‰æµåŸŸåç›¸å…³å‚æ•°ï¼Œè¯¦è§[DynamicLiveRouteç»“æ„ä½“è¯´æ˜](#DynamicLiveRoute) |

### DynamicLiveRouteç»“æ„ä½“è¯´æ˜

| æˆå‘˜         | ç±»å‹   | è¯´æ˜                                                         |
| ------------ | ------ | ------------------------------------------------------------ |
| PublishIP    | string | æ¨æµç«¯å¯¹å¤–IPåœ°å€                                             |
| PlayIP       | string | æ‹‰æµç«¯å¯¹å¤–IPåœ°å€                                             |
| UrlExpireSec | int64  | åœ°å€è¿‡æœŸæ—¶é—´ï¼ŒurlExpireSec:100ä»£è¡¨100ç§’åè¿‡æœŸï¼›é»˜è®¤urlExpireSec:0,æ°¸ä¸è¿‡æœŸ|

### RouteRetç»“æ„ä½“è¯´æ˜

| æˆå‘˜              | ç±»å‹                                                         | è¯´æ˜                                        |
| ----------------- | ------------------------------------------------------------ | ------------------------------------------- |
| PublishUrl        | string                                                       | rtmpæ¨æµåœ°å€                                |
| PlayUrls          | RoutePlayUrls,è¯¦è§[RoutePlayUrlsç»“æ„ä½“è¯´æ˜](#RoutePlayUrlsç»“æ„ä½“è¯´æ˜) | æ‹‰æµURLs                                    |
| PublishUrlExpired | int64                                                        | æ¨æ‹‰æµåœ°å€è¿‡æœŸæ—¶é—´ç‚¹(unixæ—¶é—´æˆ³,å•ä½second) |

### RoutePlayUrlsç»“æ„ä½“è¯´æ˜

| æˆå‘˜ | ç±»å‹   | è¯´æ˜         |
| ---- | ------ | ------------ |
| Rtmp | string | rtmpæ’­æ”¾åœ°å€ |
| Flv  | string | flvæ’­æ”¾åœ°å€  |
| Hls  | string | hlsæ’­æ”¾åœ°å€  |

### ç¤ºä¾‹

```go
// è·å–åŠ¨æ€æ¨æ‹‰æµåœ°å€
ret, err := manager.DynamicPublishPlayURL("2akrarwwhi0ff", "test1", &qvs.DynamicLiveRoute{PublishIP: "127.0.0.1", PlayIP: "127.0.0.1", UrlExpireSec: 0})
```
<br />

## **è·å–é™æ€æ¨æ‹‰æµåœ°å€**

```go
func (manager *Manager) StaticPublishPlayURL(nsId, streamId string, route *StaticLiveRoute) (string, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°     | è¯´æ˜                                                         |
| -------- | ------------------------------------------------------------ |
| nsId     | ç©ºé—´id                                                       |
| streamId | æµid                                                         |
| route    | é™æ€æ¨¡å¼çš„æ¨æ‹‰æµåŸŸåç›¸å…³å‚æ•°ï¼Œè¯¦è§[StaticLiveRouteç»“æ„ä½“è¯´æ˜](#StaticLiveRouteç»“æ„ä½“è¯´æ˜) |

### StaticLiveRouteç»“æ„ä½“è¯´æ˜

| æˆå‘˜         | ç±»å‹   | è¯´æ˜                                                         |
| ------------ | ------ | ------------------------------------------------------------ |
| Domain       | string | åŸŸå                                                         |
| DomainType   | string | åŸŸåç±»å‹                                                     |
| UrlExpireSec | int64  | åœ°å€è¿‡æœŸæ—¶é—´ï¼ŒurlExpireSec:100ä»£è¡¨100ç§’åè¿‡æœŸï¼›é»˜è®¤urlExpireSec:0,æ°¸ä¸è¿‡æœŸ |

## ç¤ºä¾‹

```go
// è·å–é™æ€æ¨æ‹‰æµåœ°å€
ret, err := manager.StaticPublishPlayURL(ns1.ID, "1", &StaticLiveRoute{Domain: "qvs-publish.qiniu1.com", DomainType: DomainPublishRTMP})
```
<br />

## **ç¦ç”¨æµ**

```go
func (manager *Manager) DisableStream(nsId string, streamId string) error
```

### å‚æ•°è¯´æ˜

| å‚æ•°     | è¯´æ˜   |
| -------- | ------ |
| nsId     | ç©ºé—´id |
| streamId | æµid   |

### ç¤ºä¾‹

```go
// ç¦ç”¨æµ
manager.DeleteStream(ns1.ID, "test001")
```
<br />

## **å¯ç”¨æµ**

```go
func (manager *Manager) EnableStream(nsId string, streamId string) error
```

### å‚æ•°è¯´æ˜

| å‚æ•°     | è¯´æ˜   |
| -------- | ------ |
| nsId     | ç©ºé—´id |
| streamId | æµid   |

### ç¤ºä¾‹

```go
// å¯ç”¨æµ
manager.DeleteStream(ns1.ID, "test001")
```
<br />

## **åœç”¨æµ**
```go
func (manager  *Manager) StopStream(nsId  string, streamId  string) error
```
### å‚æ•°è¯´æ˜
| å‚æ•°     | è¯´æ˜   |
| -------- | ------ |
| nsId     | ç©ºé—´id |
| streamId | æµid   |

### ç¤ºä¾‹
```go
// åœç”¨æµ
manager.StopStream(ns1.ID, "test001"ï¼‰
```
<br />

## **æŸ¥è¯¢æ¨æµè®°å½•**

```go
func (manager *Manager) QueryStreamPubhistories(nsId string, streamId string, start, end int, line, offset int) ([]StreamPublishHistory, int64, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°     | è¯´æ˜                                   |
| -------- | -------------------------------------- |
| nsId     | ç©ºé—´id                                 |
| streamId | æµid                                   |
| start    | æ¨æµå¼€å§‹æ—¶é—´(unix timestamp in second) |
| end      | æ¨æµç»“æŸæ—¶é—´(unix timestamp in second) |
| line     | ä¸€æ¬¡è¿”å›å¤šå°‘æ¡                         |
| offset   | åœ¨å…¨éƒ¨æµä¸­çš„åç§»é‡                     |

### ç¤ºä¾‹

```go
// æŸ¥è¯¢æ¨æµè®°å½•
start := 1587975463
end := 1587976463
offset := 0
line := 1
manager.DeleteStream(ns1.ID, "test001", start, end, line, offset)
```

# **è®¾å¤‡ç®¡ç†**

## **åˆ›å»ºè®¾å¤‡**
```go
func (manager *Manager) AddDevice(device *Device) (*Device, error)
```
### å‚æ•°è¯´æ˜
| å‚æ•° | è¯´æ˜                                                        |
| ---- | ----------------------------------------------------------- |
| Device | è®¾å¤‡ç›¸å…³å‚æ•°ï¼Œè¯¦è§[Deviceç»“æ„ä½“è¯´æ˜](#Deviceç»“æ„ä½“è¯´æ˜) |

### Deviceç»“æ„ä½“è¯´æ˜
| æˆå‘˜ | ç±»å‹   | è¯´æ˜ |
| --- | ------ | ---- |
| NamespaceId      | string | æ‰€å±çš„ç©ºé—´ID |
| Name      | string | è®¾å¤‡åç§° |
| GBId      | string | è®¾å¤‡å›½æ ‡ID |
| Type      | int | è®¾å¤‡ç±»å‹ï¼Œå–å€¼1ï¼ˆæ‘„åƒå¤´ï¼‰, 2ï¼ˆå¹³å°ï¼‰|
| Username  | string    | ç”¨æˆ·å |
| Password   | string    | å¯†ç  |
| PullIfRegister | bool    | æ³¨å†ŒæˆåŠŸåå¯åŠ¨æ‹‰æµ, é»˜è®¤å…³é—­ |
| Desc   | string    | è®¾å¤‡æè¿° |
| NamespaceName    | string    | æ‰€å±çš„ç©ºé—´åç§° |
| State | string | çŠ¶æ€ï¼ˆoffline: ç¦»çº¿, online: åœ¨çº¿, notReg: æœªæ³¨å†Œ, locked: é”å®šï¼‰ |
| Channels  | int | è®¾å¤‡é€šé“æ•° |
| Vendor  | string    | å‚å•† |
| CreatedAt   | int64 | åˆ›å»ºæ—¶é—´ï¼ŒUnixæ—¶é—´æˆ³ï¼Œç§’ |
| UpdatedAt| int64   | æ›´æ–°æ—¶é—´ï¼ŒUnixæ—¶é—´æˆ³ï¼Œç§’ |
| LastRegisterAt | int64   | ä¸Šä¸€æ¬¡æ³¨å†Œæ—¶é—´ï¼ŒUnixæ—¶é—´æˆ³ï¼Œç§’ |
| LastKeepaliveAt | int64   | ä¸Šä¸€æ¬¡å¿ƒè·³æ—¶é—´ï¼ŒUnixæ—¶é—´æˆ³ï¼Œç§’ |
### ç¤ºä¾‹
```go
// åˆ›å»ºè®¾å¤‡
device := &Device {
	Name:               "device1",
	Desc:               "test gb28181",
	Username:           "username",
	Password:           "password"
}
dev, err := manager.AddDevice(device)
```

## **åˆ é™¤è®¾å¤‡**
```go
DeleteDevice(nsId string, gbId string) error
```
### å‚æ•°è¯´æ˜
| å‚æ•° | è¯´æ˜                                                        |
| ---- | ----------------------------------------------------------- |
| nsId | ç©ºé—´id |
| gbId | å›½æ ‡id |

### ç¤ºä¾‹
```go
// åˆ é™¤è®¾å¤‡
dev, err := manager.DeleteDevice(ns1.ID, "device1")
```

## **æ›´æ–°è®¾å¤‡**
```go
func (manager *Manager) UpdateDevice(nsId string, gbId string, ops []PatchOperation) (*Device, error) 
```
### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜                                                         |
| ---- | ------------------------------------------------------------ |
| nsId | ç©ºé—´id                                                       |
| gbId | å›½æ ‡Id |
| ops  | æ“ä½œé›†ï¼Œè¯¦è§[PatchOperationç»“æ„ä½“è¯´æ˜](#PatchOperationç»“æ„ä½“è¯´æ˜) |

### ç¤ºä¾‹
```go
// æ›´æ–°è®¾å¤‡
ops := []PatchOperation{
	{
		Op:    "replace",
		Key:   "desc",
		Value: "test",
	},
}
dev, err := manager.UpdateDevice(ns1.ID, dev.gbId, ops)
```

## **æŸ¥è¯¢è®¾å¤‡ä¿¡æ¯**
```go
func (manager *Manager) QueryDevice(nsId string, gbId string) (*Device, error)
```
### å‚æ•°è¯´æ˜
| å‚æ•° | è¯´æ˜                                                        |
| ---- | ----------------------------------------------------------- |
| nsId | ç©ºé—´id |
| gbId | å›½æ ‡id |

### ç¤ºä¾‹
```go
// åˆ é™¤è®¾å¤‡
nsId := "testNsId"
gbId := "testGbId"
dev, err := manager.QueryDevice(nsId, gbId)
```

## **æŸ¥è¯¢è®¾å¤‡åˆ—è¡¨**
```go
func (manager *Manager) ListDevice(nsId string, offset, line int, prefix, state string, qType int) ([]Device, int64, error)
```
### å‚æ•°è¯´æ˜
| å‚æ•° | è¯´æ˜                                                        |
| ---- | ----------------------------------------------------------- |
| nsId | ç©ºé—´id |
| offset | åœ¨å…¨éƒ¨Deviceä¸­çš„åç§»é‡ |
| line | ä¸€æ¬¡è¿”å›å¤šå°‘æ¡ |
| prefix| å¯ä»¥é€šè¿‡gbidå‰ç¼€è¿›è¡Œæ£€ç´¢æŸ¥è¯¢ |
| state | æŒ‰è®¾å¤‡çŠ¶æ€æŸ¥è¯¢ï¼Œoffline: ç¦»çº¿ï¼Œonline: åœ¨çº¿ï¼ŒnotReg: æœªæ³¨å†Œï¼Œlocked: é”å®š |
| qtype | æŒ‰è®¾å¤‡ç±»å‹æŸ¥è¯¢ï¼Œ0:å…¨éƒ¨ï¼Œ1:æ‘„åƒå¤´ï¼Œ2:å¹³å° |

### ç¤ºä¾‹
```go
// æŸ¥è¯¢è®¾å¤‡åˆ—è¡¨
nsId := "testNsId"
gbId := "testGbId"
dev, err := manager.ListDevice(ns1.ID, 0, 2, "302", "", 0)
```

## **æŸ¥è¯¢é€šé“åˆ—è¡¨**
```go
func (manager *Manager) ListChannels(nsId string, gbId string, prefix string) (*DeviceChannels, error)
```

### å‚æ•°è¯´æ˜
| å‚æ•° | è¯´æ˜                                                        |
| ---- | ----------------------------------------------------------- |
| nsId | ç©ºé—´id |
| gbId | å›½æ ‡id |
| prefix | é€šé“å›½æ ‡IDå‰ç¼€ |

### ç¤ºä¾‹
```go
// åˆ é™¤è®¾å¤‡
nsId := "testNsId"
gbId := "testGbId"
prefix := "320"
dev, err := manager.ListChannels(nsId, gbId, prefix)
```

## **å¯åŠ¨è®¾å¤‡æ‹‰æµ**
```go
func (manager *Manager) StartDevice(nsId string, gbId string, channels []string) error
```

### å‚æ•°è¯´æ˜
| å‚æ•° | è¯´æ˜                                                        |
| ---- | ----------------------------------------------------------- |
| nsId | ç©ºé—´id |
| gbId | å›½æ ‡id |
| channels | å¹³å°è®¾å¤‡æŒ‡å®šéœ€è¦å¯åŠ¨çš„é€šé“å›½æ ‡ID(ä¸ºç©ºè¡¨ç¤ºå¯åŠ¨å¹³å°ä¸‹çš„æ‰€æœ‰è®¾å¤‡) |

### ç¤ºä¾‹
```go
// å¯åŠ¨è®¾å¤‡æ‹‰æµ
nsId := "testNsId"
gbId := "testGbId"
channels := []string{"31011500991320000028"}
dev, err := manager.StartDevice(nsId, gbId, channels)
```

## **åœæ­¢è®¾å¤‡æ‹‰æµ**
```go
func (manager *Manager) StopDevice(nsId string, gbId string, channels []string) error
```

### å‚æ•°è¯´æ˜
| å‚æ•° | è¯´æ˜                                                        |
| ---- | ----------------------------------------------------------- |
| nsId | ç©ºé—´id |
| gbId | å›½æ ‡id |
| channels | å¹³å°è®¾å¤‡æŒ‡å®šéœ€è¦ç»“æŸçš„é€šé“å›½æ ‡ID(ä¸ºç©ºè¡¨ç¤ºåœæ­¢å¹³å°ä¸‹çš„æ‰€æœ‰è®¾å¤‡) |

### ç¤ºä¾‹
```go
// åœæ­¢è®¾å¤‡æ‹‰æµ
nsId := "testNsId"
gbId := "testGbId"
channels := []string{"31011500991320000028"}
dev, err := manager.StartDevice(nsId, gbId, channels)
```
<br />

## **åŒæ­¥è®¾å¤‡é€šé“**
```go
func (manager *Manager) FetchCatalog(nsId, gbId string) error 
```

### å‚æ•°è¯´æ˜
| å‚æ•° | è¯´æ˜                                                        |
| ---- | ----------------------------------------------------------- |
| nsId | ç©ºé—´id |
| gbId | å›½æ ‡id |

### ç¤ºä¾‹
```go
err = c.FetchCatalog("3nm4x0vyz7xlu", "31011500991180000270")
```
<br />

## **æŸ¥è¯¢é€šé“è¯¦æƒ…**
```go
func (manager *Manager) QueryChannel(nsId, gbId, channelId string) (*Channel, error)
```

### å‚æ•°è¯´æ˜
| å‚æ•° | è¯´æ˜                                                        |
| ---- | ----------------------------------------------------------- |
| nsId | ç©ºé—´id |
| gbId | å›½æ ‡id |
| channelId | é€šé“id |

### ç¤ºä¾‹
```go
channel, err := c.QueryChannel("3nm4x0vyz7xlu", "31011500991180000270", "31011500991180000135")
```
<br />

## **åˆ é™¤é€šé“**
```go
func (manager *Manager) DeleteChannel(nsId, gbId, channelId string) error
```

### å‚æ•°è¯´æ˜
| å‚æ•° | è¯´æ˜                                                        |
| ---- | ----------------------------------------------------------- |
| nsId | ç©ºé—´id |
| gbId | å›½æ ‡id |
| channelId | é€šé“id |

### ç¤ºä¾‹
```go
err = c.DeleteChannel("3nm4x0vyz7xlu", "31011500991180000270", "31011500991180000135")
```
<br />

## **æŸ¥è¯¢æœ¬åœ°å½•åƒåˆ—è¡¨**
```go
func (manager *Manager) QueryGBRecordHistories(nsId, gbId, chId string, start, end int) (*DeviceVideoItems, error)
```

### å‚æ•°è¯´æ˜
| å‚æ•°        | è¯´æ˜     |
| ----------- | -------- |
| nsId | ç©ºé—´id   |
| gbId        | å›½æ ‡id   |
| channelId   | ç½‘å…³è®¾å¤‡æ—¶ä¸ºé€šé“ID(æ™®é€šè®¾å¤‡å¯ä»¥å¿½ç•¥) |
| start       | æŸ¥è¯¢å¼€å§‹æ—¶é—´(unixæ—¶é—´æˆ³,å•ä½ä¸ºç§’) |
| end         | æŸ¥è¯¢ç»“æŸæ—¶é—´(unixæ—¶é—´æˆ³,å•ä½ä¸ºç§’) |

### ç¤ºä¾‹
```go
ret, err := c.QueryGBRecordHistories("3nm4x0vyz7xlu", "31011500991180000270", "34020000001310000020", 1604817540, 1604903940)
```

# **æ¨¡æ¿ç®¡ç†**

## **åˆ›å»ºæ¨¡æ¿**

```go
func (manager *Manager) AddTemplate(tmpl *Template) (*Template, error) 
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜                                                        |
| ---- | ----------------------------------------------------------- |
| Tmpl | æ¨¡æ¿ç›¸å…³å‚æ•°ï¼Œè¯¦è§[Templateç»“æ„ä½“è¯´æ˜](#Templateç»“æ„ä½“è¯´æ˜) |

### Templateç»“æ„ä½“è¯´æ˜

| æˆå‘˜                         | ç±»å‹   | è¯´æ˜                                                         |
| ---------------------------- | ------ | ------------------------------------------------------------ |
| ID                           | string | æ¨¡æ¿id                                                       |
| Name                         | string | æ¨¡ç‰ˆåç§°ï¼Œæ ¼å¼ä¸º 4 ~ 100ä¸ªå­—ç¬¦ï¼Œå¯åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€ä¸­åˆ’çº¿ã€æ±‰å­— |
| Desc                         | string | æ¨¡ç‰ˆæè¿°                                                     |
| Bucket                       | string | æ¨¡ç‰ˆå¯¹åº”çš„å¯¹è±¡å­˜å‚¨çš„bucket                                   |
| DeleteAfterDays              | int    | å‚¨è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ°¸ä¹…ä¸è¿‡æœŸ                                    |
| TemplateType                 | int    | æ¿ç±»å‹ï¼Œå–å€¼ï¼š0ï¼ˆå½•åˆ¶æ¨¡ç‰ˆï¼‰ï¼Œ1ï¼ˆæˆªå›¾æ¨¡ç‰ˆï¼‰                    |
| FileType                     | int    | ä»¶å­˜å‚¨ç±»å‹ï¼Œå–å€¼ï¼š0ï¼ˆæ™®é€šå­˜å‚¨ï¼‰ï¼Œ1ï¼ˆä½é¢‘å­˜å‚¨ï¼‰                 |
| RecordType                   | int    | å½•åˆ¶æ¨¡å¼ï¼Œ0ï¼ˆä¸å½•åˆ¶ï¼‰ï¼Œ1ï¼ˆå®æ—¶å½•åˆ¶ï¼‰ï¼Œ2ï¼ˆæŒ‰éœ€å½•åˆ¶ï¼‰           |
| RecordFileFormat             | int    | å½•åˆ¶æ–‡ä»¶å­˜å‚¨æ ¼å¼(å¤šé€‰)ï¼ŒèŒƒå›´ï¼š1(001)ï½7(111)ï¼Œä»å·¦å¾€å³çš„ä¸‰ä½äºŒè¿›åˆ¶æ•°åˆ†åˆ«ä»£è¡¨MP4ã€FLVã€M3U8ï¼›0ä»£è¡¨ä¸é€‰æ‹©è¯¥æ ¼å¼ï¼Œ1ä»£è¡¨é€‰æ‹©ï¼›ä¾‹å¦‚ï¼š2(010)ä»£è¡¨é€‰æ‹©FLVæ ¼å¼ï¼Œ6(110)ä»£è¡¨é€‰æ‹©MP4å’ŒFLVæ ¼å¼ï¼Œ1(001)ä»£è¡¨é€‰æ‹©M3U8æ ¼å¼ï¼Œ7(111)ä»£è¡¨ä¸‰ç§æ ¼å¼å‡é€‰æ‹©                         |
| TSFileNameTemplate           | string | tsæ–‡ä»¶åæ¨¡æ¿ï¼Œä¾‹å¦‚ï¼šrecord/ts/${namespaceId}/${streamId}/${startMs}-${endMs}.ts |
| RecordSnapFileNameFmt        | string | æˆªå›¾æ–‡ä»¶åæ ¼å¼ï¼Œä¾‹å¦‚ï¼š/record/snap/${namespaceId}/${streamId}/${startMs}.jpg |
| RecordInterval               | int    | å½•åˆ¶æ–‡ä»¶é•¿åº¦                                                 |
| M3u8FileNameTemplate         | string | m3u8æ–‡ä»¶å‘½åæ ¼å¼                                             |
| FLVFileNameTemplate          | string | flvæ–‡ä»¶å‘½åæ ¼å¼                                             |
| MP4FileNameTemplate          | string | mp4æ–‡ä»¶å‘½åæ ¼å¼                                             |
| JpgOverwriteStatus           | bool   | å¼€å¯è¦†ç›–å¼æˆªå›¾(ä¸€èˆ¬ç”¨äºæµå°é¢)                               |
| JpgSequenceStatus            | bool   | å¼€å¯åºåˆ—å¼æˆªå›¾                                               |
| JpgOnDemandStatus            | bool   | å¼€å¯æŒ‰éœ€æˆªå›¾                                                 |
| JpgOverwriteFileNameTemplate | string | è¦†ç›–å¼æˆªå›¾æ–‡ä»¶å‘½åæ ¼å¼:snapshot/jpg/${namespaceId}/${streamId}/${streamId}.jpg |
| JpgSequenceFileNameTemplate  | string | åºåˆ—å¼æˆªå›¾æ–‡ä»¶å‘½åæ ¼å¼:snapshot/jpg/${namespaceId}/${streamId}/${startMs}.jpg |
| JpgOnDemandFileNameTemplate  | string | æŒ‰éœ€å¼æˆªå›¾æ–‡ä»¶å‘½åæ ¼å¼:snapshot/jpg/${namespaceId}/${streamId}/ondemand-${startMs}.jpg |
| SnapInterval                 | int    | åºåˆ—å¼æˆªå›¾æ—¶é—´é—´éš”                                           |
| CreatedAt                    | int64  | æ¨¡æ¿åˆ›å»ºæ—¶é—´                                                 |
| UpdatedAt                    | int64  | æ¨¡æ¿æ›´æ–°æ—¶é—´                                                 |
| Zone                         | string | oneä¸ºæœåŠ¡åŒºåŸŸé…ç½®é¡¹ï¼Œå¯é€‰é¡¹ä¸ºz0ã€z1ã€z2ï¼Œé»˜è®¤ä¸ºz0ã€‚z0è¡¨ç¤ºåä¸œã€z1è¡¨ç¤ºååŒ—ã€z2è¡¨ç¤ºåå— |

### ç¤ºä¾‹

```go
// åˆ›å»ºæ¨¡æ¿
tmpl := &Template{
		Name:               "test001",
		Bucket:             "xxxx",
		TemplateType:       1,
		JpgOverwriteStatus: true,
		RecordType:         2,
		Zone:               "z0",
		RecordFileFormat:   1,
}
tmpl1, err := c.AddTemplate(tmpl)
```
<br />

## **åˆ é™¤æ¨¡æ¿**

```go
func (manager *Manager) DeleteTemplate(templId string) error
```

### å‚æ•°è¯´æ˜

| å‚æ•°    | è¯´æ˜   |
| ------- | ------ |
| templId | æ¨¡æ¿id |

### ç¤ºä¾‹

```go
// åˆ é™¤æ¨¡æ¿
manager.DeleteTemplate(tmpl1.ID)
```
<br />

## **æ›´æ–°æ¨¡æ¿**

```go
func (manager *Manager) UpdateTemplate(templId string, ops []PatchOperation) (*Template, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°    | è¯´æ˜                                                         |
| ------- | ------------------------------------------------------------ |
| templId | æ¨¡æ¿id                                                       |
| ops     | æ“ä½œé›†ï¼Œè¯¦è§[#PatchOperationç»“æ„ä½“è¯´æ˜](#PatchOperationç»“æ„ä½“è¯´æ˜) |

### ç¤ºä¾‹

```go
// æ›´æ–°æ¨¡æ¿
ps := []PatchOperation{
		{
			Op:    "replace",
			Key:   "name",
			Value: "test002",
		},
		{
			Op:    "replace",
			Key:   "zone",
			Value: "z1",
		},
}
tmpl2, err := manager.UpdateTemplate(tmpl1.ID, ops)
```
<br />

## **æŸ¥è¯¢æ¨¡æ¿ä¿¡æ¯**

```go
func (manager *Manager) QueryTemplate(templId string) (*Template, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°    | è¯´æ˜   |
| ------- | ------ |
| templId | æ¨¡æ¿id |

### ç¤ºä¾‹

```go
// æŸ¥è¯¢æ¨¡æ¿ä¿¡æ¯
tmpl2, err := manager.QueryTemplate("2akrarsl22iil")
```
<br />

## **è·å–æ¨¡æ¿åˆ—è¡¨**

```go
func (manager *Manager) ListTemplate(offset, line int, sortBy string, templateType int, match string) ([]Template, int64, error) 
```

### å‚æ•°è¯´æ˜

| å‚æ•°         | è¯´æ˜                                                         |
| ------------ | ------------------------------------------------------------ |
| offset       | åœ¨å…¨éƒ¨templatesä¸­çš„åç§»é‡                                    |
| line         | ä¸€æ¬¡è¿”å›å¤šå°‘æ¡                                               |
| sortBy       | é»˜è®¤æŒ‰åˆ›å»ºæ—¶é—´é™åºæ’åˆ—ï¼ŒsortByç”±"asc/desc"å’Œå¯å‚ä¸æ’åºçš„å­—æ®µç»„æˆï¼Œå…¶ä¸­ asc è¡¨ç¤ºå‡åºï¼Œdesc è¡¨ç¤ºé™åºï¼Œå¯å‚ä¸æ’åºçš„å­—æ®µæœ‰createdAtï¼ŒupdatedAtã€‚asc:updatedAtè¡¨ç¤ºæ›´æ–°æ—¶é—´ä»å°åˆ°å¤§æ’åºï¼Œdesc:updatedAtè¡¨ç¤ºæ›´æ–°æ—¶é—´ä»å¤§åˆ°å°æ’åº |
| templateType | æ¨¡æ¿ç±»å‹ï¼Œå–å€¼ï¼š0ï¼ˆå½•åˆ¶æ¨¡ç‰ˆï¼‰ï¼Œ1ï¼ˆæˆªå›¾æ¨¡ç‰ˆï¼‰                 |
| match        | æ¨¡ç³ŠåŒ¹é…æŸ¥è¯¢(æ¨¡ç‰ˆåç§°åŒ…å«matchä¸²æ—¶è¿”å›)                      |

### ç¤ºä¾‹

```go
// è·å–æ¨¡æ¿åˆ—è¡¨
nss, total, err := c.ListTemplate(0, 2, "asc:updatedA", 1, "")
```

# **å½•åˆ¶ç®¡ç†**

## **æŸ¥è¯¢å½•åˆ¶è®°å½•**

```go
func (manager *Manager) QueryStreamRecordHistories(nsId string, streamId string, start, end int, marker string, line int, format string) ([]RecordHistory, string, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°     | è¯´æ˜                              |
| -------- | --------------------------------- |
| nsId     | ç©ºé—´id                            |
| streamId | æµid                              |
| start    | æŸ¥è¯¢å¼€å§‹æ—¶é—´(unixæ—¶é—´æˆ³ï¼Œå•ä½ä¸ºç§’) |
| end      | æŸ¥è¯¢ç»“æŸæ—¶é—´(unixæ—¶é—´æˆ³ï¼Œå•ä½ä¸ºç§’) |
| marker   | ä¸Šæ¬¡è¿”å›çš„markerå€¼                |
| line     | ä¸€æ¬¡è¿”å›å¤šå°‘æ¡                    |
| format   | æŸ¥è¯¢å½•åˆ¶æ ¼å¼ï¼Œ""ä¸ºæŸ¥è¯¢æ‰€æœ‰æ ¼å¼è§†é¢‘   |

### ç¤ºä¾‹

```go
// æŸ¥è¯¢å½•åˆ¶è®°å½•
nsId := "2akrarsj8zp0w"
streamId := "test01"
start := 1587975463
end := 1587976463
marker := ""
line := 10
format := ""
recordHistory, err := manager.QueryStreamRecordHistories(nsId, streamId, start, end, marker, line, format)
```
<br />

## **è·å–æˆªå›¾åˆ—è¡¨**

```go
func (manager *Manager) StreamsSnapshots(nsId string, streamId string, start, end int, qtype int, line int, marker string) ([]byte, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°     | è¯´æ˜                                                        |
| -------- | ----------------------------------------------------------- |
| nsId     | ç©ºé—´id                                                      |
| streamId | æµid                                                        |
| start    | æŸ¥è¯¢å¼€å§‹æ—¶é—´(unixæ—¶é—´æˆ³,å•ä½ä¸ºç§’)                           |
| end      | æŸ¥è¯¢ç»“æŸæ—¶é—´(unixæ—¶é—´æˆ³,å•ä½ä¸ºç§’)                           |
| qtype    | 1:å®æ—¶æˆªå›¾å¯¹åº”çš„å›¾ç‰‡åˆ—è¡¨                                    |
| line    | é™å®šè¿”å›æˆªå›¾çš„ä¸ªæ•°ï¼Œåªèƒ½è¾“å…¥1-100çš„æ•´æ•°ï¼Œä¸æŒ‡å®šé»˜è®¤è¿”å›30ä¸ª |

### ç¤ºä¾‹

```go
// æŸ¥è¯¢å½•åˆ¶è®°å½•
nsId := "2akrarsj8zp0w"
streamId := "test01"
start := 1587975463
end := 1587976463
marker := ""
line := 10
qtype := 1
recordHistory, err := manager.StreamsSnapshots(nsId, streamId, start, end, qtype, line)
```
<br />

## **è·å–ç›´æ’­å°é¢æˆªå›¾**

```go
func (manager *Manager) QueryStreamCover(nsId string, streamId string) (string, error)
```

### å‚æ•°è¯´æ˜
| å‚æ•°     | è¯´æ˜                                                        |
| -------- | ----------------------------------------------------------- |
| nsId     | ç©ºé—´id                                                      |
| streamId | æµid                                                        |

### ç¤ºä¾‹
```go
// è·å–ç›´æ’­å°é¢æˆªå›¾
nsId := "2akrarsj8zp0w"
streamId := "test01"
cover, err := manager.QueryStreamCover(nsId, streamId)
```
<br />

## **æŒ‰éœ€æˆªå›¾**

```go
func (manager *Manager) OndemandSnap(nsId, streamId string) error
```

### å‚æ•°è¯´æ˜
| å‚æ•°     | è¯´æ˜                                                        |
| -------- | ----------------------------------------------------------- |
| nsId     | ç©ºé—´id                                                      |
| streamId | æµid                                                        |

### ç¤ºä¾‹
```go
err := c.OndemandSnap("2xenzw5o81ods", "31011500991320000356")
```
<br />

## **åˆ é™¤æˆªå›¾**

```go
func (manager *Manager) DeleteSnapshots(nsId, streamId string, files []string) error
```

### å‚æ•°è¯´æ˜
| å‚æ•°     | è¯´æ˜                                                        |
| -------- | ----------------------------------------------------------- |
| nsId     | ç©ºé—´id                                                      |
| streamId | æµid                                                        |
| files    | éœ€è¦åˆ é™¤çš„æ–‡ä»¶åˆ—è¡¨                                             |

### ç¤ºä¾‹
```go
err = c.DeleteSnapshots("2xenzw5o81ods", "31011500991320000356", []string{"test.jpg"})
```
<br />

## **å¯åŠ¨æŒ‰éœ€å½•åˆ¶**

```go
func (manager *Manager) StartRecord(nsId, streamId string) error
```

### å‚æ•°è¯´æ˜
| å‚æ•°     | è¯´æ˜                                                        |
| -------- | ----------------------------------------------------------- |
| nsId     | ç©ºé—´id                                                      |
| streamId | æµid                                                        |

### ç¤ºä¾‹
```go
err = c.StartRecord("2xenzw5o81ods", "31011500991320000356")
```
<br />

## **åœæ­¢æŒ‰éœ€å½•åˆ¶**

```go
func (manager *Manager) StopRecord(nsId, streamId string) error
```

### å‚æ•°è¯´æ˜
| å‚æ•°     | è¯´æ˜                                                        |
| -------- | ----------------------------------------------------------- |
| nsId     | ç©ºé—´id                                                      |
| streamId | æµid                                                        |

### ç¤ºä¾‹
```go
err = c.StopRecord("2xenzw5o81ods", "31011500991320000356")
```
<br />

## **åˆ é™¤å½•åˆ¶ç‰‡æ®µ**

```go
func (manager *Manager) DeleteStreamRecordHistories(nsId, streamId string, files []string) error
```

### å‚æ•°è¯´æ˜
| å‚æ•°     | è¯´æ˜                                                        |
| -------- | ----------------------------------------------------------- |
| nsId     | ç©ºé—´id                                                      |
| streamId | æµid                                                        |
| files    | éœ€è¦åˆ é™¤çš„æ–‡ä»¶åˆ—è¡¨(ä»æŸ¥è¯¢å½•åˆ¶è®°å½•file å­—æ®µè·å–æ–‡ä»¶å)              |

### ç¤ºä¾‹
```go
err = c.DeleteStreamRecordHistories("2xenzw5o81ods", "31011500991320000356", []string{"record/2xenzw5o81ods/31011500991320000356/1604989846152-1604990735281-852640.m3u8"})
```
<br />

## **å½•åˆ¶è§†é¢‘ç‰‡æ®µåˆå¹¶**

```go
func (manager *Manager) RecordClipsSaveas(nsId, streamId string, arg *saveasArgs) (*saveasReply, error)
```

### å‚æ•°è¯´æ˜
| å‚æ•°     | è¯´æ˜                                                        |
| -------- | ----------------------------------------------------------- |
| nsId     | ç©ºé—´id                                                      |
| streamId | æµid                                                        |
| arg      | è¯¦è§saveasArgsç»“æ„ä½“è¯´æ˜                                      |

### saveasArgsç»“æ„ä½“è¯´æ˜

| æˆå‘˜                         | ç±»å‹   | è¯´æ˜                                                         |
| ---------------------------- | ------ | ------------------------------------------------------------ |
| fname       | string | ä¿å­˜çš„æ–‡ä»¶å(éœ€è¦å¸¦ä¸Šæ–‡ä»¶æ ¼å¼åç¼€)ï¼Œä¸æŒ‡å®šç³»ç»Ÿä¼šéšæœºç”Ÿæˆ |
| format      | string | ä¿å­˜çš„æ–‡ä»¶æ ¼å¼ï¼Œå¯ä»¥ä¸ºm3u8ã€mp4ã€flv |
| start       | int | æŸ¥è¯¢å¼€å§‹æ—¶é—´(unixæ—¶é—´æˆ³ï¼Œå•ä½ä¸ºç§’) |
| end         | int | æŸ¥è¯¢ç»“æŸæ—¶é—´(unixæ—¶é—´æˆ³ï¼Œå•ä½ä¸ºç§’) |
| deleteTs    | bool| åœ¨ä¸ç”Ÿæˆm3u8æ ¼å¼æ–‡ä»¶æ—¶æ˜¯å¦åˆ é™¤å¯¹åº”çš„tsæ–‡ä»¶ |
| pipeline    | string | æ•°æ®å¤„ç†çš„ç§æœ‰é˜Ÿåˆ—ï¼Œä¸æŒ‡å®šåˆ™ä½¿ç”¨å…¬å…±é˜Ÿåˆ— |
| notifyUrl   | string | ä¿å­˜æˆåŠŸå›è°ƒé€šçŸ¥åœ°å€ï¼Œä¸æŒ‡å®šåˆ™ä¸é€šçŸ¥ |
| deleteAfterDays | int | æ–‡ä»¶è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤å’Œå½•åˆ¶æ¨¡ç‰ˆä¸­çš„è®¾ç½®ä¿æŒä¸€è‡´ |

### saveasReplyç»“æ„ä½“è¯´æ˜

| æˆå‘˜                         | ç±»å‹   | è¯´æ˜                                                         |
| ---------------------------- | ------ | ------------------------------------------------------------ |
| fname          | string | è¡¨ç¤ºä¿å­˜ååœ¨å­˜å‚¨ç©ºé—´é‡Œçš„æ–‡ä»¶åã€‚ä½¿ç”¨å­˜å‚¨ç©ºé—´çš„ä¸‹è½½åŸŸåå¯ä»¥è®¿é—®è¿™æ–‡ä»¶ |
| persistentId   | string | æŒä¹…åŒ–å¼‚æ­¥å¤„ç†ä»»åŠ¡IDï¼Œå¼‚æ­¥æ¨¡å¼æ‰ä¼šè¿”å›è¯¥å­—æ®µï¼Œå¯ä»¥é€šè¿‡è¯¥å­—æ®µæŸ¥è¯¢è½¬ç è¿›åº¦ |
| bucket         | string | æ–‡ä»¶å­˜å‚¨çš„bucket |
| duration       | int    | åˆå¹¶åæ–‡ä»¶çš„æ—¶é•¿(å•ä½ä¸ºç§’) |

### ç¤ºä¾‹
```go
ret, err := c.RecordClipsSaveas("2xenzw5o81ods", "31011500991320000356", &saveasArgs{
		Format: "m3u8",
		Start:  1604989846,
		End:    1604990735,
	})
```
<br />

## **å½•åˆ¶å›æ”¾**

```go
func (manager *Manager) RecordsPlayback(nsId, streamId string, start, end int) (string, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°        | è¯´æ˜                              |
| ----------- | --------------------------------- |
| nsId | ç©ºé—´id                            |
| streamId    | æµID                              |
| start       | æŸ¥è¯¢å¼€å§‹æ—¶é—´(unixæ—¶é—´æˆ³,å•ä½ä¸ºç§’)     |  
| end         | æŸ¥è¯¢ç»“æŸæ—¶é—´(unixæ—¶é—´æˆ³,å•ä½ä¸ºç§’ï¼‰    |
	
# **æ•°æ®ç»Ÿè®¡ç®¡ç†**

## **æŸ¥è¯¢å¸¦å®½æ•°æ®**

```go
func (manager *Manager) QueryBandwidth(nsId, streamId, tu string, start, end int) (*FlowBadwidthData, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°        | è¯´æ˜                              |
| ----------- | --------------------------------- |
| nsId | ç©ºé—´id                            |
| streamId    | æµID                              |
| start       | å¹´æœˆæ—¥æ¨¡å¼(20191001)æˆ–è€…å¹´æœˆæ—¥æ—¶åˆ†ç§’æ¨¡å¼(20201012204005)     |  
| end         | å¹´æœˆæ—¥æ¨¡å¼(20191002)æˆ–è€…å¹´æœˆæ—¥æ—¶åˆ†ç§’æ¨¡å¼(20201012204005)    |
| tu          | æ—¶é—´ç²’åº¦ å¯ä»¥æ˜¯ 5minã€hourã€day   |

### ç¤ºä¾‹

```go
ret, err = c.QueryBandwidth("", "", "hour", 20200901, 20200902)
```
<br />

## **æŸ¥è¯¢æµé‡æ•°æ®**

```go
func (manager *Manager) QueryFlow(nsId, streamId, tu string, start, end int) (*FlowBadwidthData, error)
```

### å‚æ•°è¯´æ˜

| å‚æ•°        | è¯´æ˜                              |
| ----------- | --------------------------------- |
| nsId | ç©ºé—´id                            |
| streamId    | æµID                              |
| start       | å¹´æœˆæ—¥æ¨¡å¼(20191001)æˆ–è€…å¹´æœˆæ—¥æ—¶åˆ†ç§’æ¨¡å¼(20201012204005)     |  
| end         | å¹´æœˆæ—¥æ¨¡å¼(20191002)æˆ–è€…å¹´æœˆæ—¥æ—¶åˆ†ç§’æ¨¡å¼(20201012204005)    |
| tu          | æ—¶é—´ç²’åº¦ å¯ä»¥æ˜¯ 5minã€hourã€day   |

### ç¤ºä¾‹

```go
ret, err := c.QueryFlow("", "", "5min", 20200901, 20200902)
```