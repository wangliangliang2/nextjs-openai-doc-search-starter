模板变量允许您创建一个`交互式和动态的仪表盘`：模板变量可以用在图表的搜索条件、数据配置里，使得一些原来固定的参数变为动态值。具体来说，您可以通过下拉列表或者输入框的形式输入您关心的选项来方便的变换仪表盘的可视化数据。

## **添加模板变量**

在仪表盘页面，点击`模板变量`进入模板变量管理页面。点击界面右上角添加按钮添加模板变量。

仪表盘支持以下几种类型的模板变量：

* 字段内容：字段内容类型的变量通过指定数据来源和取值字段获取字段的值。例如，类型为字段内容的模板变量 status 返回日志中字段 status 的值，日志中 status 字段的值有200、400，则模板变量的选项值是 200，400。
* 时间间隔：时间间隔类型的模板变量用在图表的数据配置中，通过设置时间分组字段的间隔为模板变量 interval 方便的切换时间间隔。
* 数据源：使用数据源类型的模板变量为您方便地切换仪表盘图表地数据来源。当您在不同的使用场景下有不同的数据源的情况下使用数据源类型的模板变量尤其有用。
* 常量：定义一些模板变量的可能取值，用逗号分隔。

每种类型的配置说明：

* 字段内容

  * 变量名称：变量名称，在搜索条件或者数据配置里用模板变量时需填写此变量名称。如在搜索条件引用模板变量 status 表达方式为：status:$status。
  * 展示名称：在仪表盘顶部模板变量的显示名称，取易于理解的名称即可。
  * 变量类型：选择字段内容类型。
  * 查询来源：字段内容的数据来源，支持仓库/视图。
  >注意：字段类型的模板变量支持嵌套数据源类型的模版变量。
  
   如：选择字段内容类型的模板变量的查询来源时，所选择的查询来源也可以是模板变量，极大的增强了仪表盘的灵活性。
	 
	![](https://pandora-kibana.qiniu.com/template/nesting.png)
  * 时间字段：选择仓库的时间字段。
  * 查询语句：输入查询语句。
  * 取值字段：选择日志中具体的字段，字段的取值将成为模板变量的选项值。
  * 支持多选：在仪表盘顶部的模板变量下拉框支持值的多选。
  * 预览：可预览模板变量的取值。

![](https://pandora-kibana.qiniu.com/template/field_variable.png)

* 时间间隔：

  * 变量名称：变量名称，在搜索条件或者数据配置里用模板变量时需填写此变量名称。
  * 展示名：在仪表盘顶部模板变量的显示名称，取易于理解的名称即可。
  * 变量类型：选择时间间隔类型。

![](https://pandora-kibana.qiniu.com/template/interval.png)

* 数据源：

  * 变量名称：变量名称，在搜索条件或者数据配置里用模板变量时需填写此变量名称。
  * 展示名：在仪表盘顶部模板变量的显示名称，取易于理解的名称即可。
  * 变量类型：选择数据源类型。
  * 数据源类型：支持日志仓库（视图）、数据立方、数据集。
  * 预览：可预览模板变量的取值。

![](https://pandora-kibana.qiniu.com/template/datasource.png)

* 常量：

  * 变量名称：变量名称，在搜索条件或者图表标题使用模板变量时需填写此变量名称。
  * 展示名：在仪表盘顶部模板变量的显示名称，取易于理解的名称即可。
  * 变量类型：选择常量类型。
  * 取值类型：支持字符类型/数值类型。
  * 默认选项：为常量变量设置预设值，按回车键确认。

![](https://pandora-kibana.qiniu.com/template/constant.png)

>注意：对于常量类型的模板变量，除了通过下拉列表选择模板变量的取值，您也可以在仪表盘顶部的模板变量输入框直接输入常量值。

## **模板变量的使用**

在仪表盘页面的顶部，您可以看到已经创建好的模板变量。通过下拉框和输入框确定当前仪表盘使用哪个选项值。每种类型的模板变量使用方法如下：

1.字段内容类型：您需要将其应用到图表的查询条件使其生效。

1.1 在图表右上角点击`编辑搜索条件`。

1.2 在查询条件里输入：field:$variable。
![](https://pandora-kibana.qiniu.com/template/field_use.png)

1.3 在模板变量的下拉框选择选项值。
![](https://pandora-kibana.qiniu.com/template/field_uese2.png)
	
2.时间间隔类型：您需要将其应用到图表的数据配置条件使其生效。

2.1 在图表右上角点击`编辑聚合条件和样式`。

2.2 设置时间分组字段（如果图表配置有时间分组字段）的时间间隔为`时间间隔`（模板变量展示名）。
![](https://pandora-kibana.qiniu.com/template/interval_use.png)

2.3 在模板变量的下拉框选择选项值。
![](https://pandora-kibana.qiniu.com/template/interval_use2.png)

3.数据源类型：您需要将其应用到图表的搜索条件使其生效。

3.1 在图表右上角点击`编辑搜索条件`。

3.2 选择数据来源为模板变量：数据来源（模板变量展示名）。

![](https://pandora-kibana.qiniu.com/template/datasource_use1.png)

3.3 在模板变量的下拉框选择模板变量的选项值。

![](https://pandora-kibana.qiniu.com/template/datasource_use2.png)

4.常量类型：您可以将其应用在图表的查询条件、仪表盘标题（描述）、图表标题等地方。

4.1 将常量用在图表的查询条件

4.1.1 在图表右上角点击`编辑搜索条件`。

4.1.2 在查询条件里输入：field:$variable。
![](https://pandora-kibana.qiniu.com/template/constant_use1.png)

4.1.3 在模板变量的下拉框选择选项值，同时支持直接输入选项值。
![](https://pandora-kibana.qiniu.com/template/constant_use2.png)

4.2 将常量用在图表的标题。

在图表标题用 $variable 当作占位符代替原来的固定标题。

![](https://pandora-kibana.qiniu.com/template/constant_use.png)






