异常检测功能通过对历史数据进行学习并持续检测异常，及时告警，告别滞后、延误。同时对历史数据的异常点回顾能够辅助运维决策，如通过对机房历史磁盘写入量进行异常检测，运维人员根据历史异常值进行扩容缩容决策，提高资源利用率。

创建一个对 nginx 日志的请求体指标进行异常检测的任务操作步骤如下：

1. 点击`创建任务`开始配置异常检测指标。

![](https://pandora-kibana.qiniu.com/create_task2.png)

2. 通过选择日志仓库、时间范围、分析指标与字段确定异常检测指标。

![](https://pandora-kibana.qiniu.com/ml_create_task.png)

 **配置异常检测指标说明如下：**

|配置项|解释|
|:--|:--|
|仓库|分析的日志所在的仓库|
|指标|需要分析的指标，目前支持计数， 求和|
|字段|目标分析字段|
|时间字段|若日志里有多个时间字段，选择感兴趣的时间字段来分析该字段的时序范围内的异常|
|时间范围|分析的时序范围|
|时间聚合粒度|时间聚合粒度|

3. 点击`预览指标`查看指标的历史数据。

![](https://pandora-kibana.qiniu.com/create_ml2.png)

!>配置异常指标之后需要点击预览指标，系统将根据预览结果决定是否允许创建异常检测任务。预览无数据或者历史数据量不够均达不到创建异常检测条件。

4. 点击`创建任务`对所配指标进行异常检测。

5. 查看异常检测结果。结果出现之前您需要等待 1 分钟到几分钟的数据学习时间。

![](https://pandora-kibana.qiniu.com/cpu-monitor.png)

**异常检测结果解析：**

异常检测结果包括如下几个信息：

   * 所选指标的预期值范围，包括上界值、下界值和期望值、实际值。

     实际值偏离预期范围的点即为异常点，异常点高亮标示。异常点偏离期望曲线越远，表示异常程度越严重。
   
   * 异常的严重程度与根据机器学习算法得出的分值一一对应。
      
|异常程度|异常分值|
|:--|:--|
|非常严重|0.75～1.00|
|严重|0.50～0.75|
|中度|0.25～0.50|
|轻度|0～0.25|  

6. 如果您只关心严重异常值，可以通过点击`轻度`、`重度`这两种图例取消这两个异常值的显示。

![](https://pandora-kibana.qiniu.com/show_severe.png)

7. 可以拖动时间轴对视图进行控制。

8. 异常列表显示此任务范围内的全部异常情况，可根据异常程度对异常结果进行筛选。

![](https://pandora-kibana.qiniu.com/ml_result_detail.png)

9. 通过分析异常结果来指导业务，保证业务的稳定性。具体来说，如图所示，通过对 pipeline_nginx 的请求体进行异常检测来查看 nginx 服务运转情况，与异常原因结合起来分析，是入口机器宕机、网卡损坏或是其他原因。通过回顾历史服务问题，包括异常频率、异常程度、异常原因来辅助业务上的决策。
