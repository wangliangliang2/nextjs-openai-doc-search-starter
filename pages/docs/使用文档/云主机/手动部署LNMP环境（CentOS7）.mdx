<div> <main role="main"> Nginx是一款小巧而高效的Web服务器软件，可帮您在Linux系统下快速方便地搭建出LNMP Web服务环境。本教程介绍如何手动在QVM实例上搭建LNMP环境，其中LNMP分别代表Linux、Nginx、MySQL和PHP。</p> 
	<div> <div> <h1 font-weigh = "bold">前提条件</h1> </div> <ul class="ul" id="ul-1j6-gdr-woa"> <li>已注册七牛云账号</span>。 </li> <li>已完成实名认证。如还未认证，请先完成<span>实名认证</span>。 </li> <li>已创建QVM实例并为实例分配公网IP地址。</span>。 </li> <li>已在实例安全组的入方向添加安全组规则并放行80端口</span>。 </li> </ul> </div> <section class="section context" id="context-iw1-5fs-txh"> <div> <h1 font-weigh = "bold">背景信息</h1> </div> <p class="p" id="p-pd8-u0a-7i2">本教程适用于熟悉Linux操作系统，刚开始使用七牛云进行建站的个人用户。</p>  </p> <div>本篇教程在示例步骤中使用了以下配置的QVM实例。实际操作时，请以您的实例配置为准。 <ul class="ul" id="ul-1dg-eee-8fu"> <li>实例规格：ecs.c6.large</li> <li>CPU：2 vCPU</li> <li>内存：4GiB</li> <li>操作系统：公共镜像CentOS 7.2 64位</li> <li>网络类型：专有网络VPC</li> <li>IP地址：公网IP</li> </ul> </div> <div>示例步骤将使用以下软件版本： <ul class="ul" id="ul-ms7-11x-3np"> <li>Nginx版本：Nginx 1.16.1</li> <li>MySQL版本：MySQL 5.7.28</li> <li>PHP版本：PHP 7.0.33</li> </ul> <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 当您使用不同软件版本时，可能需要根据实际情况调整命令和参数配置。 </div> </div> </div> </section> <section class="section" id="section-swe-tkc-2ir"> <h1 font-weigh = "bold">步骤一：准备编译环境</h1> <ol class="ol steps" id="steps-noa-ozj-w6w"> <li><span>远程连接Linux实例。</span></li> <li><span>关闭防火墙。</span><ol type="a" class="ol substeps" id="substeps-bwy-h1e-nzn"> <li><span>运行<span>systemctl status firewalld</span>命令查看当前防火墙的状态。</span><div><img class="image break" id="image-83y-uoa-4zr" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/bFy80TrB7hvjW4CUtZw3.png" alt="查看防火墙状态"></div> <div> <ul class="ul" id="ul-hfu-lr8-gts"> <li>如果防火墙的状态参数是<span>inactive</span>，则防火墙为关闭状态。 </li> <li>如果防火墙的状态参数是<span>active</span>，则防火墙为开启状态。本示例中防火墙为开启状态，因此需要关闭防火墙。 </li> </ul> </div> </li> <li><span>关闭防火墙。如果防火墙为关闭状态可以忽略此步骤。</span><div> <ul class="ul" id="ul-5in-74f-j98"> <li>如果您想临时关闭防火墙，运行命令<span>systemctl stop firewalld</span>。 <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 这只是暂时关闭防火墙，下次重启Linux后，防火墙还会开启。 </div> </div> </li> <li>如果您想永久关闭防火墙，运行命令<span>systemctl disable firewalld</span>。 <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 如果您想重新开启防火墙，请参见<span><a href="https://firewalld.org/?spm=a2c4g.11186623.2.24.4d387e894QIr03">firewalld官网信息</a></span>。 </div> </div> </li> </ul> </div> </li> </ol> </li> <li><span>关闭SELinux。</span><ol type="a" class="ol substeps" id="substeps-d5e-pqt-n6u"> <li><span>运行<span>getenforce</span>命令查看SELinux的当前状态。</span><div><img class="image break" id="image-jyb-30i-rn8" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/r0KYH456BCfJdenNpgvI.png" alt="查看SELinux状态"></div> <div> <ul class="ul" id="ul-dkc-qoo-x5y"> <li>如果SELinux状态参数是<span>Disabled</span>，则SELinux为关闭状态。 </li> <li>如果SELinux状态参数是<span>Enforcing</span>，则SELinux为开启状态。本示例中SELinux为开启状态，因此需要关闭SELinux。 </li> </ul> </div> </li> <li><span>关闭SELinux。如果SELinux为关闭状态可以忽略此步骤。</span><div> <ul class="ul" id="ul-m7l-xo0-els"> <li>如果您想临时关闭SELinux，运行命令<span>setenforce 0</span>。 <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 这只是暂时关闭SELinux，下次重启Linux后，SELinux还会开启。 </div> </div> </li> <li>如果您想永久关闭SELinux，运行命令<span>vim /etc/selinux/config</span>编辑SELinux配置文件。回车后，把光标移动到<code>SELINUX=enforcing</code>这一行，按<kbd>i</kbd>键进入编辑模式，修改为<code>SELINUX=disabled</code>，按<kbd>Esc</kbd>键，然后输入<kbd>:wq</kbd>并按<kbd>Enter</kbd>键以保存并关闭SELinux配置文件。 <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 如果您想重新开启SELinux，请参见<span><a href="https://help.aliyun.com/document_detail/157022.html?spm=a2c4g.11186623.2.26.4d387e894QIr03#task-2385075">开启或关闭SELinux</a></span>。 </div> </div>重启系统使设置生效。 </li> </ul> </div> </li> </ol> </li> </ol> </section> <section class="section" id="section-dri-f0r-ivi"> <h1 font-weigh = "bold">步骤二：安装Nginx</h1> <ol class="ol steps" id="steps-8vi-uzx-8zc"> <li><span>运行以下命令安装Nginx。</span><div><pre><code>yum -y install nginx</code></pre></div> </li> <li><span>运行以下命令查看Nginx版本。</span><div><pre><code>nginx -v</code></pre></div> <div> <div>返回结果如下所示，表示Nginx安装成功。 <pre><code>nginx version: nginx/1.16.1</code></pre></div> </div> </li> </ol> </section> <section class="section" id="section-sok-8r6-jr6"> <h1 font-weigh = "bold">步骤三：安装MySQL</h1> <ol class="ol steps" id="steps-ggd-qfe-gpm"> <li><span>运行以下命令更新YUM源。</span><div><pre><code>rpm -Uvh http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</code></pre></div> </li> <li><span>运行以下命令安装MySQL。</span><div> <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 如果您使用的操作系统内核版本为el8，可能会提示报错信息<samp class="ph msgph" id="msgph-msy-0bm-c4t">No match for argument</samp>。您需要先运行命令<span>yum module disable mysql</span>禁用默认的mysql模块，再安装MySQL。 </div> </div><pre><code>yum -y install mysql-community-server</code></pre></div> </li> <li><span>运行以下命令查看MySQL版本号。</span><div><pre><code>mysql -V</code></pre></div> <div> <div>返回结果如下所示，表示MySQL安装成功。 <pre><code>mysql Ver 14.14 Distrib 5.7.28, for Linux (x86_64) using EditLine wrapper</code></pre></div> </div> </li> <li><span>运行以下命令启动MySQL。</span><div><pre><code>systemctl start mysqld</code></pre></div> </li> <li><span>运行以下命令设置开机启动MySQL。</span><div><pre><code>systemctl enable mysqldsystemctl daemon-reload</code></pre></div> </li> </ol> </section> <section class="section" id="section-5tw-l02-k4s"> <h1 font-weigh = "bold">步骤四：安装PHP</h1> <ol class="ol steps" id="steps-rg2-b38-gkh"> <li><span>更新YUM源。</span><ol type="a" class="ol substeps" id="substeps-208-tzt-mjv"> <li><span>运行以下命令添加epel源。</span><div><pre><code>yum install \
https://repo.ius.io/ius-release-el7.rpm \
https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</code></pre></div> </li> <li><span>运行以下命令添加Webtatic源。</span><div><pre><code>rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</code></pre></div> </li> </ol> </li> <li><span>运行以下命令安装PHP。</span><div><pre><code>yum -y install php70w-devel php70w.x86_64 php70w-cli.x86_64 php70w-common.x86_64 php70w-gd.x86_64 php70w-ldap.x86_64 php70w-mbstring.x86_64 php70w-mcrypt.x86_64 php70w-pdo.x86_64 php70w-mysqlnd php70w-fpm php70w-opcache php70w-pecl-redis php70w-pecl-mongodb</code></pre></div> </li> <li><span>运行以下命令查看PHP版本。</span><div><pre><code>php -v</code></pre></div> <div> <div>返回结果如下所示，表示安装成功。 <pre><code>PHP 7.0.33 (cli) (built: Dec  6 2018 22:30:44) ( NTS )
Copyright (c) 1997-2017 The PHP Group
Zend Engine v3.0.0, Copyright (c) 1998-2017 Zend Technologies
    with Zend OPcache v7.0.33, Copyright (c) 1999-2017, by Zend Technologies                </code></pre></div> </div> </li> </ol> </section> <section class="section" id="section-e7d-ddt-6tc"> <h1 font-weigh = "bold">步骤五：配置Nginx</h1> <ol class="ol steps" id="steps-bcr-6a2-krc"> <li><span>运行以下命令备份Nginx配置文件。</span><div><pre><code>cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak</code></pre></div> </li> <li><span>修改Nginx配置文件，添加Nginx对PHP的支持。</span><div> <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 若不添加此配置信息，后续您使用浏览器访问PHP页面时，页面将无法显示。 </div> </div> </div> <ol type="a" class="ol substeps" id="substeps-gq6-8fg-gn8"> <li><span>运行以下命令打开Nginx配置文件。</span><div><pre><code>vim /etc/nginx/nginx.conf</code></pre></div> </li> <li><span>按<kbd>i</kbd>进入编辑模式。</span></li> <li><span>在<code>server</code>大括号内，修改或添加下列配置信息。</span><div><pre><code> 
#除下面提及的需要添加的配置信息外，其他配置保持默认值即可。
        #将location / 大括号内的信息修改为以下所示，配置网站被访问时的默认首页。
        location / {
            index index.php index.html index.htm;
        }
#添加下列信息，配置Nginx通过fastcgi方式处理您的PHP请求。
        location ~ .php$ {
            root /usr/share/nginx/html;    #将/usr/share/nginx/html替换为您的网站根目录，本教程使用/usr/share/nginx/html作为网站根目录。
            fastcgi_pass 127.0.0.1:9000;   #Nginx通过本机的9000端口将PHP请求转发给PHP-FPM进行处理。
            fastcgi_index index.php;
            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
            include fastcgi_params;   #Nginx调用fastcgi接口处理PHP请求。
        }                
	</code></pre><p class="p" id="p-t48-c4l-eq7">添加配置信息后，如下图所示。</p><img class="image break" id="image-3g5-h8h-2g0" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/eMaXINsSHGf6cFuQBTOg.png" alt="nginx-configuration"></div> </li> <li><span>按下<kbd>Esc</kbd>键后，输入<kbd>:wq</kbd>并回车以保存并关闭配置文件。</span></li> </ol> </li> <li><span>运行以下命令启动Nginx服务。</span><div><pre><code>systemctl start nginx </code></pre></div> </li> <li><span>运行以下命令设置Nginx服务开机自启动。</span><div><pre><code>systemctl enable nginx</code></pre></div> </li> </ol> </section> <section class="section" id="section-mp6-h2y-zkp"> <h1 font-weigh = "bold">步骤六：配置MySQL</h1> <ol class="ol steps" id="steps-9hm-zo0-kvm"> <li><span>运行以下命令查看<span>/var/log/mysqld.log</span>文件，获取并记录root用户的初始密码。</span><div><pre><code>grep 'temporary password' /var/log/mysqld.log</code></pre><p class="p" id="p-ivv-tfn-lmj">返回结果如下：</p><pre><code>2016-12-13T14:57:47.535748Z 1 [Note] A temporary password is generated for root@localhost: p0/G28g&gt;lsHD</code></pre><div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 下一步重置root用户密码时，会使用该初始密码。 </div> </div> </div> </li> <li><span>运行以下命令配置MySQL的安全性。</span><div><pre><code>mysql_secure_installation</code></pre><p class="p" id="p-x0k-wh0-eeb">安全性的配置包含以下五个方面：</p> </div> <ol type="a" class="ol substeps" id="substeps-2mr-t94-5wu"> <li><span>重置root账号密码。</span><div><pre><code>Enter password for user root: #输入上一步获取的root用户初始密码
The 'validate_password' plugin is installed on the server.
The subsequent steps will run with the existing configuration of the plugin.
Using existing password for root.
Estimated strength of the password: 100 
Change the password for root ? (Press y|Y for Yes, any other key for No) : Y #是否更改root用户密码，输入Y
New password: #输入新密码，长度为8至30个字符，必须同时包含大小写英文字母、数字和特殊符号。特殊符号可以是()` ~!@#$%^&*-+=|{}[]:;‘<>,.?/
Re-enter new password: #再次输入新密码
Estimated strength of the password: 100 
Do you wish to continue with the password provided?(Press y|Y for Yes, any other key for No) : Y</code></pre></div> </li> <li><span>输入<kbd>Y</kbd>删除匿名用户账号。</span><div><pre><code>By default, a MySQL installation has an anonymous user, allowing anyone to log into MySQL without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment.Remove anonymous users? (Press y|Y for Yes, any other key for No) : Y #是否删除匿名用户，输入YSuccess.</code></pre></div> </li> <li><span>输入<kbd>Y</kbd>禁止root账号远程登录。</span><div><pre><code>Disallow root login remotely? (Press y|Y for Yes, any other key for No) : Y #禁止root远程登录，输入YSuccess.</code></pre></div> </li> <li><span>输入<kbd>Y</kbd>删除test库以及对test库的访问权限。</span><div><pre><code>Remove test database and access to it? (Press y|Y for Yes, any other key for No) : Y #是否删除test库和对它的访问权限，输入Y- Dropping test database...Success.</code></pre></div> </li> <li><span>输入<kbd>Y</kbd>重新加载授权表。</span><div><pre><code>Reload privilege tables now? (Press y|Y for Yes, any other key for No) : Y #是否重新加载授权表，输入YSuccess.All done!</code></pre></div> </li> </ol> </li> </ol> <p class="p" id="p-lee-gpe-0dn">更多详情，请参见<span><a>MySQL文档</a></span>。 </p> </section> <section class="section" id="section-ual-v4d-k6e"> <h1 font-weigh = "bold">步骤七：配置PHP</h1> <ol class="ol steps" id="steps-j9l-i7z-f18"> <li><span>新建<span>phpinfo.php</span>文件，用于展示PHP信息。</span><ol type="a" class="ol substeps" id="substeps-j1n-zeq-d5f"> <li><span>运行以下命令新建文件。</span><div><pre><code>vim &lt;网站根目录&gt;/phpinfo.php #将<code>&lt;网站根目录&gt;</code>替换为您配置的网站根目录。</code></pre><p class="p" id="p-6kj-4gd-mm1">网站根目录是您在<span>nginx.conf</span>文件中<code>location ~ .php$</code>大括号内配置的<code>root</code>值，如下图所示。 </p><img class="image break" id="image-c3a-8mm-6uc" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/fxumtjik7MNFCXcp0KTG.png" alt="lnmp-root-dir"><p class="p" id="p-x9z-d1p-stq">本教程配置的网站根目录为<span>/usr/share/nginx/html</span>，因此命令为： </p><pre><code>vim /usr/share/nginx/html/phpinfo.php</code></pre></div> </li> <li><span>按<kbd>i</kbd>进入编辑模式。</span></li> <li><span>输入下列内容，函数<code>phpinfo()</code>​会展示PHP的所有配置信息。</span><div><pre><code>&lt;?php echo phpinfo(); ?&gt;</code></pre></div> </li> <li><span>按<kbd>Esc</kbd>键后，输入<kbd>:wq</kbd>并回车以保存并关闭配置文件。</span></li> </ol> </li> <li><span>运行以下命令启动PHP-FPM。</span><div><pre><code>systemctl start php-fpm</code></pre></div> </li> <li><span>运行以下命令设置PHP-FPM开机自启动。</span><div><pre><code>systemctl enable php-fpm</code></pre></div> </li> </ol> </section> <section class="section" id="section-b0a-az5-erl"> <h1 font-weigh = "bold">步骤八：测试访问LNMP平台</h1> <ol class="ol steps" id="steps-wod-8ct-ccp"> <li><span>打开浏览器。</span></li> <li><span>在地址栏输入<code>http://&lt;QVM实例公网IP地址&gt;/phpinfo.php</code>。</span><div> <div>返回结果如下图所示，表示LNMP环境部署成功。<img class="image break" id="image-rju-9rz-r6y" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/NPrvHC3SOi8WZdjpn2mt.png" alt="LNMP部署成功"></div> </div> </li> </ol> </section> <section class="section postreq" id="postreq-zoc-s58-jny"> <div> <h1 font-weigh = "bold">后续步骤</h1> </div> <div>测试访问LNMP平台成功后，建议您运行以下命令将<span>phpinfo.php</span>文件删除，消除安全隐患。 <pre><code>rm -rf &lt;网站根目录&gt;/phpinfo.php #将&lt;网站根目录&gt;替换为您在nginx.conf中配置的网站根目录</code></pre></div> <p class="p" id="p-ler-uiu-wlg">本教程配置的网站根目录为<span>/usr/share/nginx/html</span>，因此命令为： </p><pre><code>rm -rf /usr/share/nginx/html/phpinfo.php</code></pre></section> </div> </article> </main> </div> </div>