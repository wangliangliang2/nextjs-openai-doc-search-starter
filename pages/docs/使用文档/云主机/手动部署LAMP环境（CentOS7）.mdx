<div> <main role="main"> <article role="article" aria-labelledby="title_q2x_066_mta"> <div> <p class="shortdesc">本教程介绍如何使用云服务器QVM实例搭建LAMP平台，其中LAMP分别代表Linux、Apache、MySQL和PHP。</p> <div> <div> <h1 font-weigh = "bold">前提条件</h1> </div> <ul class="ul" id="ul-efi-fjq-hxj"> <li>已注册七牛云账号。如还未注册，请先完成<span><a href="https://portal.qiniu.com/signup?ref=developer.qiniu.comregister.htm?" target="_blank">账号注册</a></span>。 </li> <li>已完成实名认证。如还未认证，请先完成<span>实名认证</span>。 </li> <li>已创建QVM实例并为实例分配公网IP地址。 <div>本篇教程使用以下配置的QVM实例： <ul class="ul" id="ul-xi9-1nr-xcj"> <li>实例规格：ecs.c6.large</li> <li>操作系统：公共镜像CentOS 7.8 64位</li> <li>网络类型：专有网络VPC</li> <li>IP地址：公网IP</li> </ul> </div> </li> <li>已在实例安全组的入方向添加安全组规则并放行22、80端口。 </li> </ul> </div> <section class="section context" id="context-8vh-zpe-2kf"> <div> <h1 font-weigh = "bold">背景信息</h1> </div> <div>本篇教程适用于熟悉Linux操作系统，初次使用七牛云进行建站的个人用户。在示例步骤中使用了以下版本的软件。操作时，请您以实际软件版本为准。 <ul class="ul" id="ul-dir-xne-pp3"> <li>Apache：2.4.6</li> <li>MySQL：5.7.31</li> <li>PHP：7.0.33</li> <li>phpMyAdmin：4.0.10.20</li> </ul> </div> </section> <section class="section" id="section-g52-3gn-gq0"> <h1 font-weigh = "bold">步骤一：准备工作</h1> <ol class="ol steps" id="steps-0gi-nnc-3k0"> <li><span><span>创建实例</span>。</span></li> <li><span><span>通过SSH远程连接Linux实例/span>。</li> <li><span>运行命令<span>cat /etc/redhat-release</span>查看系统版本。</span><div><img class="image break" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/a2DCL8U6xv49V1iOBmSF.png" width="350" alt="CentOS 7.8"></div> </li> <li><span>关闭防火墙。</span><ol type="a" class="ol substeps" id="substeps-fei-o90-q17"> <li><span>运行<span>systemctl status firewalld</span>命令查看当前防火墙的状态。</span><div><img class="image break" id="image-i0g-l26-qt8" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/tdjxmbCSU0Q4gD9fEqiz.png" alt="查看防火墙状态"></div> <div> <ul class="ul" id="ul-omz-fos-tr0"> <li>如果防火墙的状态参数是<span>inactive</span>，则防火墙为关闭状态。 </li> <li>如果防火墙的状态参数是<span>active</span>，则防火墙为开启状态。本示例中防火墙为开启状态，因此需要关闭防火墙。 </li> </ul> </div> </li> <li><span>关闭防火墙。如果防火墙为关闭状态，请忽略此步骤。</span><div> <ul class="ul" id="ul-g9j-9q4-bps"> <li>如果您想临时关闭防火墙，运行命令<span>systemctl stop firewalld</span>。 <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 这只是暂时关闭防火墙，下次重启Linux后，防火墙还会开启。 </div> </div> </li> <li>如果您想永久关闭防火墙，运行命令<span>systemctl disable firewalld</span>。 <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 如果您想重新开启防火墙，请参见<span><a href="https://firewalld.org/" target="_blank">firewalld官网信息</a></span>。 </div> </div> </li> </ul> </div> </li> </ol> </li> <li><span>关闭SELinux。</span><ol type="a" class="ol substeps" id="substeps-ufz-e1c-dsq"> <li><span>运行<span>getenforce</span>命令查看SELinux的当前状态。</span><div><img class="image break" id="image-o87-l5e-dt2" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/a5W1NvhRpBKQVYGo3ZHr.png" alt="查看SELinux状态"></div> <div> <ul class="ul" id="ul-w0x-adc-1zz"> <li>如果SELinux状态参数是<span>Disabled</span>， 则SELinux为关闭状态。 </li> <li>如果SELinux状态参数是<span>Enforcing</span>，则SELinux为开启状态。本示例中SELinux为开启状态，因此需要关闭SELinux。 </li> </ul> </div> </li> <li><span>关闭SELinux。如果SELinux为关闭状态，请忽略此步骤。</span><div> <ul class="ul" id="ul-eg4-ly8-irj"> <li>如果您想临时关闭SELinux，运行命令<code>setenforce 0</code>。 <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 这只是暂时关闭SELinux，下次重启Linux后，SELinux还会开启。 </div> </div> </li> <li>如果您想永久关闭SELinux，运行命令<span>vi /etc/selinux/config</span>编辑SELinux配置文件。回车后，把光标移动到<code>SELINUX=enforcing</code>这一行，按<kbd>i</kbd>键，将其修改为<code>SELINUX=disabled</code>， 按<kbd>Esc</kbd>键，然后输入<kbd>:wq</kbd>并回车以保存并关闭SELinux配置文件。 <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 如果您想重新开启SELinux，请参见<span><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/5/html/deployment_guide/ch-selinux#s1-SELinux-resources" target="_blank">SELinux的官方文档</a></span>。 </div> </div>重启系统使设置生效。 </li> </ul> </div> </li> </ol> </li> </ol> </section> <section class="section" id="section-quq-rne-jnu"> <h1 font-weigh = "bold">步骤二：安装Apache</h1> <ol class="ol steps" id="steps-z5i-fkp-uv3"> <li><span>运行以下命令安装Apache服务及扩展包。</span><div><pre><code>yum -y install httpd httpd-manual mod_ssl mod_perl mod_auth_mysql</code></pre></div> </li> <li><span>运行<span>httpd -v</span>命令可查看Apache的版本号。</span><div><img class="image break" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/bGCDtvw6RpKyduk8cxBr.png" width="350" alt="httpd -v"></div> </li> <li><span>依次运行以下命令启动Apache服务并设置服务开机自启动。 </span><div> <ol class="ol" type="a" id="ol-f0l-6uv-4d2"> <li><pre><code>systemctl start httpd</code></pre></li> <li><pre><code>systemctl enable httpd</code></pre></li> </ol> </div> </li> <li><span>查看安装结果。</span><ol type="a" class="ol substeps" id="substeps-lmt-f4g-lh3"> <li><span>登录<span><a href="https://portal.qiniu.com/qvm/dashboard" target="_blank">QVM管理控制台</a></span>。</span></li> <li><span>在左侧导航栏，单击<span><span>实例与镜像</span><abbr> &gt; </abbr><span>实例</span></span>。</span></li> <li><span>在<span>实例列表</span>中找到正在部署环境的实例，从该实例的<span>IP地址</span>中复制公网IP。</span></li> <li><span>在本地机器的浏览器地址栏中，输入<code>http://实例公网IP</code>并按<kbd>Enter</kbd>键。</span><div>若返回页面如下图所示，说明Apache服务启动成功。<img class="image break" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/jIipJcuyMURC3b9PqEhZ.png" width="650" alt="httpd"></div> </li> </ol> </li> </ol> </section> <section class="section" id="section-11v-i8e-gi0"> <h1 font-weigh = "bold">步骤三：安装并配置MySQL</h1> <ol class="ol steps" id="steps-70b-yuc-zbo"> <li><span>运行以下命令更新YUM源。</span><div><pre><code>rpm -Uvh http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</code></pre></div> </li> <li><span>运行以下命令安装MySQL。</span><div> <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 如果您使用的操作系统内核版本为el8，可能会提示报错信息<samp class="ph msgph" id="msgph-g3k-31j-ipk">No match for argument</samp>。您需要先运行命令<span>yum module disable mysql</span>禁用默认的mysql模块，再安装MySQL。 </div> </div><pre><code>yum -y install mysql-community-server</code></pre></div> </li> <li><span>运行以下命令查看MySQL版本号。</span><div><pre><code>mysql -V</code></pre></div> <div> <div>返回结果如下所示，表示MySQL安装成功。 <pre><code>mysql Ver 14.14 Distrib 5.7.31, for Linux (x86_64) using EditLine wrapper</code></pre></div> </div> </li> <li><span>运行以下命令启动MySQL。</span><div><pre><code>systemctl start mysqld</code></pre></div> </li> <li><span>运行以下命令设置开机启动MySQL。</span><div><pre><code>systemctl enable mysqldsystemctl daemon-reload</code></pre></div> </li> <li><span>运行以下命令查看MySQL的初始密码。</span><div><pre><code>grep "password" /var/log/mysqld.log</code></pre></div> <div>返回结果示例如下，本示例中初始密码为<code>+47,uijcojcU</code>。<pre><code>2020-08-28T03:01:49.848762Z 1 [Note] A temporary password is generated for root@localhost: +47,uijcojcU</code></pre></div> </li> <li><span>运行以下命令配置MySQL的安全性。</span><div><pre><code>mysql_secure_installation</code></pre><p class="p" id="p-fop-6nu-lap">安全性的配置包含以下五个方面：</p> </div> <ol type="a" class="ol substeps" id="substeps-y02-896-jnx"> <li><span>重置root账号的密码。</span><div> <div> <div><i class="icon-note note"></i></div> <div><strong>说明</strong> 请您安全保管root账号的密码信息。 </div> </div><pre><code>Enter password for user root: #输入上一步获取的root用户初始密码The 'validate_password' plugin is installed on the server.The subsequent steps will run with the existing configuration of the plugin.Using existing password for root.Estimated strength of the password: 100 Change the password for root ? (Press y|Y for Yes, any other key for No) : Y #是否更改root用户密码，输入YNew password: #输入新密码，长度为8至30个字符，必须同时包含大小写英文字母、数字和特殊符号。特殊符号可以是()` ~!@#$%^&amp;*-+=|{}[]:;‘&lt;&gt;,.?/Re-enter new password: #再次输入新密码Estimated strength of the password: 100 Do you wish to continue with the password provided?(Press y|Y for Yes, any other key for No) : Y</code></pre></div> </li> <li><span>输入<kbd>Y</kbd>删除匿名用户账号。</span><div><pre><code>By default, a MySQL installation has an anonymous user, allowing anyone to log into MySQL without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment.Remove anonymous users? (Press y|Y for Yes, any other key for No) : Y #是否删除匿名用户，输入YSuccess.</code></pre></div> </li> <li><span>输入<kbd>Y</kbd>禁止root账号远程登录。</span><div><pre><code>Disallow root login remotely? (Press y|Y for Yes, any other key for No) : Y #禁止root远程登录，输入YSuccess.</code></pre></div> </li> <li><span>输入<kbd>Y</kbd>删除test库以及对test库的访问权限。</span><div><pre><code>Remove test database and access to it? (Press y|Y for Yes, any other key for No) : Y #是否删除test库和对它的访问权限，输入Y- Dropping test database...Success.</code></pre></div> </li> <li><span>输入<kbd>Y</kbd>重新加载授权表。</span><div><pre><code>Reload privilege tables now? (Press y|Y for Yes, any other key for No) : Y #是否重新加载授权表，输入YSuccess.All done!</code></pre></div> </li> </ol> </li> </ol> </section> <section class="section" id="section-mi4-v1k-psh"> <h1 font-weigh = "bold">步骤四：安装PHP</h1> <ol class="ol steps" id="steps-dhw-eas-8rg"> <li><span>更新YUM源。</span><ol type="a" class="ol substeps" id="substeps-60x-vjf-efl"> <li><span>运行以下命令添加epel源。</span><div><pre><code>yum install -y \https://repo.ius.io/ius-release-el7.rpm \https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</code></pre></div> </li> <li><span>运行以下命令添加Webtatic源。</span><div><pre><code>rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</code></pre></div> </li> </ol> </li> <li><span>运行以下命令安装PHP。</span><div><pre><code>yum -y install php70w-devel php70w.x86_64 php70w-cli.x86_64 php70w-common.x86_64 php70w-gd.x86_64 php70w-ldap.x86_64 php70w-mbstring.x86_64 php70w-mcrypt.x86_64 php70w-pdo.x86_64 php70w-mysqlnd php70w-fpm php70w-opcache php70w-pecl-redis php70w-pecl-mongodb</code></pre></div> </li> <li><span>运行以下命令查看PHP版本。</span><div><pre><code>php -v</code></pre></div> <div> <div>返回结果如下所示，表示安装成功。 <pre><code>PHP 7.0.33 (cli) (built: Dec 6 2018 22:30:44) ( NTS )Copyright (c) 1997-2017 The PHP GroupZend Engine v3.0.0, Copyright (c) 1998-2017 Zend Technologies with Zend OPcache v7.0.33, Copyright (c) 1999-2017, by Zend Technologies </code></pre></div> </div> </li> <li><span>运行以下命令，在Apache网站根目录创建测试文件。</span><div><pre><code>echo "&lt;?php phpinfo(); ?&gt;" &gt; /var/www/html/phpinfo.php</code></pre></div> </li> <li><span>运行以下命令重启Apache服务。</span><div><pre><code>systemctl restart httpd</code></pre></div> </li> <li><span>在本地机器的浏览器地址栏中，输入<code>http://实例公网IP/phpinfo.php</code>并按<kbd>Enter</kbd>键。</span><div>显示如下页面表示安装成功。
	<img class="image break" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/hcl5WD0MvkAY74wZH6rp.png" width="700" alt="PHP"></div> </li> </ol> </section> <section class="section" id="section-sae-6lj-aa5"> <h1 font-weigh = "bold">步骤五：安装phpMyAdmin</h1> <p class="p" id="p-0l6-wp8-dd5">phpMyAdmin是一个MySQL数据库管理工具，通过Web接口管理数据库方便快捷。</p> <ol class="ol steps" id="steps-331-7o5-4de"> <li><span>运行以下命令准备phpMyAdmin数据存放目录。 </span><div><pre><code>mkdir -p /var/www/html/phpmyadmin</code></pre></div> </li> <li><span>运行以下命令下载phpMyAdmin压缩包并解压。</span><div> <ol class="ol" type="a" id="ol-ymp-f4e-rnn"> <li>下载phpMyAdmin压缩包。<pre><code>cdwget https://files.phpmyadmin.net/phpMyAdmin/4.0.10.20/phpMyAdmin-4.0.10.20-all-languages.zip</code></pre></li> <li>解压phpMyAdmin压缩包。<pre><code>yum install -y unzipunzip phpMyAdmin-4.0.10.20-all-languages.zip</code></pre></li> </ol> </div> </li> <li><span>运行以下命令复制phpMyAdmin文件到准备好的数据存放目录。 </span><div><pre><code>mv phpMyAdmin-4.0.10.20-all-languages/* /var/www/html/phpmyadmin</code></pre></div> </li> <li><span>在本地机器浏览器地址栏，输入<code>http://实例公网 IP/phpmyadmin</code>并按<kbd>Enter</kbd>键，访问phpMyAdmin登录页面。</span><div>若返回页面如下图所示，说明phpMyAdmin安装成功。
	<img class="image break" id="image-7hu-6qr-ynz" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/yg0qWYnB3teZOiLA2MFm.png" alt="phpMyAdmin安装成功"></div> </li> <li><span>输入MySQL的用户名和密码，单击<span>执行</span>。</span><div>
	<img class="image break" id="image-q5k-3j5-dvh" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/y5YUqw9t84uKvI2Xam6i.png" alt="输入用户名和密码"></div> <div>如果出现以下页面，说明MySQL连接成功。
	<img class="image break" id="image-wmn-lp9-2rw" src="http://qey2kbifv.hn-bkt.clouddn.com/2020-09-04/qN0Cz9aOSF7UD6BsngVR.png" alt="MySQL连接成功"></div> </li> </ol> </section> </div> </article> </main> </div> </div>