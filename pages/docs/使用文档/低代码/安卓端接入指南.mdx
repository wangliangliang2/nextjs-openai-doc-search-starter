<link rel="stylesheet" type="text/css" href="https://docs.qnsdk.com/styles/doc-v4-api.css" />
<div class="rtc-doc rtc-doc-ast" id="rtc-doc">
    <div><pre><code>                                                   
<span></span>                              +---------------+     +--<span class="hljs-punctuation">-&gt;</span> RoomListPage <span class="hljs-comment">//房间列表UI实现页面</span>
<span></span>                              |               |     |
<span></span>                          +---+   QLiveUIKIT  +--- -+
<span></span>                          |   |               |     |
<span></span>                          |   +---------------+     +--<span class="hljs-punctuation">-&gt;</span> RoomPage    <span class="hljs-comment">//直播间页面UI实现</span>
<span></span>                          |       uikit sdk   
<span></span>                          | 
<span></span>                          |                        
<span></span>                          |                         
<span></span>                          |                         +--<span class="hljs-punctuation">-&gt;</span> createRoom  <span class="hljs-comment">//创建房间接口</span>
<span></span>                          |   +---------------+     |
<span></span>+----------------------+  |   |               |     +--<span class="hljs-punctuation">-&gt;</span> listRoom    <span class="hljs-comment">//房间列表接口</span>
<span></span>|                      |  +---+     QRooms    +-----+
<span></span>|      QLive           |  |   |               |     +--<span class="hljs-punctuation">-&gt;</span> deleteRoom  <span class="hljs-comment">//删除房间接口</span>
<span></span>|                      |  |   +---------------+     |
<span></span>+----------------------+  |       房间管理接口        +--<span class="hljs-punctuation">-&gt;</span> getRoomInfo <span class="hljs-comment">//获取房间信息接口</span>
<span></span>                          |
<span></span>                          | 
<span></span>                          | 
<span></span>                          |                         +--<span class="hljs-punctuation">-&gt;</span>  QChatRoomService <span class="hljs-comment">//聊天室服务 </span>
<span></span>                          |   +----------------+    |
<span></span>                          |   |                |    +--<span class="hljs-punctuation">-&gt;</span>  QLinkMicService  <span class="hljs-comment">//连麦业务服务</span>
<span></span>                          +---+   QLiveClient   +---+
<span></span>                              |                |    +--<span class="hljs-punctuation">-&gt;</span>  QPKService       <span class="hljs-comment">//pk业务服务</span>
<span></span>                              +----------------+    |
<span></span>                                 推拉流房间客户端      +--<span class="hljs-punctuation">-&gt;</span>  QPublicChatService <span class="hljs-comment">//房间里公屏消息服务       </span>
<span></span>                                   无UI版本sdk       |
<span></span>                                                    +--<span class="hljs-punctuation">-&gt;</span>  QRoomService     <span class="hljs-comment">//房间频道业务 </span>
<span></span>                                                    |    
<span></span>                                                    +--<span class="hljs-punctuation">-&gt;</span>  QDanmakuService  <span class="hljs-comment">//弹幕服务 </span>
<span></span>                                                    | 
<span></span>                                                    +--<span class="hljs-punctuation">-&gt;</span>  QShoppingService <span class="hljs-comment">//电商购物服务 </span>
<span></span>                                                    |
<span></span>                                                    +--<span class="hljs-punctuation">-&gt;</span>  QGiftService <span class="hljs-comment">//礼物服务  </span>
<span></span>                                                    |
<span></span>                                                    +--<span class="hljs-punctuation">-&gt;</span>  QLikeService <span class="hljs-comment">//点赞服务                                                                                                         </span>
<span></span>
<span></span></code></pre>
<h2 id="sdk接入"><a href="#sdk%E6%8E%A5%E5%85%A5" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>sdk接入</h2>
<p>1 下载sdk
<a href="https://github.com/qiniu/QNLiveKit_Android/tree/main/app-sdk">下载地址</a></p>
<p>2 参考dome工程的build.gradle文件 配置aar</p>
<pre><code><span class="hljs-comment">//七牛imsdk 必选  </span>
<span></span>implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">&#x27;:app-sdk:depends_sdk_qnim&#x27;</span>)</span>  
<span></span><span class="hljs-comment">//七牛rtc 主播推流必选  观众要连麦必选</span>
<span></span>implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">&#x27;:app-sdk:depends_sdk_qrtc&#x27;</span>)</span> 
<span></span><span class="hljs-comment">//七牛播放器  观众拉流端必选 </span>
<span></span>implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">&#x27;:app-sdk:depends_sdk_piliplayer&#x27;</span>)</span> 
<span></span><span class="hljs-comment">//低代码无ui sdk 必选</span>
<span></span>implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">&#x27;:app-sdk:qlive-sdk&#x27;</span>)</span> 
<span></span><span class="hljs-comment">//okhttp 3版本以上</span>
<span></span>implementation <span class="hljs-string">&#x27;com.squareup.okhttp3:okhttp:4.2.2&#x27;</span> 
<span></span><span class="hljs-comment">//json</span>
<span></span>implementation <span class="hljs-string">&#x27;com.google.code.gson:gson:2.8.9&#x27;</span> 
<span></span></code></pre>
<pre><code> <span class="hljs-comment">//UIkit包 不使用UI则不需要依赖</span>
<span></span>implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">&#x27;:app-sdk:qlive-sdk-uikit&#x27;</span>)</span> 
<span></span><span class="hljs-comment">//谷歌官方UI组件</span>
<span></span>implementation <span class="hljs-string">&#x27;androidx.lifecycle:lifecycle-runtime-ktx:2.3.0&#x27;</span>
<span></span>implementation <span class="hljs-string">&#x27;androidx.recyclerview:recyclerview:1.1.0&#x27;</span>
<span></span>implementation <span class="hljs-string">&#x27;androidx.cardview:cardview:1.0.0&#x27;</span>
<span></span><span class="hljs-comment">//图片加载</span>
<span></span>implementation <span class="hljs-string">&#x27;com.github.bumptech.glide:glide:4.11.0&#x27;</span> 
<span></span><span class="hljs-comment">//如果没有开启 viewbinding 选项 务必依赖这个库</span>
<span></span>implementation <span class="hljs-string">&quot;androidx.databinding:viewbinding:7.1.2&quot;</span>
<span></span></code></pre>
<blockquote>
<p>UIkit也可以直接使用源码模块-可直接修改代码</p>
<h4 id="implementation-projectqlive-uikit"><a href="#implementation-projectqlive-uikit" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>implementation project(':qlive-uikit')</h4>
</blockquote>
<p>3 混淆配置
如果你的项目需要混淆 <a href="https://github.com/qiniu/QNLiveKit_Android/blob/main/app/proguard-rules.pro">qlivesdk混淆配置参考</a></p>
<h2 id="uikit使用说明"><a href="#uikit%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>UIKIT使用说明</h2>
<h3 id="初始化"><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>初始化</h3>
<pre><code class="language-kotlin"><span class="hljs-comment">//初始化</span>
<span></span>QLive.<span class="hljs-keyword">init</span>(<span class="hljs-keyword">this</span>, QLiveConfig()) { callback -&gt;
<span></span>  <span class="hljs-comment">//业务方如何获取token  在token过期和登陆时候会回调该方法</span>
<span></span>  getLoginToken(callback)
<span></span>}
<span></span><span class="hljs-comment">//登陆 </span>
<span></span>QLive.auth(<span class="hljs-keyword">object</span> : QLiveCallBack&lt;<span class="hljs-built_in">Void</span>&gt; {
<span></span>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, msg: <span class="hljs-type">String</span>?)</span></span> {}
<span></span>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Void</span>)</span></span> {}
<span></span>})
<span></span><span class="hljs-comment">//可选 绑定用户资料 第一次绑定后没有跟新个人资料可不用每次都绑定</span>
<span></span><span class="hljs-comment">//也可以在服务端绑定用户 服务端也可以调用</span>
<span></span><span class="hljs-keyword">val</span> ext = HashMap&lt;String, String&gt;()
<span></span><span class="hljs-comment">// 可选参数，接入用户希望在直播间的在线用户列表/资料卡等UI中显示自定义字段如vip等级等等接入方的业务字段</span>
<span></span>ext.put(<span class="hljs-string">&quot;vip&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>)
<span></span>ext.put(<span class="hljs-string">&quot;xxx&quot;</span>, <span class="hljs-string">&quot;xxx&quot;</span>)
<span></span><span class="hljs-comment">//跟新/绑定 业务端的用户信息</span>
<span></span>QLive.setUser(QUserInfo(<span class="hljs-string">&quot;your avatar&quot;</span>, <span class="hljs-string">&quot;your nick&quot;</span>, ext), <span class="hljs-keyword">object</span> : QLiveCallBack&lt;<span class="hljs-built_in">Void</span>&gt; {
<span></span>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, msg: <span class="hljs-type">String</span>?)</span></span> {}
<span></span>  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Void</span>?)</span></span> {}
<span></span>})
<span></span><span class="hljs-keyword">val</span> liveUIKit = QLive.getLiveUIKit()
<span></span><span class="hljs-comment">//跳转到直播列表页面</span>
<span></span>liveUIKit.launch(context)
<span></span></code></pre>
<blockquote>
<p>登陆成功后才能使用sdk</p>
</blockquote>
<h3 id="主动跳转到直播间"><a href="#%E4%B8%BB%E5%8A%A8%E8%B7%B3%E8%BD%AC%E5%88%B0%E7%9B%B4%E6%92%AD%E9%97%B4" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>主动跳转到直播间</h3>
<pre><code class="language-kotlin"><span class="hljs-comment">//主动跳转观众直播间</span>
<span></span>QLive.getLiveUIKit().getPage(RoomPage::<span class="hljs-keyword">class</span>.java).startPlayerRoomActivity(...)
<span></span><span class="hljs-comment">//主播主动跳转已经存在主播直播间</span>
<span></span>QLive.getLiveUIKit().getPage(RoomPage::<span class="hljs-keyword">class</span>.java).startAnchorRoomActivity(...)
<span></span><span class="hljs-comment">//自定义开播跳转预览创建直播间页面</span>
<span></span>QLive.getLiveUIKit().getPage(RoomPage::<span class="hljs-keyword">class</span>.java).startAnchorRoomWithPreview(...)
<span></span></code></pre>
<h3 id="定制ui"><a href="#%E5%AE%9A%E5%88%B6ui" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>定制UI</h3>
<h4 id="修改现有的ui组件"><a href="#%E4%BF%AE%E6%94%B9%E7%8E%B0%E6%9C%89%E7%9A%84ui%E7%BB%84%E4%BB%B6" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>修改现有的UI组件</h4>
<p><img src="http://qrnlrydxa.hn-bkt.clouddn.com/qlive5.png" alt="alt "></img></p>
<p><strong>直接修改开源代码</strong>
uikit使用源码依赖，直接修改源码</p>
<blockquote>
<p>优点：快捷
缺点：官方更新UI逻辑代码后不方便同步</p>
</blockquote>
<p><strong>无侵入式自定义UI</strong>
uikit使用sdk依赖</p>
<p>拷贝布局文件--只需拷贝需要修改的页面，拷贝至接入的工程并且重新命名</p>
<ul>
<li>kit_activity_room_player.xml //<a href="https://github.com/qiniu/QNLiveKit_Android/blob/main/liveroom-uikit/src/main/res/layout/kit_activity_room_player.xml">观众直播间布局 </a></li>
<li>kit_activity_room_pusher.xm  //<a href="https://github.com/qiniu/QNLiveKit_Android/blob/main/liveroom-uikit/src/main/res/layout/kit_activity_room_pusher.xml">主播直播间布局</a></li>
<li>kit_activity_room_list.xml   //<a href="https://github.com/qiniu/QNLiveKit_Android/blob/main/liveroom-uikit/src/main/res/layout/kit_activity_room_list.xml">房间列表页布局</a></li>
</ul>
<p>clear重新编译编译-->androidStudio预览看到如上效果图</p>
<ul>
<li>1修改拷贝文件的布局任意属性，比如边距，文本颜色，样式等等</li>
<li>2调用替换布局文件</li>
</ul>
<pre><code class="language-kotlin"><span class="hljs-keyword">val</span> roomPage = QLive.getLiveUIKit().getPage(RoomPage::<span class="hljs-keyword">class</span>.java)
<span></span><span class="hljs-comment">//自定义房间页面观众房间的布局</span>
<span></span>roomPage.playerCustomLayoutID = R.layout.customXXXlayout
<span></span><span class="hljs-comment">//自定义房间页面主播房间的布局</span>
<span></span>roomPage.anchorCustomLayoutID = R.layout.customXXlayout
<span></span>
<span></span><span class="hljs-keyword">val</span> roomListPage = QLive.getLiveUIKit().getPage(RoomListPage::<span class="hljs-keyword">class</span>.java)
<span></span><span class="hljs-comment">//自定义房间列表页面布局</span>
<span></span>roomListPage.customLayoutID = R.layout.customXlayout
<span></span></code></pre>
<p>修改拷贝的布局文件或者源布局文件</p>
<p>案列：</p>
<pre><code class="language-xml"><span class="hljs-comment">&lt;!--   找到房间背景图--&gt;</span>
<span></span><span class="hljs-tag">&lt;<span class="hljs-name">com.qlive.uikitcore.QKitImageView</span>
<span></span>    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span>
<span></span>    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span>
<span></span>
<span></span>    <span class="hljs-attr">android:src</span>=<span class="hljs-string">&quot;@drawable/kit_dafault_room_bg&quot;</span> /&gt;</span>
<span></span>
<span></span>    <span class="hljs-comment">&lt;!--替换--&gt;</span>
<span></span><span class="hljs-tag">&lt;<span class="hljs-name">com.qlive.uikitcore.QKitImageView</span>
<span></span>    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span>
<span></span>    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span>
<span></span>
<span></span>    <span class="hljs-attr">android:src</span>=<span class="hljs-string">&quot;@drawable/my_room_bg&quot;</span> /&gt;</span>
<span></span></code></pre>
<blockquote>
<p>tip: 所有的安卓自带基础UI都可以修改属性 如边距,父容器排列，文本颜色等等</p>
</blockquote>
<p>如果要替换UI里面的逻辑代码
创建自定义UI组件 继承QLiveComponent
案列：</p>
<pre><code class="language-kotlin"><span class="hljs-comment">//自定义一个公告UI组件--参考原来的公告实现</span>
<span></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomNoticeView</span> :<span class="hljs-type">FrameLayout</span>, <span class="hljs-type">com.qlive.uikit.QLiveComponent</span> {
<span></span>    <span class="hljs-keyword">constructor</span>(context: Context) : <span class="hljs-keyword">this</span>(context, <span class="hljs-literal">null</span>)
<span></span>    <span class="hljs-keyword">constructor</span>(context: Context, attrs: AttributeSet?) : <span class="hljs-keyword">this</span>(context, attrs, <span class="hljs-number">0</span>)
<span></span>    <span class="hljs-keyword">constructor</span>(context: Context, attrs: AttributeSet?, defStyleAttr: <span class="hljs-built_in">Int</span>) : <span class="hljs-keyword">super</span>(
<span></span>        context,
<span></span>        attrs,
<span></span>        defStyleAttr
<span></span>    ){
<span></span>        <span class="hljs-comment">//自己的公告布局</span>
<span></span>        LayoutInflater.from(context).inflate(R.layout.customnoticeview,<span class="hljs-keyword">this</span>,<span class="hljs-literal">true</span>)
<span></span>    }
<span></span>
<span></span>    <span class="hljs-comment">//绑定UI组件上下文 context中包涵UI实现安卓平台功能的字段如activity fragmentManager</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">attachKitContext</span><span class="hljs-params">(context: <span class="hljs-type">com</span>.<span class="hljs-type">qlive</span>.<span class="hljs-type">uikit</span>.<span class="hljs-type">QLiveUIKitContext</span>)</span></span> {}
<span></span>    <span class="hljs-comment">//绑定房间客户端 通过client可以获取业务实现</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">attachLiveClient</span><span class="hljs-params">(client: <span class="hljs-type">QLiveClient</span>)</span></span> {}
<span></span>    <span class="hljs-comment">//进入回调 在这个阶段可以提前根据liveId提前初始化一些UI</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onEntering</span><span class="hljs-params">(liveID: <span class="hljs-type">String</span>, user: <span class="hljs-type">QLiveUser</span>)</span></span> { }
<span></span>
<span></span>    <span class="hljs-comment">//加入回调 房间加入成功阶段 已经拿到了QLiveRoomInfo</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onJoined</span><span class="hljs-params">(roomInfo: <span class="hljs-type">QLiveRoomInfo</span>, isResumeFromFloating: <span class="hljs-type">Boolean</span>)</span></span> {
<span></span>        <span class="hljs-comment">//设置房间公告文本 公告文本roomInfo中字段取出</span>
<span></span>        tvNotice.setText(<span class="hljs-string">&quot;房间公告：&quot;</span>+roomInfo.notice)
<span></span>    }
<span></span>    <span class="hljs-comment">//离开回调</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLeft</span><span class="hljs-params">()</span></span> {
<span></span>        <span class="hljs-comment">//房间切换/离开 清空UI</span>
<span></span>        tvNotice.setText(<span class="hljs-string">&quot;&quot;</span>)
<span></span>    }
<span></span>    <span class="hljs-comment">// 销毁</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroyed</span><span class="hljs-params">()</span></span> { }
<span></span>    <span class="hljs-comment">//安卓activity生命周期 安卓页面 onresume onpause等等</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStateChanged</span><span class="hljs-params">(source: <span class="hljs-type">LifecycleOwner</span>, event: <span class="hljs-type">Lifecycle</span>.<span class="hljs-type">Event</span>)</span></span> {}
<span></span>}
<span></span><span class="hljs-comment">//自定义UI可以参考原来的实现修改成自定义实现</span>
<span></span><span class="hljs-comment">//提示：所有的UI组件不需要在activity绑定操作 只需要继承QLiveComponent就能完成所有工作</span>
<span></span></code></pre>
<p>然后在拷贝布局文件里或者源码布局里替换原来内置的UI组件</p>
<pre><code class="language-xml">    <span class="hljs-comment">&lt;!--   原来的UI组件--&gt;</span>
<span></span><span class="hljs-tag">&lt;<span class="hljs-name">com.qlive.uikitpublicchat.RoomNoticeView</span>
<span></span>    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;238dp&quot;</span>
<span></span>    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span>
<span></span>    <span class="hljs-attr">android:layout_marginStart</span>=<span class="hljs-string">&quot;8dp&quot;</span>
<span></span>    <span class="hljs-attr">android:layout_marginBottom</span>=<span class="hljs-string">&quot;2dp&quot;</span>
<span></span>    <span class="hljs-attr">android:background</span>=<span class="hljs-string">&quot;@drawable/kit_shape_40000000_6&quot;</span>
<span></span>    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;vertical&quot;</span>
<span></span>    <span class="hljs-attr">android:paddingStart</span>=<span class="hljs-string">&quot;8dp&quot;</span>
<span></span>    <span class="hljs-attr">android:paddingTop</span>=<span class="hljs-string">&quot;16dp&quot;</span>
<span></span>    <span class="hljs-attr">android:paddingEnd</span>=<span class="hljs-string">&quot;8dp&quot;</span>
<span></span>    <span class="hljs-attr">android:paddingBottom</span>=<span class="hljs-string">&quot;16dp&quot;</span>
<span></span>    <span class="hljs-attr">android:textColor</span>=<span class="hljs-string">&quot;#ffffff&quot;</span>
<span></span>    <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">&quot;13sp&quot;</span>
<span></span>    <span class="hljs-attr">tools:text</span>=<span class="hljs-string">&quot;官方公告&quot;</span> /&gt;</span>
<span></span>
<span></span>    <span class="hljs-comment">&lt;!--   改成你自己的--&gt;</span>
<span></span><span class="hljs-tag">&lt;<span class="hljs-name">CustomNoticeView</span>
<span></span>    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;238dp&quot;</span>
<span></span>    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span>/&gt;</span>
<span></span></code></pre>
<blockquote>
<p>提示不需要修改activity</p>
</blockquote>
<h4 id="删除内置ui组件"><a href="#%E5%88%A0%E9%99%A4%E5%86%85%E7%BD%AEui%E7%BB%84%E4%BB%B6" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>删除内置UI组件</h4>
<p>直接在拷贝的布局文件或者源码布局里里删除</p>
<p>案列：去掉pk功能
在xml里直接删除开始pk按钮</p>
<pre><code class="language-xml">   <span class="hljs-comment">&lt;!--    去掉开始pk按钮--&gt;</span>
<span></span><span class="hljs-tag">&lt;<span class="hljs-name">com.qlive.uikitpk.StartPKView</span>
<span></span>    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span>
<span></span>    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span> /&gt;</span>
<span></span>
<span></span>    <span class="hljs-comment">&lt;!--    去掉pk预览--&gt;</span>
<span></span><span class="hljs-tag">&lt;<span class="hljs-name">com.qlive.uikitpk.PKAnchorPreview</span>
<span></span>    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span>
<span></span>    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span> /&gt;</span>
<span></span></code></pre>
<blockquote>
<p>UI插件的增删改不需要修改activity</p>
</blockquote>
<h4 id="添加ui组件"><a href="#%E6%B7%BB%E5%8A%A0ui%E7%BB%84%E4%BB%B6" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>添加UI组件</h4>
<pre><code class="language-kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomView</span> :<span class="hljs-type">FrameLayout</span>, <span class="hljs-type">com.qlive.uikit.QLiveComponent</span> {
<span></span>    <span class="hljs-comment">//  实现自己额外的多个UI布局</span>
<span></span>}
<span></span><span class="hljs-comment">//在拷贝的布局文件里或者源码布局里你想要的位置添加即可</span>
<span></span>
<span></span></code></pre>
<h4 id="自定义房间列表页面"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%88%BF%E9%97%B4%E5%88%97%E8%A1%A8%E9%A1%B5%E9%9D%A2" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>自定义房间列表页面</h4>
<p>如果需要将房间列表页面添加到你想要的页面比如app首页的viewpager切换，否则直接替换修改内在roomList布局就可以了</p>
<p>方式1 使用RoomListView</p>
<p>在想要添加的布局xml里面添加RoomListView</p>
<pre><code class="language-xml"><span class="hljs-comment">&lt;!--  empty_placeholder_tips   没有数据的占位提示--&gt;</span>
<span></span><span class="hljs-comment">&lt;!--  empty_placeholder_no_net_icon     没有网络的占位图片--&gt;</span>
<span></span><span class="hljs-comment">&lt;!--  empty_placeholder_icon    没有数据的占位图片--&gt;</span>
<span></span><span class="hljs-tag">&lt;<span class="hljs-name">com.qlive.uikit.component.RoomListView</span>
<span></span>    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span>
<span></span>    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span>
<span></span>    <span class="hljs-attr">app:empty_placeholder_icon</span>=<span class="hljs-string">&quot;@drawable/kit_pic_empty&quot;</span>
<span></span>    <span class="hljs-attr">app:empty_placeholder_no_net_icon</span>=<span class="hljs-string">&quot;@drawable/kit_pic_empty_network&quot;</span>
<span></span>    <span class="hljs-attr">app:empty_placeholder_tips</span>=<span class="hljs-string">&quot;空空如也&quot;</span> /&gt;</span>
<span></span>
<span></span></code></pre>
<p>在你的activivity代码里配置样式</p>
<pre><code class="language-kotlin"><span class="hljs-comment">//可选 替换列表item适配</span>
<span></span>roomListView.setRoomAdapter(CustomAdapter())
<span></span><span class="hljs-comment">//必选 启动 </span>
<span></span>roomListView.attachKitContext(QUIKitContext(<span class="hljs-keyword">this</span>,supportFragmentManager,<span class="hljs-keyword">this</span>,<span class="hljs-keyword">this</span>))
<span></span></code></pre>
<p>方式2 使用 qlive数据api</p>
<pre><code class="language-kotlin"><span class="hljs-comment">//使用 qlive数据api 获取房间等数据自定义UI</span>
<span></span>QLive.getRooms().listRoom(..）
<span></span>QLive.getRooms().createRoom(..）
<span></span></code></pre>
<p>方式3 修改UIkit源码</p>
<h3 id="ui插件通信事件"><a href="#ui%E6%8F%92%E4%BB%B6%E9%80%9A%E4%BF%A1%E4%BA%8B%E4%BB%B6" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>UI插件通信事件</h3>
<p>如选择不修改源码的形式接入uikit，如何在不同模块间UI插件实现通信</p>
<pre><code class="language-kotlin"><span class="hljs-comment">//定义一个UI事件 继承UIEvent</span>
<span></span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestUIEvent</span> <span class="hljs-title">extends</span> <span class="hljs-title">UIEvent</span>{
<span></span>    <span class="hljs-comment">//自定义多个字段</span>
<span></span>    <span class="hljs-keyword">public</span> int testInt = <span class="hljs-number">2</span>;
<span></span>}
<span></span></code></pre>
<p>在某个UI组件里注册事件</p>
<pre><code><span class="hljs-comment">//注册TestUIEvent</span>
<span></span><span class="hljs-title function_">registerEventAction</span>(<span class="hljs-params">TestUIEvent::<span class="hljs-keyword">class</span>.java</span>) { 
<span></span>    <span class="hljs-comment">//事件数据</span>
<span></span>    <span class="hljs-attr">event</span>:<span class="hljs-title class_">TestUIEvent</span> -&gt;
<span></span>    <span class="hljs-comment">//收到测试事件1的回调</span>
<span></span>    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">d</span>(<span class="hljs-string">&quot;UIEvent&quot;</span>,event.<span class="hljs-title function_">getAction</span>()+<span class="hljs-string">&quot; &quot;</span>+event.<span class="hljs-property">testInt</span>)
<span></span>    }
<span></span> <span class="hljs-comment">//注册其他更多UIEvent       </span>
<span></span><span class="hljs-title function_">registerEventAction</span>(<span class="hljs-params">xxxUIEvent::<span class="hljs-keyword">class</span>.java</span>) {<span class="hljs-attr">event</span>:xxxUIEvent -&gt;
<span></span>   <span class="hljs-comment">//收到测试事件xxx的回调</span>
<span></span>   <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">d</span>(<span class="hljs-string">&quot;UIEvent&quot;</span>,event.<span class="hljs-title function_">getAction</span>())
<span></span>  }
<span></span></code></pre>
<p>在另外一个UI组件里发送事件</p>
<pre><code><span class="hljs-string">sendUIEvent(TestUIEvent().apply</span> {<span class="hljs-string">testInt</span> <span class="hljs-string">=</span> <span class="hljs-number">1000</span><span class="hljs-string">;</span>}<span class="hljs-string">)</span>
<span></span></code></pre>
<h3 id="使用美颜插件可选"><a href="#%E4%BD%BF%E7%94%A8%E7%BE%8E%E9%A2%9C%E6%8F%92%E4%BB%B6%E5%8F%AF%E9%80%89" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>使用美颜插件（可选）</h3>
<pre><code>拷贝源码模块uikit-beauty并且添加依赖
<span></span>implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">&quot;:qlive-uicomponnets:uikit-beauty&quot;</span>)</span>
<span></span></code></pre>
<ul>
<li>(必选) 联系七牛商务获取美颜认证lic文件 重命名SenseME.lic放在assets文件下->运行sdk已经带了美颜滤镜贴纸功能</li>
<li>(可选 -自定义调节UI面板) 修改美颜调节面板UI及拷贝购买的额外的素材文件/或删除原有用不着的素材至uikit-beauty/assets</li>
<li>(可选 -自定义显示美颜弹窗按钮)uikit中调用   kitContext?.getLiveFuncComponent(FuncCPTBeautyDialogShower::class.java)?.showBeautyEffectDialog() 即可显示美颜特效弹窗</li>
<li>(可选 -自定义显示贴纸弹窗按钮)uikit中调用  kitContext?.getLiveFuncComponent(FuncCPTBeautyDialogShower::class.java)
?.showBeautyStickDialog()  即可显示美颜贴纸弹窗</li>
</ul>
<h4 id="外接其他美颜"><a href="#%E5%A4%96%E6%8E%A5%E5%85%B6%E4%BB%96%E7%BE%8E%E9%A2%9C" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>外接其他美颜</h4>
<pre><code class="language-kotlin">client.setVideoFrameListener(<span class="hljs-keyword">object</span>:QVideoFrameListener{
<span></span>    <span class="hljs-comment">//拿到帧回调即可以使用其他美颜sdk处理</span>
<span></span>})
<span></span></code></pre>
<h3 id="小窗播放"><a href="#%E5%B0%8F%E7%AA%97%E6%92%AD%E6%94%BE" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>小窗播放</h3>
<p>配置权限</p>
<pre><code class="language-xml"><span class="hljs-comment">&lt;!-- 系统悬浮窗权限 --&gt;</span>
<span></span><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;</span> /&gt;</span>
<span></span><span class="hljs-comment">&lt;!-- 从桌面返回 --&gt;</span>
<span></span><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.REORDER_TASKS&quot;</span> /&gt;</span>
<span></span></code></pre>
<p>在UIkit中 启动小窗播放</p>
<pre><code class="language-kotlin"> <span class="hljs-comment">//FloatingModel.GO_DESKTOP (开始悬浮并返回桌面)</span>
<span></span> <span class="hljs-comment">//FloatingModel.BACK_LAST_PAGE (开始悬浮返回上一个页面 -- 当前activity会销毁-可再次进入或进入新的直播间)</span>
<span></span> <span class="hljs-comment">//FloatingModel.GO_NEXT_PAGE (开始悬浮去下一页面)</span>
<span></span> kitContext.getLiveFuncComponent(FuncCPTPlayerFloatingHandler::<span class="hljs-keyword">class</span>.java)?.create(FloatingModel) { succeed: <span class="hljs-built_in">Boolean</span>, msg: String -&gt;
<span></span>     <span class="hljs-comment">//小窗后要跳转的页面</span>
<span></span>}
<span></span></code></pre>
<p>小窗组件功能概览 如需自定义参考配置</p>
<pre><code class="language-kotlin"><span class="hljs-comment">//内置悬浮窗播放功能组件 </span>
<span></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">FuncCPTPlayerFloatingHandler</span>{
<span></span>       <span class="hljs-comment">//静态配置</span>
<span></span>      <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
<span></span>        <span class="hljs-comment">//当前正在展示的悬浮窗  </span>
<span></span>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">currentFloatingPlayerView</span><span class="hljs-params">()</span></span>: FloatingPlayerView? 
<span></span>        <span class="hljs-comment">/**
<span></span>         * 自定义权限申请提示
<span></span>          默认权限申请时候提示用户开始权限，，自定义可以替换
<span></span>         * Permission request tip call
<span></span>         * <span class="hljs-doctag">@param</span> afterTipCall 自定义权限申请提示
<span></span>         * afterTipCall.invoke(true) == 已经提示完成可以去申请
<span></span>         * afterTipCall.invoke(false) == 不去申请，取消操作
<span></span>         */</span>
<span></span>        <span class="hljs-keyword">var</span> permissionRequestTipCall: (kitConText: com.qlive.uikit.QLiveUIKitContext, afterTipCall: (<span class="hljs-built_in">Boolean</span>) -&gt; <span class="hljs-built_in">Unit</span>) -&gt; <span class="hljs-built_in">Unit</span> ={}
<span></span>     }
<span></span>  <span class="hljs-comment">/**
<span></span>   * 开始悬浮播放
<span></span>   * <span class="hljs-doctag">@param</span> floatingModel 悬浮窗模式 
<span></span>   * <span class="hljs-doctag">@param</span> view 自定义小窗UI 默认DefaultFloatingPlayerView
<span></span>   * <span class="hljs-doctag">@param</span> config  小窗的位置等配置参数
<span></span>   * <span class="hljs-doctag">@param</span> createCall 成功失败回调
<span></span>   */</span>
<span></span>  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(
<span></span>    floatingModel: <span class="hljs-type">FloatingModel</span>,
<span></span>    view: <span class="hljs-type">FloatingPlayerView</span> = DefaultFloatingPlayerView()</span></span>,
<span></span>    config: FloatConfig = createDefaultFloatConfig(kitContext!!.androidContext),
<span></span>    createCall: (<span class="hljs-built_in">Boolean</span>, String) -&gt; <span class="hljs-built_in">Unit</span>
<span></span>  ){}
<span></span>}
<span></span></code></pre>
<h3 id="跳转直播间携带本地参数"><a href="#%E8%B7%B3%E8%BD%AC%E7%9B%B4%E6%92%AD%E9%97%B4%E6%90%BA%E5%B8%A6%E6%9C%AC%E5%9C%B0%E5%8F%82%E6%95%B0" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>跳转直播间携带本地参数</h3>
<p>如果需要跳转直播携带一些本地的参数。
调用带StartRoomActivityExtSetter参数的启动直播间方法</p>
<pre><code class="language-kotlin">QLive.getLiveUIKit()
<span></span>        .getPage(RoomPage::<span class="hljs-keyword">class</span>.java)
<span></span>        .startXXXXRoomActivity(<span class="hljs-keyword">this</span>,
<span></span>        <span class="hljs-string">&quot;id&quot;</span>,
<span></span>       <span class="hljs-comment">//自定义本地参数</span>
<span></span>        <span class="hljs-keyword">object</span> : StartRoomActivityExtSetter {
<span></span>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setExtParams</span><span class="hljs-params">(startIntent: <span class="hljs-type">Intent</span>)</span></span> {
<span></span>                <span class="hljs-comment">//安卓平台Intent的存放参数</span>
<span></span>                startIntent.putExtra(<span class="hljs-string">&quot;xxx&quot;</span>, <span class="hljs-string">&quot;xxx&quot;</span>)
<span></span>            }
<span></span>        }, <span class="hljs-literal">null</span>
<span></span>    )
<span></span>
<span></span></code></pre>
<p>在直播间任意UI插件中通过上下文获取</p>
<pre><code class="language-kotlin"> <span class="hljs-keyword">val</span> xxx = kitContext.currentActivity.intent.getStringExtra(<span class="hljs-string">&quot;xxx&quot;</span>)
<span></span></code></pre>
<h3 id="定制内置ui组件点击事件和样式"><a href="#%E5%AE%9A%E5%88%B6%E5%86%85%E7%BD%AEui%E7%BB%84%E4%BB%B6%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6%E5%92%8C%E6%A0%B7%E5%BC%8F" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>定制内置UI组件点击事件和样式</h3>
<p>每个内置的UI组件都有静态的样式配置和事件回调
如设置直播间在线用户的样式</p>
<pre><code><span class="hljs-comment">//设置点击事件</span>
<span></span>OnlineUserView.onItemUserClickListener={
<span></span>   kitContext, <span class="hljs-comment">//上下文</span>
<span></span>   client, <span class="hljs-comment">//客户端</span>
<span></span>   view, <span class="hljs-comment">//点击的UI</span>
<span></span>   user <span class="hljs-comment">//点击的用户</span>
<span></span>   <span class="hljs-punctuation">-&gt;</span>
<span></span>   <span class="hljs-comment">// todo 跳转用户主页等操作</span>
<span></span>}
<span></span><span class="hljs-comment">//设置item样式</span>
<span></span>OnlineUserView.adapterProvider={
<span></span>   kitContext, <span class="hljs-comment">//上下文</span>
<span></span>   client, <span class="hljs-comment">//客户端</span>
<span></span>   <span class="hljs-punctuation">-&gt;</span>
<span></span>    <span class="hljs-title function_ invoke__">CustomOnlineUserViewAdapter</span>() <span class="hljs-comment">//返回自定义列表适配</span>
<span></span>}
<span></span></code></pre>
<h2 id="无ui-标准集成"><a href="#%E6%97%A0ui-%E6%A0%87%E5%87%86%E9%9B%86%E6%88%90" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>无UI-标准集成</h2>
<pre><code class="language-kotlin"><span class="hljs-comment">//初始化</span>
<span></span>QLive.<span class="hljs-keyword">init</span>(<span class="hljs-keyword">this</span>, QLiveConfig()) {
<span></span>    callback -&gt;
<span></span>    <span class="hljs-comment">//业务方如何获取token  在token过期和登陆时候会回调该方法</span>
<span></span>    getLoginToken(callback)
<span></span>}
<span></span><span class="hljs-comment">//登陆 </span>
<span></span>QLive.auth(<span class="hljs-keyword">object</span> : QLiveCallBack&lt;<span class="hljs-built_in">Void</span>&gt; {
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, msg: <span class="hljs-type">String</span>?)</span></span> {}
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Void</span>)</span></span> {}
<span></span>})
<span></span><span class="hljs-comment">//可选 绑定用户资料 第一次绑定后没有跟新个人资料可不用每次都绑定</span>
<span></span><span class="hljs-comment">//也可以在服务端绑定用户 服务端也可以调用</span>
<span></span><span class="hljs-keyword">val</span> ext = HashMap&lt;String, String&gt;()
<span></span><span class="hljs-comment">// 可选参数，接入用户希望在直播间的在线用户列表/资料卡等UI中显示自定义字段如vip等级等等接入方的业务字段</span>
<span></span>ext.put(<span class="hljs-string">&quot;vip&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>)
<span></span>ext.put(<span class="hljs-string">&quot;xxx&quot;</span>, <span class="hljs-string">&quot;xxx&quot;</span>)
<span></span><span class="hljs-comment">//跟新/绑定 业务端的用户信息</span>
<span></span>QLive.setUser(QUserInfo(<span class="hljs-string">&quot;your avatar&quot;</span>, <span class="hljs-string">&quot;your nick&quot;</span>, ext), <span class="hljs-keyword">object</span> : QLiveCallBack&lt;<span class="hljs-built_in">Void</span>&gt; {
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, msg: <span class="hljs-type">String</span>?)</span></span> {}
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Void</span>?)</span></span> {}
<span></span>})
<span></span>
<span></span><span class="hljs-comment">//创建房间</span>
<span></span><span class="hljs-keyword">val</span> param =  QCreateRoomParam()
<span></span>param.setTitle(<span class="hljs-string">&quot;xxxtitle&quot;</span>);
<span></span>QLive.getRooms().createRoom(param, <span class="hljs-keyword">object</span> : QLiveCallBack&lt;QLiveRoomInfo&gt; {
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, msg: <span class="hljs-type">String</span>)</span></span> {
<span></span>    }
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">QLiveRoomInfo</span>)</span></span> {
<span></span>    }
<span></span>})
<span></span>
<span></span><span class="hljs-comment">// 主播推流</span>
<span></span><span class="hljs-comment">//创建推流client</span>
<span></span><span class="hljs-keyword">val</span> client = QLive.createPusherClient()
<span></span><span class="hljs-keyword">val</span> microphoneParams =  QMicrophoneParam()
<span></span>microphoneParam.setSampleRate(<span class="hljs-number">48000</span>)
<span></span><span class="hljs-comment">//启动麦克风模块</span>
<span></span>client.enableMicrophone(microphoneParam)
<span></span><span class="hljs-keyword">val</span> cameraParam =  QCameraParam()
<span></span>cameraParam.setFPS(<span class="hljs-number">15</span>)
<span></span><span class="hljs-comment">//启动摄像头模块</span>
<span></span>client.enableCamera(cameraParam,findViewById(R.id.renderView))
<span></span><span class="hljs-comment">//注册房间端监听</span>
<span></span>client.setLiveStatusListener(<span class="hljs-keyword">object</span> : QLiveStatusListener{})
<span></span><span class="hljs-comment">//加入房间</span>
<span></span>client.joinRoom(roomId, <span class="hljs-keyword">object</span> : QLiveCallBack&lt;QLiveRoomInfo&gt; {
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, msg: <span class="hljs-type">String</span>?)</span></span> {
<span></span>    }
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">QLiveRoomInfo</span>)</span></span> {
<span></span>    }
<span></span>})
<span></span><span class="hljs-comment">//关闭</span>
<span></span>client.closeRoom(<span class="hljs-keyword">object</span> : QLiveCallBack&lt;<span class="hljs-built_in">Void</span>&gt; {
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, msg: <span class="hljs-type">String</span>?)</span></span> {
<span></span>    }
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Void</span>?)</span></span> {
<span></span>    }
<span></span>})
<span></span><span class="hljs-comment">//销毁</span>
<span></span>client.destroy()
<span></span>
<span></span>
<span></span>
<span></span><span class="hljs-comment">//用户拉流房间</span>
<span></span><span class="hljs-keyword">val</span> client = QLive.createPlayerClient()
<span></span><span class="hljs-comment">//注册房间端监听</span>
<span></span>client.setLiveStatusListener(<span class="hljs-keyword">object</span> : QLiveStatusListener{})
<span></span><span class="hljs-comment">//加入房间</span>
<span></span>client.joinRoom(roomId, <span class="hljs-keyword">object</span> :
<span></span>    QLiveCallBack&lt;QLiveRoomInfo&gt; {
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, msg: <span class="hljs-type">String</span>?)</span></span> {
<span></span>    }
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">QLiveRoomInfo</span>)</span></span> {
<span></span>    }
<span></span>})
<span></span><span class="hljs-comment">//播放</span>
<span></span>client.play(findViewById(R.id.renderView));
<span></span><span class="hljs-comment">//离开</span>
<span></span>client.leaveRoom(<span class="hljs-keyword">object</span> : QLiveCallBack&lt;<span class="hljs-built_in">Void</span>&gt; {
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, msg: <span class="hljs-type">String</span>?)</span></span> {
<span></span>    }
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Void</span>?)</span></span> {
<span></span>    }
<span></span>})
<span></span><span class="hljs-comment">//销毁</span>
<span></span>client.destroy()
<span></span>
<span></span></code></pre>
<h3 id="使用插件服务"><a href="#%E4%BD%BF%E7%94%A8%E6%8F%92%E4%BB%B6%E6%9C%8D%E5%8A%A1" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>使用插件服务</h3>
<pre><code class="language-kotlin">client.getService(QxxxService::<span class="hljs-keyword">class</span>.java) <span class="hljs-comment">//获取某个业务插件服务</span>
<span></span><span class="hljs-comment">//案列</span>
<span></span>client.getService(QPKService::<span class="hljs-keyword">class</span>.java)?.start(<span class="hljs-number">20</span> * <span class="hljs-number">1000</span>, receiverRoomID, receiver.userId, <span class="hljs-literal">null</span>,<span class="hljs-keyword">object</span> : QLiveCallBack&lt;QPKSession&gt; {})
<span></span></code></pre>
<h3 id="无uisdk实现连麦"><a href="#%E6%97%A0uisdk%E5%AE%9E%E7%8E%B0%E8%BF%9E%E9%BA%A6" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>无UISDK实现连麦</h3>
<p><a href="https://github.com/qiniu/QNLiveKit_Android/blob/main/qlive-uicomponnets/uikit-linkmic/src/main/java/com/qlive/uikitlinkmic/MicLinkersView.kt">多人连麦demo</a></p>
<p><a href="https://github.com/qiniu/QNLiveKit_Android/blob/main/qlive-uicomponnets/uikit-linkmic/src/main/java/com/qlive/uikitlinkmic/MicLinkerSplitScreenPreview.java">分屏连麦demo</a></p>
<pre><code class="language-kotlin"><span class="hljs-keyword">package</span> com.qlive.qnlivekit
<span></span>
<span></span>
<span></span><span class="hljs-comment">//邀请监听</span>
<span></span><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mInvitationListener = <span class="hljs-keyword">object</span> : QInvitationHandlerListener {
<span></span>    <span class="hljs-comment">//收到邀请</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onReceivedApply</span><span class="hljs-params">(qInvitation: <span class="hljs-type">QInvitation</span>)</span></span> {
<span></span>        <span class="hljs-comment">//todo 显示申请弹窗  qInvitation.getInitiator()获取到申请方资料 显示UI </span>
<span></span>        <span class="hljs-comment">// 点击按钮  拒绝操作</span>
<span></span>        client!!.getService(QLinkMicService::<span class="hljs-keyword">class</span>.java).invitationHandler.reject(qInvitation.invitationID, <span class="hljs-literal">null</span>, callBack)
<span></span>        <span class="hljs-comment">//点击按钮 接受操作 </span>
<span></span>        client!!.getService(QLinkMicService::<span class="hljs-keyword">class</span>.java).invitationHandler.accept(qInvitation.invitationID, <span class="hljs-literal">null</span>, callBack)
<span></span>    }
<span></span>
<span></span>    <span class="hljs-comment">//收到对方取消    </span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onApplyCanceled</span><span class="hljs-params">(qInvitation: <span class="hljs-type">QInvitation</span>)</span></span> {}
<span></span>
<span></span>    <span class="hljs-comment">//发起超时对方没响应</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onApplyTimeOut</span><span class="hljs-params">(qInvitation: <span class="hljs-type">QInvitation</span>)</span></span> {}
<span></span>
<span></span>    <span class="hljs-comment">//对方接受</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onAccept</span><span class="hljs-params">(qInvitation: <span class="hljs-type">QInvitation</span>)</span></span> {
<span></span>        <span class="hljs-comment">//对方接受后调用开始上麦 传摄像头麦克参数 自动开启相应的媒体流</span>
<span></span>        client?.getService(QLinkMicService::<span class="hljs-keyword">class</span>.java)?.audienceMicHandler?.startLink(<span class="hljs-literal">null</span>, QCameraParam(), QMicrophoneParam(), callback)
<span></span>    }
<span></span>
<span></span>    <span class="hljs-comment">//对方拒绝</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onReject</span><span class="hljs-params">(qInvitation: <span class="hljs-type">QInvitation</span>)</span></span> {}
<span></span>}
<span></span>
<span></span><span class="hljs-comment">//麦位麦位监听</span>
<span></span><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mQLinkMicServiceListener = <span class="hljs-keyword">object</span> : QLinkMicServiceListener {
<span></span>    <span class="hljs-comment">//有人上麦了</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLinkerJoin</span><span class="hljs-params">(micLinker: <span class="hljs-type">QMicLinker</span>)</span></span> {
<span></span>
<span></span>        <span class="hljs-comment">//麦上用户和主播设置这个用户预览 直播拉流用户无需设置</span>
<span></span>        <span class="hljs-keyword">val</span> preview = QPushTextureView(context)
<span></span>        <span class="hljs-comment">//添加到你要添加到的容器</span>
<span></span>        containerView.addView(preview)
<span></span>        <span class="hljs-comment">//设置该用户的预览</span>
<span></span>        linkService.setUserPreview(micLinker.user.userId, preview)
<span></span>
<span></span>        <span class="hljs-comment">//跟新连麦UI 如果要显示头像 micLinker里取到上麦者资料</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-comment">//有人下麦了</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLinkerLeft</span><span class="hljs-params">(micLinker: <span class="hljs-type">QMicLinker</span>)</span></span> {
<span></span>        <span class="hljs-comment">//移除已经设置的预览窗口</span>
<span></span>        container.removeUserPreView(xxxx)
<span></span>        <span class="hljs-comment">//跟新连麦UI 比如去掉麦上头像</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLinkerMicrophoneStatusChange</span><span class="hljs-params">(micLinker: <span class="hljs-type">QMicLinker</span>)</span></span> {
<span></span>        <span class="hljs-comment">//跟新连麦UI </span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLinkerCameraStatusChange</span><span class="hljs-params">(micLinker: <span class="hljs-type">QMicLinker</span>)</span></span> {
<span></span>        <span class="hljs-comment">//跟新连麦UI</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-comment">//某个用户被踢麦</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLinkerKicked</span><span class="hljs-params">(micLinker: <span class="hljs-type">QMicLinker</span>, msg: <span class="hljs-type">String</span>)</span></span> {}
<span></span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLinkerExtensionUpdate</span><span class="hljs-params">(micLinker: <span class="hljs-type">QMicLinker</span>, extension: <span class="hljs-type">QExtension</span>)</span></span> {}
<span></span>}
<span></span>
<span></span><span class="hljs-comment">//混流适配 房主负责混流</span>
<span></span><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mQMixStreamAdapter =
<span></span>    <span class="hljs-keyword">object</span> : QLinkMicMixStreamAdapter {
<span></span>        <span class="hljs-comment">/**
<span></span>         * 连麦开始如果要自定义混流画布和背景
<span></span>         * 返回空则主播推流分辨率有多大就多大默认实现
<span></span>         * <span class="hljs-doctag">@return</span>
<span></span>         */</span>
<span></span>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onMixStreamStart</span><span class="hljs-params">()</span></span>: QMixStreamParams? {
<span></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
<span></span>        }
<span></span>
<span></span>        <span class="hljs-comment">/**
<span></span>         * 混流布局适配
<span></span>         */</span>
<span></span>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResetMixParam</span><span class="hljs-params">(
<span></span>            micLinkers: <span class="hljs-type">MutableList</span>&lt;<span class="hljs-type">QMicLinker</span>&gt;, <span class="hljs-comment">//所有麦位置</span>
<span></span>            target: <span class="hljs-type">QMicLinker</span>, <span class="hljs-comment">//目标麦位</span>
<span></span>            isJoin: <span class="hljs-type">Boolean</span> <span class="hljs-comment">//是否是加入 否则离开</span>
<span></span>        )</span></span>: MutableList&lt;QMergeOption&gt; {
<span></span>            <span class="hljs-comment">//将变化后的麦位换算成连麦混流参数  </span>
<span></span>            <span class="hljs-comment">//比如 案例(x,y)  -&gt;1号麦位（0，200 ）2号麦位（0，200+180+15）3号麦位（0，200+2*180+15）...</span>
<span></span>            <span class="hljs-keyword">val</span> ops = ArrayList&lt;QMergeOption&gt;()
<span></span>            <span class="hljs-keyword">val</span> lastY = <span class="hljs-number">200</span>
<span></span>            micLinkers.forEachIndex { index, linker -&gt;
<span></span>                ops.add(QMergeOption().apply {
<span></span>
<span></span>                    <span class="hljs-comment">// 该连麦者的用户ID</span>
<span></span>                    uid = linker.user.userId
<span></span>
<span></span>                    <span class="hljs-comment">//该用户的摄像头参数</span>
<span></span>                    cameraMergeOption = CameraMergeOption().apply {
<span></span>                        isNeed = <span class="hljs-literal">true</span>
<span></span>                        x = <span class="hljs-number">0</span> <span class="hljs-comment">//麦位x</span>
<span></span>                        y = lastY + <span class="hljs-number">180</span> + <span class="hljs-number">15</span> <span class="hljs-comment">//每个麦位 依次往下排 180 + 15 个分辨率间距</span>
<span></span>                        z = <span class="hljs-number">0</span>
<span></span>                        width = <span class="hljs-number">180</span>
<span></span>                        height = <span class="hljs-number">180</span>
<span></span>                    }
<span></span>                    <span class="hljs-comment">//该用户的麦克风参数</span>
<span></span>                    microphoneMergeOption = MicrophoneMergeOption().apply {
<span></span>                        isNeed = <span class="hljs-literal">true</span>
<span></span>                    }
<span></span>                })
<span></span>                lastY = lastY + <span class="hljs-number">180</span> + <span class="hljs-number">15</span>
<span></span>            }
<span></span>        }
<span></span>    }
<span></span>
<span></span><span class="hljs-comment">//观众端连麦器监听</span>
<span></span><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mQAudienceMicHandler = <span class="hljs-keyword">object</span> : QAudienceMicHandler.LinkMicHandlerListener {
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onRoleChange</span><span class="hljs-params">(isLinker: <span class="hljs-type">Boolean</span>)</span></span> {
<span></span>        <span class="hljs-keyword">if</span> (isLinker) {
<span></span>            <span class="hljs-comment">//我切换到了连麦模式 -&gt; 使用连麦和麦上用户和主播互动 延迟更低</span>
<span></span>            client?.getService(QLinkMicService::<span class="hljs-keyword">class</span>.java)?.allLinker?.forEach { micLinker -&gt;
<span></span>                <span class="hljs-comment">//对原来麦上的人设置预览</span>
<span></span>                <span class="hljs-keyword">val</span> preview = QPushTextureView(context)
<span></span>                <span class="hljs-comment">//添加到你要添加到的容器</span>
<span></span>                containerView.addView(preview)
<span></span>                <span class="hljs-comment">//设置该用户的预览</span>
<span></span>                linkService.setUserPreview(micLinker.user.userId, preview)
<span></span>            }
<span></span>        } <span class="hljs-keyword">else</span> {
<span></span>            <span class="hljs-comment">//我切换拉流模式</span>
<span></span>            client?.getService(QLinkMicService::<span class="hljs-keyword">class</span>.java)?.allLinker?.forEach {
<span></span>                <span class="hljs-comment">//移除对原来设置麦位移除设置预览view</span>
<span></span>                removePreview(it.user.userId)
<span></span>            }
<span></span>        }
<span></span>    }
<span></span>}
<span></span>
<span></span><span class="hljs-comment">//主播设置混流适配  </span>
<span></span>client!!.getService(QLinkMicService::<span class="hljs-keyword">class</span>.java).anchorHostMicHandler.setMixStreamAdapter( mQMixStreamAdapter  )
<span></span><span class="hljs-comment">//观众设置观众连麦处理监听</span>
<span></span>client!!.getService(QLinkMicService::<span class="hljs-keyword">class</span>.java).audienceMicHandler.addLinkMicListener( mQAudienceMicHandler )
<span></span><span class="hljs-comment">//主播和观众都关心麦位监听 </span>
<span></span>client!!.getService(QLinkMicService::<span class="hljs-keyword">class</span>.java).addMicLinkerListener(mQLinkMicServiceListener)
<span></span><span class="hljs-comment">//注册邀请监听</span>
<span></span>client.getService(QLinkMicService::<span class="hljs-keyword">class</span>.java).invitationHandler.addInvitationHandlerListener( mInvitationListener )
<span></span>
<span></span><span class="hljs-comment">//点击某个按钮 发起对某个主播申请 或者主播邀请用户</span>
<span></span>client!!.getService(QLinkMicService::<span class="hljs-keyword">class</span>.java).invitationHandler.apply(<span class="hljs-number">10</span> * <span class="hljs-number">1000</span>, room.liveID, room.anchor.userId, <span class="hljs-literal">null</span>,callback )
<span></span></code></pre>
<pre><code class="language-kotlin">如果不使用内置的邀请系统 比如外接匹配系统或者直接上麦不需要邀请
<span></span><span class="hljs-comment">//todo</span>
<span></span><span class="hljs-comment">// 别的邀请或者匹配</span>
<span></span><span class="hljs-comment">//直接调用上麦方法</span>
<span></span>client?.getService(QLinkMicService::<span class="hljs-keyword">class</span>.java)?.audienceMicHandler?.startLink( <span class="hljs-literal">null</span>, QCameraParam() , QMicrophoneParam(),callback )
<span></span></code></pre>
<h3 id="无uisdk-实现pk"><a href="#%E6%97%A0uisdk-%E5%AE%9E%E7%8E%B0pk" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>无UISDK 实现PK</h3>
<pre><code class="language-kotlin">
<span></span><span class="hljs-comment">//邀请监听</span>
<span></span><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mPKInvitationListener = <span class="hljs-keyword">object</span> : QInvitationHandlerListener {
<span></span>    <span class="hljs-comment">//收到邀请</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onReceivedApply</span><span class="hljs-params">(pkInvitation: <span class="hljs-type">QInvitation</span>)</span></span> {
<span></span>        <span class="hljs-comment">//拒绝操作</span>
<span></span>        client!!.getService(QPKService::<span class="hljs-keyword">class</span>.java).invitationHandler.reject(pkInvitation.invitationID, <span class="hljs-literal">null</span>, callBack)
<span></span>        <span class="hljs-comment">//接受 </span>
<span></span>        client!!.getService(QPKService::<span class="hljs-keyword">class</span>.java).invitationHandler.accept(pkInvitation.invitationID, <span class="hljs-literal">null</span>, callBack)
<span></span>    }
<span></span>
<span></span>    <span class="hljs-comment">//收到对方取消    </span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onApplyCanceled</span><span class="hljs-params">(pkInvitation: <span class="hljs-type">QInvitation</span>)</span></span> {}
<span></span>
<span></span>    <span class="hljs-comment">//发起超时对方没响应</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onApplyTimeOut</span><span class="hljs-params">(pkInvitation: <span class="hljs-type">QInvitation</span>)</span></span> {}
<span></span>
<span></span>    <span class="hljs-comment">//对方接受</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onAccept</span><span class="hljs-params">(pkInvitation: <span class="hljs-type">QInvitation</span>)</span></span> {
<span></span>        <span class="hljs-comment">//对方接受后调用开始pk</span>
<span></span>        client?.getService(QPKService::<span class="hljs-keyword">class</span>.java)?.start(<span class="hljs-number">20</span> * <span class="hljs-number">1000</span>, invitation.receiverRoomID, invitation.receiver.userId, <span class="hljs-literal">null</span>, callBack)
<span></span>    }
<span></span>
<span></span>    <span class="hljs-comment">//对方拒绝</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onReject</span><span class="hljs-params">(pkInvitation: <span class="hljs-type">QInvitation</span>)</span></span> {}
<span></span>}
<span></span>
<span></span><span class="hljs-comment">//pk监听</span>
<span></span><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mQPKServiceListener = <span class="hljs-keyword">object</span> : QPKServiceListener {
<span></span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStart</span><span class="hljs-params">(pkSession: <span class="hljs-type">QPKSession</span>)</span></span> {
<span></span>        <span class="hljs-comment">//主播设置对方主播预览</span>
<span></span>        client.getService(QPKService::<span class="hljs-keyword">class</span>.java).setPeerAnchorPreView(findviewbyid(...))
<span></span>        <span class="hljs-comment">//主播和观众都显示pk覆盖UI</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStop</span><span class="hljs-params">(pkSession: <span class="hljs-type">QPKSession</span>, code: <span class="hljs-type">Int</span>, msg: <span class="hljs-type">String</span>)</span></span> {
<span></span>        <span class="hljs-comment">//主播移除预览对方的UI 主播和观众都隐藏pk覆盖UI</span>
<span></span>    }
<span></span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStartTimeOut</span><span class="hljs-params">(pkSession: <span class="hljs-type">QPKSession</span>)</span></span> {}
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onPKExtensionUpdate</span><span class="hljs-params">(pkSession: <span class="hljs-type">QPKSession</span>, extension: <span class="hljs-type">QExtension</span>)</span></span> {
<span></span>    }
<span></span>}
<span></span>
<span></span><span class="hljs-comment">//混流适配</span>
<span></span><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mQPKMixStreamAdapter = <span class="hljs-keyword">object</span> : QPKMixStreamAdapter {
<span></span>    <span class="hljs-comment">//pk对方进入了 返回混流参数（同连麦）</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onPKLinkerJoin</span><span class="hljs-params">(pkSession: <span class="hljs-type">QPKSession</span>)</span></span>: MutableList&lt;QMergeOption&gt; {
<span></span>        <span class="hljs-keyword">return</span> LinkerUIHelper.getPKMixOp(pkSession, user!!)
<span></span>    }
<span></span>
<span></span>    <span class="hljs-comment">//pk开始了 如果修改整个直播混流面板（同连麦）</span>
<span></span>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onPKMixStreamStart</span><span class="hljs-params">(pkSession: <span class="hljs-type">QPKSession</span>)</span></span>: QMixStreamParams {
<span></span>        <span class="hljs-keyword">return</span> QMixStreamParams()
<span></span>    }
<span></span>}
<span></span>
<span></span><span class="hljs-comment">//添加pk监听</span>
<span></span>client!!.getService(QPKService::
<span></span><span class="hljs-keyword">class</span>.java).addServiceListener(mQPKServiceListener)
<span></span><span class="hljs-comment">//主播注册混流适配   </span>
<span></span>client!!.getService(QPKService::
<span></span><span class="hljs-keyword">class</span>.java).setPKMixStreamAdapter(mQPKMixStreamAdapter)
<span></span><span class="hljs-comment">//注册邀请监听</span>
<span></span>client.getService(QPKService::
<span></span><span class="hljs-keyword">class</span>.java).invitationHandler.addInvitationHandlerListener( mPKInvitationListener )
<span></span>
<span></span><span class="hljs-comment">//点击某个按钮 发起对某个主播邀请</span>
<span></span>client!!.getService(QPKService::
<span></span><span class="hljs-keyword">class</span>.java).invitationHandler.apply(<span class="hljs-number">10</span> * <span class="hljs-number">1000</span>, room.liveID, room.anchor.userId, <span class="hljs-literal">null</span>,callback )
<span></span></code></pre>
<pre><code class="language-kotlin">如果不使用内置的邀请系统 比如外接匹配pk系统
<span></span><span class="hljs-comment">//todo 别的邀请或者匹配</span>
<span></span><span class="hljs-comment">//直接调用开始PK方法</span>
<span></span>client?.getService(QPKService::<span class="hljs-keyword">class</span>.java)?.start(<span class="hljs-number">20</span> * <span class="hljs-number">1000</span>, invitation.receiverRoomID, invitation.receiver.userId, <span class="hljs-literal">null</span>,callBack)
<span></span></code></pre>
<h3 id="自定义im播放器rtc-sdk参数配置"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89im%E6%92%AD%E6%94%BE%E5%99%A8rtc-sdk%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>自定义IM,播放器，rtc sdk参数配置</h3>
<h4 id="自定义im初始化"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89im%E5%88%9D%E5%A7%8B%E5%8C%96" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>自定义im初始化</h4>
<pre><code>QNIMConfig.imSDKConfigGetter =  { appId: <span class="hljs-type">String</span>, context: Context <span class="hljs-punctuation">-&gt;</span>
<span></span>   <span class="hljs-comment">//返回你的自定义配置参数，比如加上推送配置，使用参考七牛im文档。</span>
<span></span>   <span class="hljs-title function_ invoke__">BMXSDKConfig</span>()
<span></span>}
<span></span></code></pre>
<h4 id="自定义播放器参数"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%92%AD%E6%94%BE%E5%99%A8%E5%8F%82%E6%95%B0" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>自定义播放器参数</h4>
<pre><code>QMediaPlayerConfig.mAVOptionsGetter = {
<span></span>  <span class="hljs-comment">//返回你的自定义AVOptions，使用参考七牛播放器文档</span>
<span></span>  <span class="hljs-built_in">AVOptions</span>（）
<span></span>}
<span></span></code></pre>
<h4 id="自定义rtc配置"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89rtc%E9%85%8D%E7%BD%AE" ariaHidden="true" tabIndex="-1"><span class="icon,icon-link"></span></a>自定义rtc配置</h4>
<pre><code>QRtcLiveRoomConfig.mRTCSettingGetter = {
<span></span>  <span class="hljs-comment">//返回你的rtc配置，使用参考七牛rtc文档</span>
<span></span>   <span class="hljs-built_in">QNRTCSetting</span>()
<span></span>}
<span></span></code></pre></div></div>