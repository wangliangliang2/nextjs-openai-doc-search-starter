### **模板变量**

模板变量允许您创建一个交互式和动态的仪表盘：通过在图表的搜索条件、数据配置里使用模板变量，使得一些原来固定的参数变为动态值，从而可以在仪表盘中方便地查看不同搜索条件、时间间隔、服务器等的数据。

![](http://pw7x36qrk.bkt.clouddn.com/template.png)

	
|模板变量类型|	描述	|
|:--:|:--:|
|时间间隔	|使用时间间隔类型模板变量可以任意切换图表的聚合时间|
|字段内容	|字段内容模板变量使您可以任意切换字段的取值来改变搜索条件。例如，类型为字段内容的模板变量 status 返回日志中字段 status 的值，日志中 status 字段的值有200、400，则模板变量的选项值是 200，400。通过在搜索条件中指定：status=$status即可通过切换模板变量status的值改变搜索条件|。
|常量	|允许给模板变量预设常量值，在仪表盘的名称、描述，图表的名称中通常用到常量类型模板变量|
|服务器	|通过模板变量切换数据来源服务器|

#### **模板变量的使用**

* 时间间隔模板变量

	* 添加模板变量：点击仪表盘编辑按钮进入仪表盘编辑模式，在模板变量编辑区域，点击添加模板变量，填写以下内容：
		* 变量名称：在搜索条件引用模板变量时需填写此变量名称。如在搜索条件引用模板变量 interval 表达方式为：interval:$interval。
		* 展示名称：模板变量的展示名称，取易于理解的名称即可。
		* 变量类型：选择模板变量类型为时间间隔。
		* 变量前缀：添加前缀字符串到模板变量的值。
		* 变量后缀：添加后缀字符串到模板变量的值。
	
	* 使用模板变量：
		* 点击编辑进入仪表盘编辑模式。
		* 点击图表右上角的搜索符号，在搜索条件中引用模板变量，如：interval:$interval。
		* 点击保存，保存图表的搜索条件。
		* 通过模板变量区域的下拉框/输入框切换时间间隔。

* 字段内容模板变量
	* 添加模板变量：点击仪表盘编辑按钮进入仪表盘编辑模式，在模板变量编辑区域，点击添加模板变量，填写以下内容：
		* 变量名称：在搜索条件引用模板变量时需填写此变量名称。如在搜索条件引用模板变量 status 表达方式为：status=$status。
		* 展示名称：模板变量的展示名称，取易于理解的名称即可。
		* 变量类型：选择模板变量类型为字段内容。
		* 变量前缀：添加前缀字符串到模板变量的值。
		* 变量后缀：添加后缀字符串到模板变量的值。
		* 变量值前缀：当模板变量的值为数组时，添加前缀字符串到数组里的每个值。
		* 变量值后缀：当模板变量的值为数组时，添加后缀字符串到数组里的每个值。
		* 分隔符：当模板变量的值为数组时，指定在每个值中间插入的分隔符。
		* 查询语句：输入查询语句，返回字段列表。
		* 取值字段：选择需在模板变量中切换取值的字段。
		* 支持多选：允许多值同时选中。
		* 预览：预览模板变量的取值。
	
	* 使用模板变量：
		* 点击编辑进入仪表盘编辑模式。
		* 点击图表右上角的搜索符号，在搜索条件中引用模板变量，如：status=$status。
		* 点击保存，保存图表的搜索条件。
		* 通过模板变量区域的下拉框/输入框切换字段取值。

* 常量类型模板变量：
	* 添加模板变量：点击仪表盘编辑按钮进入仪表盘编辑模式，在模板变量编辑区域，点击添加模板变量，填写以下内容：
变量名称：在搜索条件/文字描述中引用模板变量时需填写此变量名称。如在仪表盘标题中引用模板变量 title 表达方式为：$title。
		* 展示名称：模板变量的展示名称，取易于理解的名称即可。
		* 变量类型：选择模板变量类型为常量。
		* 变量前缀：添加前缀字符串到模板变量的值。
		* 变量后缀：添加后缀字符串到模板变量的值。
		* 默认选项：输入常量的预置值，可输入多个值，按回车分隔输入。
		* 支持多选：允许多值同时选中。
	* 使用模板变量：
		* 点击编辑进入仪表盘编辑模式。
		* 在搜索条件或文字描述中引用模板变量，如：在仪表盘标题中使用模板变量：$title。
		* 点击保存。
		* 通过模板变量区域的下拉框/输入框切换常量值。


## **示例一**
**背景说明**
本示例数据集是从国家统计局的官方网站上公布的国际数据中，摘录的哈萨克斯坦、塔吉克斯坦、乌兹别克斯坦等中亚五国在1998年~2007年期间的人口数据。共有3个变量，分别为：
|变量名称|变量含义|
|:--:|:--:|
|year|年份|
|country|国家名称|
|population|人口|
我们可以通过配置模板变量，在同一张折线图内通过选择不同的国家名称，快速查看到所选国家的人口变化趋势图，而不需要事先绘制好所有国家的人口变化趋势图。

>  点击[下载](https://pandora-kibana.qiniu.com/MiddleAsia.csv)本测试数据集

**操作流程**
1、将该数据集上传到Pandora并保存到仓库中，通过可视化分析绘制反映人口（population）与年份（year）关系折线图，并将其添加到仪表盘Middle_Asia中。详细操作查看[可视化手册](/express/6046/charts)
2、进入仪表盘Middle_Asia，点击右上角“编辑”按钮，进入到仪表盘编辑状态。
3、点击 “+”按钮，在下拉框中选择 “新增模版变量”；点击模版变量框右侧“编辑”按钮，在弹出的配置表单中进行模版变量配置。
- 配置国家名称模板变量：
选择“下拉”选项卡，填写变量展示名，如“国家名称”；在动态选项的“搜索语句”中输入返回字段列表的SPL语句，如：repo="middle_asia"；在“标签字段”部分输入标签来源的字段名，如“country”；在“值字段”部分可以选择不输入，也可以输入与“标签字段”部分相同的字段名，即“country”；最后点击“确定”。
![无标题.png](https://dn-odum9helk.qbox.me/FmH04pKZdhCkazZ2Hu3kNv7-_1yv)
4、点击折线图右上角的“编辑搜索条件”按钮， 在弹出的“搜索条件”窗口中，通过输入变量的方式实现搜索内容的筛选，如：repo="middle_asia" and country=$country$，然后点击“确认修改”。
![无标题2.png](https://dn-odum9helk.qbox.me/FuaxAU2cVxdGPdCEiQ9eeZ8GX8Xu)
5、完成以上所有操作后，点击“保存”。这时，从“地区”变量的下拉菜单中选择想了解的国家名称，就可以快速地看到对应国家的人口数据在折线图上的动态更新，实现不同国家人口趋势图的灵活切换。


## **示例二**
**背景说明**
本示例数据集是根据某日化消费品公司运营管理记录模拟的2019年度每个月在中国国内的销售数据，这里涉及到的销售区域分为两级管理，分别是“地区”和“省份”。目前已有运营的“地区”分为华北、东北、华中、中南、西南、西北这6大块，涵盖到的“省份”分为华北地区的北京、天津、河北，东北地区的辽宁、吉林、黑龙江等21个省、市、自治区。共有4个变量，分别为：
|变量名称|变量含义|
|:--:|:--:|
|region|地区|
|province|省份|
|month|月份|
|volume|销量|
我们可以通过配置模板变量，实现在同一个可视化图表中通过切换变量查看不同地区、不同省份及不同月份的销售业绩以便用户快速了解销售情况。例如在图表中，默认情况下管理者能够看到华东地区在2019年全年的整体销售业绩。当用户想快速查看北京2019年12月份的销售业绩时，切换地区、省份以及月份的模版变量值即可，可以很方便地实现切换查询条件获取需要数据结果。
>  点击[下载](https://pandora-kibana.qiniu.com/sales_volume.csv)本测试数据集

**操作过程**
1、将该数据集上传至Pandora并保存到仓库中，通过可视化分析绘制反映销量（volume）与年份（year）关系的柱状图，并将其添加到仪表盘sales_volume中。详细操作查看[可视化手册](/express/6046/charts)
2、进入仪表盘sales_volume，点击右上角的“编辑”按钮，进入仪表盘编辑状态。
3、点击 “+”按钮，在下拉框中选择 “新增模版变量”；点击模版变量框右侧“编辑”按钮，在弹出的配置表单中进行模版变量配置。
- 配置地区模版变量：
选择“下拉”选项卡，填写变量展示名，如“地区”；在动态选项的“搜索语句”中输入返回字段列表的SPL语句，如：repo="sales_volume"；在“标签字段”部分输入用于变量的字段名，如“region”；在“值字段”部分可以选择不输入，也可以输入与“标签字段”相同的字段名，即“region”，最后点击“确定”。
![无标题3.png](https://dn-odum9helk.qbox.me/FrPVgRc6oNnhhChrBrxUjqY-VmtV)
- 配置省份模板变量，使用同样操作新增一个模板变量：
选择“下拉”选项卡，在“标签”部分输入自定义的展示名，如“省份”；在“查询语句”输入可以返回字段列表的SPL语句，需要注意的是这里配置的变量“省份”和变量“地区”是嵌套关系，即不同地区下的省份选项是不同的，某个省份只属于某个特定的地区，“省份”可选的值必须跟随“地区”中选择的值变化，如：repo="sales_volume" AND region=$region$；在“标签字段”部分输入标签来源的字段名，如“province”；在“值字段”部分可以选择不输入，也可以输入与“标签字段”相同的字段名，即“province”，最后点击“确定”。
![无标题4.png](https://dn-odum9helk.qbox.me/FpAd4sdiA7p3R3bXt9B3ARpp1-TR)
5、点击折线图右上角的 “编辑搜索条件”按钮， 在弹出的“搜索条件”窗口中，输入与值字段所选内容一致的SPL语句，如：repo="sales_volume" and region=$region$ and province=$province$，
然后点击“确认修改”。
![无标题5.png](https://dn-odum9helk.qbox.me/FjgWqIPTKuOBY8hfNKdGk1bnbrsR)
6、完成以上所有操作后，点击保存进入到仪表盘展示状态。这时，从“地区”变量的下拉菜单中选择地区名称，再从“省份”右侧的下拉菜单中选择对应的“省份”名称，就可以快速查看想要了解的省份的销售数，实现不同地区、不同省份销售业绩图表的快速切换。




